{
  "Tags": [
    "All things Azure"
  ],
  "FeedUrl": "https://devblogs.microsoft.com/all-things-azure/feed/",
  "Author": "Govind Kamtamneni",
  "FeedName": "Microsoft All Things Azure Blog",
  "Title": "Claude Code + Microsoft Foundry: Enterprise AI Coding Agent Setup",
  "ProcessedDate": "2025-12-02 02:32:41",
  "EnhancedContent": "This guide covers setting up Claude Code CLI and VS Code extension with Microsoft Foundry, configuring CLAUDE.md for project context, integrating Spec Kit for structured development, and running Claude Code in GitHub Actions.\n\n## Prerequisites\n\n- [Azure subscription with Foundry access](https://learn.microsoft.com/en-us/azure/ai-foundry/quickstarts/get-started-code?view=foundry&amp;preserve-view=true&amp;tabs=python%2Cpython2)\n- Node.js 18+ (for Claude Code CLI)\n- Optional: [Azure CLI installed](https://learn.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest) (`az login`\ncompleted)\n\n## Step 1: Deploy Claude Models in Foundry\n\nIn [Microsoft Foundry](https://ai.azure.com):\n\n1. Go to **Discover** → Models and search “Claude”\n2. Select your model (Opus 4.5, Sonnet 4.5, or Haiku 4.5)\n3. Click **Deploy** → choose **Default settings**\n4. Click on the **Details** tab and note your Target URI and Key\n[![Claude model details in Foundry portal](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABAAAAAEfAQMAAADlayYpAAAAA1BMVEXW1taWrGEgAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAO0lEQVR4nO3BMQEAAADCoPVPbQwfoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgLMBkJ8AAWa77DkAAAAASUVORK5CYII=)](https://devblogs.microsoft.com/all-things-azure/wp-content/uploads/sites/83/2025/12/1-cc-model-details.webp)\n\n## Step 2: Install Claude Code CLI\n\n``` npm install -g @anthropic-ai/claude-code ```\n\nVerify installation:\n\n``` claude --version ```\n\nFor more advanced installation options, visit [Claude Code Docs](https://code.claude.com/docs/en/setup).\n\n## Step 3: Configure for Foundry\n\nSet these environment variables:\n\n**Bash / WSL:**\n\n```\n# Required\nexport CLAUDE_CODE_USE_FOUNDRY=1\n\n# Azure resource name (replace {resource} with your resource name)\nexport ANTHROPIC_FOUNDRY_RESOURCE={resource}\n# Or provide the full base URL:\n# export ANTHROPIC_FOUNDRY_BASE_URL=https://{resource}.services.ai.azure.com\n\n# Optional: specify model deployment names, matching the deployment names in Foundry\nexport ANTHROPIC_DEFAULT_SONNET_MODEL=\"claude-sonnet-4-5\" export ANTHROPIC_DEFAULT_HAIKU_MODEL=\"claude-haiku-4-5\" export ANTHROPIC_DEFAULT_OPUS_MODEL=\"claude-opus-4-5\" ```\n\n**PowerShell:**\n\n```\n# Required\n$env:CLAUDE_CODE_USE_FOUNDRY = \"1\"\n\n# Azure resource name (replace {resource} with your resource name)\n$env:ANTHROPIC_FOUNDRY_RESOURCE = \"{resource}\"\n# Or provide the full base URL:\n# $env:ANTHROPIC_FOUNDRY_BASE_URL = \"https://{resource}.services.ai.azure.com\"\n\n# Optional: specify model deployment names, matching the deployment names in Foundry\n$env:ANTHROPIC_DEFAULT_SONNET_MODEL = \"claude-sonnet-4-5\" $env:ANTHROPIC_DEFAULT_HAIKU_MODEL = \"claude-haiku-4-5\" $env:ANTHROPIC_DEFAULT_OPUS_MODEL = \"claude-opus-4-5\" ```\n\n### Authentication\n\n**Option A: Entra ID (recommended)**\n\n``` az login ```\n\nClaude Code uses your Azure CLI credentials automatically.\n\n**Option B: API Key**\n\n**Bash / WSL:**\n\n``` export ANTHROPIC_FOUNDRY_API_KEY=\"your-foundry-api-key\" ```\n\n**PowerShell:**\n\n``` $env:ANTHROPIC_FOUNDRY_API_KEY = \"your-foundry-api-key\" ```\n\n### VS Code Extension\n\nInstall the Claude Code extension, then add to your VS Code settings:\n\n``` { \"Claude Code: Environment Variables\": { \"CLAUDE_CODE_USE_FOUNDRY\": \"1\", \"ANTHROPIC_FOUNDRY_RESOURCE\": \"https://your-resource.services.ai.azure.com\", \"ANTHROPIC_FOUNDRY_API_KEY\": \"<optional-for-non-entra-auth>\" } } ```\n\n## Step 4: Validate Configuration\n\nVerify that Claude Code is correctly configured to use Microsoft Foundry. Open a terminal, launch Claude Code, and run the `/status` command:\n\n``` claude\n> /status\n```\n\nConfirm that:\n\n- **API provider** shows “Microsoft Foundry”\n- **Microsoft Foundry resource** points to your Foundry project\n- **Model** matches your deployed model (e.g., claude-sonnet-4-5)\n\n[![2 cc model validate image](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABAAAAAFNAQMAAACkLY/VAAAAA1BMVEXW1taWrGEgAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAQElEQVR4nO3BMQEAAADCoPVPbQwfoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4GynzQABxlmw1wAAAABJRU5ErkJggg==)](https://devblogs.microsoft.com/all-things-azure/wp-content/uploads/sites/83/2025/12/2-cc-model-validate.webp)\n\n## Step 5: CLAUDE.md Project Memory\n\nClaude Code reads `CLAUDE.md` files for project context. Files are loaded in order (later files override earlier):\n\n1. `~/.claude/CLAUDE.md`\n– global defaults\n2. `./CLAUDE.md`\n– repo root\n3. `./current-dir/CLAUDE.md`\n– current directory\n\nExample `CLAUDE.md` for a [Microsoft Agent Framework](https://aka.ms/agent-framework) project in Python:\n\n```\n# Project: Customer Service Agent\n\n## Overview\nMulti-agent system using Microsoft Agent Framework with Foundry Agent Service.\n\n## Tech Stack\n- Python 3.11+\n- agent-framework (Microsoft Agent Framework Python SDK)\n- Microsoft Foundry for hosted agents\n- MCP tools for enterprise data access\n\n## Architecture\n- `src/agents/` - Agent definitions (triage, specialist, escalation)\n- `src/tools/` - MCP tool implementations\n- `src/workflows/` - Multi-agent orchestration\n- `tests/` - pytest with async fixtures\n\n## Commands\n```bash\n# Run locally\npython -m src.main\n\n# Test\npytest tests/ -v\n\n# Deploy to Foundry Agent Service\naz ai agent deploy --config deploy.yaml ```\n\n## Code Patterns\nUse `AzureAIAgentClient` with `AzureCliCredential`: ```python async with AzureAIAgentClient(async_credential=AzureCliCredential()) as client: agent = client.create_agent(instructions=\"...\", tools=[...]) ```\n\n## Current Sprint\n- Implementing RAG grounding with Foundry IQ\n- Adding Fabric connector for sales data\n```\n\n## Step 6: Initialize and Explore\n\n```\n# Start Claude Code in your project\ncd your-project claude\n\n# Or run a one-off command\nclaude \"explain the agent orchestration in src/workflows/\" ```\n\nClaude Code will read your `CLAUDE.md` and understand your project context.\n\n## Step 7: Spec Kit Integration\n\n[Spec Kit](https://github.com/github/spec-kit) provides structured commands for turning requirements into implementation. Install [globally or for one-time use](https://github.com/github/spec-kit?tab=readme-ov-file#1-install-specify-cli).\n\n### Workflow\n\n| Command | Purpose | Output | | --- | --- | --- | | `/speckit.constitution` | Define project principles | `.speckit/constitution.md` | | `/speckit.specify` | Capture requirements (what/why) | `.speckit/spec.md` | | `/speckit.plan` | Technical design (how) | `.speckit/plan.md` | | `/speckit.tasks` | Break into actionable tasks | `.speckit/tasks.md` | | `/speckit.implement` | Execute all tasks | Code changes |\n\n### Example: Building an Agent Framework Tool\n\n```\n# 1. Set project principles\nclaude /speckit.constitution\n# Creates .speckit/constitution.md with coding standards, patterns\n\n# 2. Define the feature\nclaude /speckit.specify\n> \"Add a SharePoint MCP tool that retrieves documents for RAG grounding\"\n# Creates .speckit/spec.md with requirements\n\n# 3. Plan implementation\nclaude /speckit.plan\n# Creates .speckit/plan.md with architecture, dependencies\n\n# 4. Generate tasks\nclaude /speckit.tasks\n# Creates .speckit/tasks.md with ordered task list\n\n# 5. Implement\nclaude /speckit.implement\n# Executes tasks, creates files, runs tests\n```\n\n## Step 8: GitHub Actions\n\n### Unit Test Generation for Agent Framework\n\n``` name: Generate Agent Tests on: pull_request: paths:\n- 'src/agents/**'\n- 'src/tools/**'\n\njobs: generate-tests: runs-on: ubuntu-latest permissions: contents: write pull-requests: write steps:\n- uses: actions/checkout@v4\n\n- name: Run Claude Code\nuses: anthropic-ai/claude-code-action@v1 with: prompt: | Review the changed agent files and generate pytest tests. Use async fixtures for AzureAIAgentClient mocking. Follow patterns in tests/conftest.py. allowed_tools: \"edit,write,bash\" env: CLAUDE_CODE_USE_FOUNDRY: \"1\" ANTHROPIC_FOUNDRY_RESOURCE: ${{ secrets.AZURE_FOUNDRY_RESOURCE }} ANTHROPIC_FOUNDRY_API_KEY: ${{ secrets.AZURE_FOUNDRY_API_KEY }} ```\n\n### PR Review with @claude\n\n``` name: Claude PR Assistant on: issue_comment: types: [created]\n\njobs: respond: if: contains(github.event.comment.body, '@claude') runs-on: ubuntu-latest permissions: contents: read pull-requests: write steps:\n- uses: actions/checkout@v4\n\n- name: Claude Review\nuses: anthropic-ai/claude-code-action@v1 with: prompt: ${{ github.event.comment.body }} context: \"PR #${{ github.event.issue.number }}\" env: CLAUDE_CODE_USE_FOUNDRY: \"1\" ANTHROPIC_FOUNDRY_RESOURCE: ${{ secrets.AZURE_FOUNDRY_RESOURCE }} ANTHROPIC_FOUNDRY_API_KEY: ${{ secrets.AZURE_FOUNDRY_API_KEY }} ```\n\n## Step 9: Agent HQ\n\nGitHub Agent HQ provides unified management for agents across your organization. Once your Agent Framework agents are deployed to Foundry Agent Service, you can manage them alongside other AI agents in Agent HQ:\n\n- **Unified dashboard** for all agents (Foundry, Copilot, custom)\n- **Policy management** across agent fleet\n- **Observability** with traces and metrics\n- **One-click deployment** from GitHub repos to Foundry\n\nAccess Agent HQ from your GitHub organization settings or the Foundry portal.\n\n## Step 10: Monitor Usage in Foundry Control Center\n\nIn Foundry portal → **Operate**:\n\n- Token consumption by model\n- Request latency\n- Error rates and rate limit hits\n\nSet token limits in Claude Code or from Foundry Control Center:\n\n**Bash / WSL:**\n\n``` export ANTHROPIC_MAX_TOKENS=100000 # per request ```\n\n**PowerShell:**\n\n``` $env:ANTHROPIC_MAX_TOKENS = \"100000\" # per request ```\n\n## Troubleshooting\n\n| Issue | Solution | | --- | --- | | 401/403 errors | Run `az login`<br>. Verify you have the **Azure AI User** role on the Foundry resource. | | Model not found | Check that the deployment name matches `ANTHROPIC_DEFAULT_*_MODEL`<br> env var. | | Region errors | Claude models are only available in East US2 and Sweden Central. | | VS Code not using Foundry | Restart VS Code after setting environment variables in settings. | | Rate limit (429) | Default: 1K RPM, 1M TPM. Request an increase via Azure support. |\n\n## Resources\n\n- [Claude Code Documentation](https://docs.anthropic.com/en/docs/claude-code)\n- [Microsoft Foundry Docs](https://learn.microsoft.com/en-us/azure/ai-foundry/)\n- [Microsoft Agent Framework](https://learn.microsoft.com/en-us/agent-framework/)\n- [Spec Kit on GitHub](https://github.com/github/spec-kit)",
  "OutputDir": "_news",
  "FeedLevelAuthor": "All things Azure",
  "Link": "https://devblogs.microsoft.com/all-things-azure/claude-code-microsoft-foundry-enterprise-ai-coding-agent-setup/",
  "Description": "This guide covers setting up Claude Code CLI and VS Code extension with Microsoft Foundry, configuring CLAUDE.md for project context, integrating Spec Kit for structured development, and running Claude Code in GitHub Actions. Prerequisites Azure subscription with Foundry access Node.js 18+ (for Claude Code CLI) Optional: Azure CLI installed (az login completed) Step 1: Deploy […]\n\nThe post [Claude Code + Microsoft Foundry: Enterprise AI Coding Agent Setup](https://devblogs.microsoft.com/all-things-azure/claude-code-microsoft-foundry-enterprise-ai-coding-agent-setup/) appeared first on [All things Azure](https://devblogs.microsoft.com/all-things-azure).",
  "PubDate": "2025-12-02T01:37:40+00:00"
}
