{
  "Tags": [
    ".NET",
    "Announcements",
    "azdo",
    "Azure DevOPs",
    "C#",
    "F#",
    "testing",
    "Visual Basic"
  ],
  "PubDate": "2025-12-16T18:05:00+00:00",
  "Title": "Microsoft.Testing.Platform Now Fully Supported in Azure DevOps",
  "Description": "Azure DevOps enhanced support for Microsoft.Testing.Platform, from running tests to publishing results!\n\nThe post [Microsoft.Testing.Platform Now Fully Supported in Azure DevOps](https://devblogs.microsoft.com/dotnet/microsoft-testing-platform-azure-retry/) appeared first on [.NET Blog](https://devblogs.microsoft.com/dotnet).",
  "Link": "https://devblogs.microsoft.com/dotnet/microsoft-testing-platform-azure-retry/",
  "FeedUrl": "https://devblogs.microsoft.com/dotnet/feed/",
  "OutputDir": "_news",
  "FeedLevelAuthor": ".NET Blog",
  "ProcessedDate": "2025-12-16 19:03:37",
  "FeedName": "Microsoft .NET Blog",
  "Author": "Youssef Fahmy",
  "EnhancedContent": "Earlier this year, we announced that [all major .NET test frameworks now support Microsoft.Testing.Platform](https://devblogs.microsoft.com/dotnet/mtp-adoption-frameworks/). The next logical step? Making sure it works seamlessly with your CI/CD pipelines. Today, we’re announcing comprehensive Azure DevOps integration for Microsoft.Testing.Platform.\n\n## What’s New in Azure DevOps\n\nAzure DevOps now provides first-class support for Microsoft.Testing.Platform with two key improvements:\n\n- **Run tests** using the familiar DotNetCoreCLI task; no more workarounds required.\n- **Handle test retries** intelligently—publish multiple TRX files from retry attempts with proper grouping and exit codes.\n\nWhether you’re migrating from VSTest or starting fresh with Microsoft.Testing.Platform, the experience is now smooth and intuitive.\n\n## About Microsoft.Testing.Platform\n\nIf you’re new to Microsoft.Testing.Platform, here are some helpful resources to get you up to speed:\n\n- [Testing in .NET](https://learn.microsoft.com/dotnet/core/testing/) gives an overview of the testing tools used in .NET. In particular, it clarifies the difference between a test platform and a test framework.\n- [Testing with ‘dotnet test’](https://learn.microsoft.com/dotnet/core/testing/unit-testing-with-dotnet-test) explains the different modes that the ‘dotnet test’ command can operate in.\n- [Microsoft.Testing.Platform overview](https://learn.microsoft.com/dotnet/core/testing/microsoft-testing-platform-intro) covers what Microsoft.Testing.Platform is and how to run tests with it.\n- [Enhance your CLI testing workflow with the new dotnet test](https://devblogs.microsoft.com/dotnet/dotnet-test-with-mtp/) shows the ‘dotnet test’ support for Microsoft.Testing.Platform that was added in .NET 10 SDK.\n\nIn short, Microsoft.Testing.Platform is a modern alternative to VSTest.\n\n## Running Tests in Azure DevOps\n\nThe DotNetCoreCLI task now supports Microsoft.Testing.Platform starting in version 2.263.0!\n\nYou have two main options for running tests with Microsoft.Testing.Platform in Azure DevOps:\n\n### Option 1: Use the DotNetCoreCLI task (Recommended)\n\nThe [DotNetCoreCLI Azure DevOps task](https://learn.microsoft.com/azure/devops/pipelines/tasks/reference/dotnet-core-cli-v2) now [supports Microsoft.Testing.Platform](https://github.com/microsoft/azure-pipelines-tasks/pull/21315/) starting in version 2.263.0.\n\n```yml\n- task: DotNetCoreCLI@2\ndisplayName: 'Run tests' inputs: command: 'test' projects: '**/*Tests.csproj' arguments: '--no-build --report-trx' ```\n\n**What changed?** Microsoft.Testing.Platform uses different command-line flags than VSTest. For example, use `--report-trx` instead of `--logger trx` . See the [Microsoft.Testing.Platform CLI documentation](https://learn.microsoft.com/dotnet/core/testing/microsoft-testing-platform-intro) for the full list of options.\n\n### Option 2: Run ‘dotnet test’ directly\n\nYou can run the `dotnet test` command directly using a script or command-line task. This gives you maximum flexibility and doesn’t require specific Azure DevOps task updates.\n\n```yml\n- task: CmdLine@2\ndisplayName: 'Run tests' inputs: script: 'dotnet test --no-build --report-trx' ```\n\n**When to use this?** Choose this approach if you need custom scripting around test execution or want to avoid dependencies on specific task versions.\n\n### Migrating from VSTest task\n\nThe [VSTest Azure DevOps task](https://learn.microsoft.com/azure/devops/pipelines/tasks/reference/vstest-v3) was designed exclusively for VSTest and will not support Microsoft.Testing.Platform.\n\n**If you’re currently using the VSTest task:**\n\n1. Switch to Option 1 (DotNetCoreCLI task) for the most similar experience\n2. Update your command-line arguments to use Microsoft.Testing.Platform syntax\n3. Test your pipeline to ensure test discovery and execution work as expected\n\nBoth Option 1 and Option 2 provide the same test execution capabilities as the VSTest task.\n\n## Publishing test results with retry support\n\nHere’s the challenge: when you use the [Retry extension](https://www.nuget.org/packages/Microsoft.Testing.Extensions.Retry) to automatically re-run failed tests, Microsoft.Testing.Platform generates a separate TRX file for each attempt. Previously, the `PublishTestResults` task treated these as independent test runs, leading to two problems:\n\n- **Incorrect exit codes**: The task would fail even when tests eventually passed after retry\n- **Confusing UI**: Test results appeared as separate runs instead of grouped retry attempts\n\nWe’ve solved this! The `PublishTestResults` task now intelligently handles multiple TRX files from retry attempts, correctly grouping them and setting appropriate exit codes.\n\n### What you need to know\n\nMicrosoft.Testing.Platform uses the standard TRX format (also known as VSTest test results format) through the [Microsoft.Testing.Extensions.TrxReport](https://nuget.org/packages/Microsoft.Testing.Extensions.TrxReport) package. The [PublishTestResults task](https://learn.microsoft.com/azure/devops/pipelines/tasks/reference/publish-test-results-v2) has always supported TRX files. What’s new is the intelligent handling of retry scenarios.\n\n**Required Configuration**\n\nTo enable retry-aware test result publishing, set the `AllowPtrToDetectTestRunRetryFiles` variable to `true` in your pipeline. This opt-in flag activates the new behavior that correctly interprets multiple TRX files as retry attempts rather than separate test runs.\n\n**Important:** This variable must be set at the pipeline level (in your YAML file or pipeline variables). It will not work if set at the project or organization level.\n\n### Complete pipeline example\n\nHere’s a full pipeline demonstrating test execution with retries and proper result publishing:\n\n```yml trigger:\n- main\n\njobs:\n- job: MyJob\nvariables: AllowPtrToDetectTestRunRetryFiles: true\n\nsteps:\n\n# Your usual steps to install .NET SDK, restore, and build.\n\n- task: CmdLine@2\ndisplayName: 'Run tests' inputs: script: 'dotnet test --no-build --report-trx --retry-failed-tests 3 --results-directory TestResults'\n\n- task: PublishTestResults@2\ndisplayName: 'Publish test results' inputs: testResultsFormat: 'VSTest' testResultsFiles: '**/*.trx' mergeTestResults: true failTaskOnFailedTests: true condition: succeededOrFailed() ```\n\n**Key points in this pipeline:**\n\n- The `AllowPtrToDetectTestRunRetryFiles: true`\nvariable enables retry-aware behavior\n- The `--retry-failed-tests 3`\nflag tells the test platform to retry failed tests up to 3 times\n- The `condition: succeededOrFailed()`\nensures test results publish even if tests fail\n\n### Understanding the retry outcomes\n\nLet’s see how the Azure DevOps UI displays results across different retry scenarios. Imagine a test suite with one stable test that always passes and one flaky test with intermittent failures.\n\n#### Scenario 1: All tests pass on first attempt\n\nWhen all tests pass immediately, you see standard success indicators. The `PublishTestResults` task completes successfully.\n\n![Azure DevOps Tests UI showing tests passing on first run](https://devblogs.microsoft.com/dotnet/wp-content/uploads/sites/10/2025/12/passed-on-first-run.webp)\n\n#### Scenario 2: Test passes after retry\n\nThis is where the new behavior shines. The UI shows the test failed on attempts 1 and 2 but succeeded on attempt 3. Even though there were initial failures, the `PublishTestResults` task passes because the test eventually succeeded. This is the correct behavior for handling flaky tests.\n\n![Azure DevOps Tests UI showing tests passing on re-run](https://devblogs.microsoft.com/dotnet/wp-content/uploads/sites/10/2025/12/passed-on-re-run.webp)\n\n#### Scenario 3: Test fails all retry attempts\n\nWhen a test fails across all attempts, the UI groups all failures together for easy review. You can examine each individual failure to identify patterns or differences. The `PublishTestResults` task fails as expected when `failTaskOnFailedTests` is true.\n\n![Azure DevOps Tests UI showing tests failing for all attempts](https://devblogs.microsoft.com/dotnet/wp-content/uploads/sites/10/2025/12/failed-on-all-runs.webp)\n\n**Why This Matters**\n\nThe distinction between VSTest and Microsoft.Testing.Platform is important here: VSTest never had built-in retry support, so this scenario couldn’t occur naturally. With Microsoft.Testing.Platform’s Retry extension, you get automatic retry handling with proper Azure DevOps integration; no custom scripting required.\n\n## Get Started Today\n\nAzure DevOps now has full support for Microsoft.Testing.Platform—from running tests to publishing retry results with intelligent handling.\n\n**Ready to migrate?**\n\n1. Update to .NET SDK 10\n2. Add the Retry extension to your test project\n3. Set `AllowPtrToDetectTestRunRetryFiles: true`\nin your pipeline\n4. Run your tests with `--retry-failed-tests`\nflag\n\n**Need help?** We’re here for you:\n\n- Ask questions: [GitHub Discussions](https://github.com/microsoft/testfx/discussions/new/choose)\n- Report issues: [GitHub Issues](https://github.com/microsoft/testfx/issues/new/choose)\n- Learn more: [Microsoft.Testing.Platform documentation](https://learn.microsoft.com/dotnet/core/testing/microsoft-testing-platform-intro)"
}
