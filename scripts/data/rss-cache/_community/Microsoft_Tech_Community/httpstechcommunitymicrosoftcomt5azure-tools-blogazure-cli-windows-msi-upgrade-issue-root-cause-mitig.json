{
  "FeedUrl": "https://techcommunity.microsoft.com/t5/s/gxcuf89792/rss/Category?category.id=Azure",
  "EnhancedContent": "# Azure CLI on Windows MSI Upgrade Issue\n\n## Summary\n\nAbout six months ago, some Windows users experienced an Azure CLI crash after upgrading via the MSI installer from Azure CLI 2.76.0 (or earlier) to 2.77.0 (or later). The failure occurred immediately on startup with: “ImportError: DLL load failed while importing win32file: The specified module could not be found.” This post explains what happened, why upgrades were affected (while clean installs typically worked), and what you can do to recover.\n\n## Who is affected?\n\n**You are likely affected if:**\n\n- You installed Azure CLI using the Windows MSI installer.\n- You upgraded from Azure CLI 2.76.0 (or earlier) to 2.77.0 (or later) without fully uninstalling first.\n- After the upgrade, any az command fails with the win32file ImportError on startup.\n\n## Symptoms\n\nTypical error output (Azure CLI/Azure PowerShell):\n\nImportError: DLL load failed while importing win32file: The specified module could not be found.\n\n## Immediate recovery\n\n1. Upgrade to the latest version [2.83.0](https://learn.microsoft.com/en-us/cli/azure/install-azure-cli-windows?view=azure-cli-latest&amp;pivots=msi)\n2. If you want to install other versions of Azure CLI, perform a clean reinstall by uninstalling Microsoft Azure CLI from Windows Settings → Apps, deleting any remaining install folder (such as the CLI2 directory), reinstalling the latest Azure CLI using MSI or winget, and then verifying the installation with az --version.\n\n## Root cause analysis\n\nDuring an affected MSI upgrade, the Azure CLI installation directory ended up missing a set of native Python extension files (.pyd files) required by the Windows integration layer. MSI logging showed components being blocked with messages indicating MSI believed the existing (older) key file was “newer” than the incoming one.\n\nThe root cause was an interaction between Windows Installer file versioning rules and a third‑party dependency packaging change. Azure CLI 2.76.0/2.77.0 consumed pywin32 311, whose .pyd binaries were missing Windows version resource metadata. When upgrading from a previous Azure CLI build that contained version-stamped pywin32 binaries (e.g., pywin32 306), MSI could treat the older versioned files as higher priority than the incoming non-versioned files. As a result, MSI could remove the old files during upgrade but skip installing the new ones, leaving the install incomplete.\n\n## Version mapping observed\n\n| Azure CLI version | Python | pywin32 | pywin32 .pyd version resource | | --- | --- | --- | --- | | ≤ 2.75.0 | 3.12 | 306 | Present (e.g., 3.12.306.0) | | 2.76.0 | 3.12 | 311 | Missing / empty | | 2.77.0+ | 3.13 | 311 | Missing / empty |\n\n## If you need to collect MSI logs （for support）\n\nRun the installer with verbose logging （example）:\n\n> >\n> msiexec /i \"azure-cli-2.77.0.msi\" /l\\*vx \"C:\\temp\\azure-cli-install.log\"\n> >\n\n## References\n\n- [https://github.com/Azure/azure-cli/issues/32045#issuecomment-3669161120](https://github.com/Azure/azure-cli/issues/32045#issuecomment-3669161120)\n\n# Windows MSI Upgrade Performance Optimization\n\nThe MSI upgrade process for Azure CLI on Windows has been significantly improved.\n\nPreviously, Windows Installer performed per‑file version comparisons—particularly expensive for Python runtime files—which made upgrades slow and sometimes inconsistent.\n\nWith the new logic, which skips the comparison and performs an overwrite installation. Upgrades now use a streamlined clean‑install process, resulting in faster and more reliable MSI upgrades.\n\n## Performance Improvements\n\n| **Scenario** | **Before** | **After** | **Improvement** | | --- | --- | --- | --- | | **Fresh Install** | Baseline | ~5% faster | **5% faster** | | **Upgrade** | Long due to file-by-file version comparison | ~23% faster | **23% faster** |\n\nThis update makes upgrades noticeably faster and more reliable by removing old files first and skipping slow per‑file version checks.\n\nFor more details, please refer to: [\\[Packaging\\] Optimize MSI upgrade performance by simplifying file replacement logic by wangzelin007 · Pull Request #32678 · Azure/azure-cli](https://github.com/Azure/azure-cli/pull/32678)\n\nWe encourage you to upgrade to the latest version of the Azure CLI. This will not only resolve the issue but also improve installation performance. Here is our [release note](https://learn.microsoft.com/en-us/cli/azure/release-notes-azure-cli?view=azure-cli-latest). If you encounter any problems, please feel free to report them on [Azure CLI GitHub](https://github.com/Azure/azure-cli/issues).\n\nUpdated Feb 02, 2026\n\nVersion 1.0\n\n[azurecli](/tag/azurecli?nodeId=board%3AAzureToolsBlog)\n\n[!\\[Alex-wdy&#x27;s avatar\\](https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/dS0xNDY3NTU5LTU0MjMxOWk5NEVBOTEwNzFDMjVBOTQw?image-dimensions=50x50)](/users/alex-wdy/1467559) [Alex-wdy](/users/alex-wdy/1467559) ![Icon for Microsoft rank](https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/cmstNC05WEo0blc?image-dimensions=100x16&amp;constrain-image=true)Microsoft\n\nJoined July 26, 2022\n\n[View Profile](/users/alex-wdy/1467559)\n\n/category/azure/blog/azuretoolsblog [Azure Tools Blog](/category/azure/blog/azuretoolsblog) Follow this blog board to get notified when there's new activity",
  "PubDate": "2026-02-04T07:41:52+00:00",
  "Author": "Alex-wdy",
  "OutputDir": "_community",
  "Tags": [],
  "FeedName": "Microsoft Tech Community",
  "Link": "https://techcommunity.microsoft.com/t5/azure-tools-blog/azure-cli-windows-msi-upgrade-issue-root-cause-mitigation-and/ba-p/4491691",
  "ProcessedDate": "2026-02-04 08:09:51",
  "Description": "# Azure CLI on Windows MSI Upgrade Issue\n\n## Summary\n\nAbout six months ago, some Windows users experienced an Azure CLI crash after upgrading via the MSI installer from Azure CLI 2.76.0 (or earlier) to 2.77.0 (or later). The failure occurred immediately on startup with: “ImportError: DLL load failed while importing win32file: The specified module could not be found.” This post explains what happened, why upgrades were affected (while clean installs typically worked), and what you can do to recover.\n\n## Who is affected?\n\n**You are likely affected if:**\n\n- You installed Azure CLI using the Windows MSI installer.\n- You upgraded from Azure CLI 2.76.0 (or earlier) to 2.77.0 (or later) without fully uninstalling first.\n- After the upgrade, any az command fails with the win32file ImportError on startup.\n\n## Symptoms\n\nTypical error output (Azure CLI/Azure PowerShell):\n\nImportError: DLL load failed while importing win32file: The specified module could not be found.\n\n## Immediate recovery\n\n1. Upgrade to the latest version [2.83.0](https://learn.microsoft.com/en-us/cli/azure/install-azure-cli-windows?view=azure-cli-latest&pivots=msi)\n2. If you want to install other versions of Azure CLI, perform a clean reinstall by uninstalling Microsoft Azure CLI from Windows Settings → Apps, deleting any remaining install folder (such as the CLI2 directory), reinstalling the latest Azure CLI using MSI or winget, and then verifying the installation with az --version.\n\n## Root cause analysis\n\nDuring an affected MSI upgrade, the Azure CLI installation directory ended up missing a set of native Python extension files (.pyd files) required by the Windows integration layer. MSI logging showed components being blocked with messages indicating MSI believed the existing (older) key file was “newer” than the incoming one.\n\nThe root cause was an interaction between Windows Installer file versioning rules and a third‑party dependency packaging change. Azure CLI 2.76.0/2.77.0 consumed pywin32 311, whose .pyd binaries were missing Windows version resource metadata. When upgrading from a previous Azure CLI build that contained version-stamped pywin32 binaries (e.g., pywin32 306), MSI could treat the older versioned files as higher priority than the incoming non-versioned files. As a result, MSI could remove the old files during upgrade but skip installing the new ones, leaving the install incomplete.\n\n## Version mapping observed\n\n| Azure CLI version | Python | pywin32 | pywin32 .pyd version resource | | --- | --- | --- | --- | | ≤ 2.75.0 | 3.12 | 306 | Present (e.g., 3.12.306.0) | | 2.76.0 | 3.12 | 311 | Missing / empty | | 2.77.0+ | 3.13 | 311 | Missing / empty |\n\n## If you need to collect MSI logs （for support）\n\nRun the installer with verbose logging （example）:\n\n> >\n> msiexec /i \"azure-cli-2.77.0.msi\" /l\\*vx \"C:\\temp\\azure-cli-install.log\"\n> >\n\n## References\n\n- [https://github.com/Azure/azure-cli/issues/32045#issuecomment-3669161120](https://github.com/Azure/azure-cli/issues/32045#issuecomment-3669161120)\n\n# Windows MSI Upgrade Performance Optimization\n\nThe MSI upgrade process for Azure CLI on Windows has been significantly improved.\n\nPreviously, Windows Installer performed per‑file version comparisons—particularly expensive for Python runtime files—which made upgrades slow and sometimes inconsistent.\n\nWith the new logic, which skips the comparison and performs an overwrite installation. Upgrades now use a streamlined clean‑install process, resulting in faster and more reliable MSI upgrades.\n\n## Performance Improvements\n\n| **Scenario** | **Before** | **After** | **Improvement** | | --- | --- | --- | --- | | **Fresh Install** | Baseline | ~5% faster | **5% faster** | | **Upgrade** | Long due to file-by-file version comparison | ~23% faster | **23% faster** |\n\nThis update makes upgrades noticeably faster and more reliable by removing old files first and skipping slow per‑file version checks.\n\nFor more details, please refer to: [\\[Packaging\\] Optimize MSI upgrade performance by simplifying file replacement logic by wangzelin007 · Pull Request #32678 · Azure/azure-cli](https://github.com/Azure/azure-cli/pull/32678)\n\nWe encourage you to upgrade to the latest version of the Azure CLI. This will not only resolve the issue but also improve installation performance. Here is our [release note](https://learn.microsoft.com/en-us/cli/azure/release-notes-azure-cli?view=azure-cli-latest). If you encounter any problems, please feel free to report them on [Azure CLI GitHub](https://github.com/Azure/azure-cli/issues).",
  "FeedLevelAuthor": "rss.livelink.threads-in-node",
  "Title": "Azure CLI Windows MSI Upgrade Issue: Root Cause, Mitigation, and Performance Improvements"
}
