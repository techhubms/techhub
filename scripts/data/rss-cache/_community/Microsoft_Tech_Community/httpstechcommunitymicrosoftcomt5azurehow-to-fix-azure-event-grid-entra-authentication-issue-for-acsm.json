{
  "PubDate": "2026-02-11T11:41:04+00:00",
  "Author": "ani_ms_emea",
  "Link": "https://techcommunity.microsoft.com/t5/azure/how-to-fix-azure-event-grid-entra-authentication-issue-for-acs/m-p/4494308#M22430",
  "FeedUrl": "https://techcommunity.microsoft.com/t5/s/gxcuf89792/rss/Category?category.id=Azure",
  "FeedLevelAuthor": "rss.livelink.threads-in-node",
  "Title": "How to Fix Azure Event Grid Entra Authentication issue for ACS and Dynamics 365 integrated Webhooks",
  "Description": "#### Introduction:\n\nAzure Event Grid is a powerful event routing service that enables event-driven architectures in Azure. When delivering events to webhook endpoints, security becomes paramount. Microsoft provides a secure webhook delivery mechanism using Microsoft Entra ID (formerly Azure Active Directory) authentication through the AzureEventGridSecureWebhookSubscriber role.\n\n#### Problem Statement:\n\nWhen integrating Azure Communication Services with Dynamics 365 Contact Center using Microsoft Entra ID-authenticated Event Grid webhooks, the Event Grid subscription deployment fails with an error: **\"**HTTP POST request failed with unknown error code**\"** with empty HTTP status and code.\n\nFor example:\n\n![]()\n\n***Important Note:***\n\n*Before moving forward, please verify that you have the Owner role assigned on app to create event subscription. Refer to the Microsoft guidelines below to validate the required prerequisites before proceeding:*\n\n*[Set up incoming calls, call recording, and SMS services | Microsoft Learn](https://learn.microsoft.com/en-us/dynamics365/customer-service/administer/voice-channel-configure-services)*\n\n#### Why This Happens:\n\nThis happens because AzureEventGridSecureWebhookSubscriber role is NOT properly configured on Microsoft EventGrid SP (Service Principal) and event subscription entra ID or application who is trying to create event grid subscription.\n\nWhat is AzureEventGridSecureWebhookSubscriber Role:\n\nThe AzureEventGridSecureWebhookSubscriber is an Azure Entra application role that:\n\n- Enables your application to verify the identity of event senders\n- Allows specific users/applications to create event subscriptions\n- Authorizes Event Grid to deliver events to your webhook\n\nHow It Works:\n\n1. Role Creation: You create this app role in your destination webhook application's Azure Entra registration\n2. Role Assignment: You assign this role to:\n- Microsoft Event Grid service principal (so it can deliver events)\n- Either Entra ID / Entra User or Event subscription creator applications (so they can create event grid subscriptions)\n3. Token Validation: When Event Grid delivers events, it includes an Azure Entra token with this role claim\n4. Authorization Check: Your webhook validates the token and checks for the role\n\nKey Participants:\n\n1. Webhook Application (Your App)\n\n- Purpose: Receives and processes events\n- App Registration: Created in Azure Entra\n- Contains: The AzureEventGridSecureWebhookSubscriber app role\n- Validates: Incoming tokens from Event Grid\n\n1. Microsoft Event Grid Service Principal\n\n- Purpose: Delivers events to webhooks\n- App ID: Different per Azure cloud (Public, Government, etc.)\n- Public Azure: 4962773b-9cdb-44cf-a8bf-237846a00ab7\n- Needs: AzureEventGridSecureWebhookSubscriber role assigned\n\n1. Event Subscription Creator Entra or Application\n\n- Purpose: Creates event subscriptions\n- Could be: You, Your deployment pipeline, admin tool, or another application\n- Needs: AzureEventGridSecureWebhookSubscriber role assigned\n\nAlthough the full PowerShell script is documented in the [Event Grid documentation](http://Although%20the%20full%20PowerShell%20script%20is%20documented%20in%20the%20Event%20Grid%20documentation,%20it%20may%20be%20complex%20to%20interpret%20and%20troubleshoot.%20To%20improve%20accessibility,%20the%20following%20section%20provides%20a%20simplified%20step-by-step%20solution%20along%20with%20verification%20steps%20suitable%20for%20all%20customers.), it may be complex to interpret and troubleshoot.\n\nTo improve accessibility, the following section provides a simplified step-by-step tested solution along with verification steps suitable for all users including non-technical:\n\n#### Steps:\n\n**STEP 1: Verify/Create Microsoft.EventGrid Service Principal**\n\nAzure Portal â†’ Microsoft Entra ID â†’ Enterprise applications\n\nChange filter to Application type: Microsoft Applications\n\nSearch for: Microsoft.EventGrid\n\n![]()\n\nIdeally, your Azure subscription should include this application ID, which is common across all Azure subscriptions: 4962773b-9cdb-44cf-a8bf-237846a00ab7.\n\nIf this application ID is not present, please contact your Azure Cloud Administrator.\n\n**STEP 2: Create the App Role \"AzureEventGridSecureWebhookSubscriber\"**\n\nUsing Azure Portal:\n\n1. Navigate to your Webhook App Registration:\n- Azure Portal â†’ Microsoft Entra ID â†’ App registrations\n- Click All applications\n- Find your app by searching OR use the Object ID you have\n- Click on your app\n2. Create the App Role:\n- Display name: AzureEventGridSecureWebhookSubscriber\n- Allowed member types: Both (Users/Groups + Applications)\n- Value: AzureEventGridSecureWebhookSubscriber\n- Description: Azure Event Grid Role\n- Do you want to enable this app role?: Yes\n- In left menu, click App roles\n- Click + Create app role\n- Fill in the form:\n- Click Apply\n\n**STEP 3: Assign YOUR USER to the Role**\n\nUsing Azure Portal:\n\n1. Switch to Enterprise Application view:\n- Azure Portal â†’ Microsoft Entra ID â†’ Enterprise applications\n- Search for your webhook app (by name)\n- Click on it\n2. Assign yourself:\n- In left menu, click Users and groups\n- Click + Add user/group\n- Under Users, click None Selected\n- Search for your user account (use your email)\n- Select yourself\n- Click Select\n- Under Select a role, click None Selected\n- Select AzureEventGridSecureWebhookSubscriber\n- Click Select\n- Click Assign\n\n**STEP 4: Assign Microsoft.EventGrid Service Principal to the Role**\n\nThis step MUST be done via PowerShell or Azure CLI (Portal doesn't support this directly as we have seen) so PowerShell is recommended\n\nYou will need to execute this step with the help of your Entra admin.\n\n![]()\n\n- # Connect to Microsoft Graph\nConnect-MgGraph -Scopes \"AppRoleAssignment.ReadWrite.All\"\n# Replace this with your webhook app's Application (client) ID\n$webhookAppId = \"YOUR-WEBHOOK-APP-ID-HERE\" #starting with c5\n# Get your webhook app's service principal\n$webhookSP = Get-MgServicePrincipal -Filter \"appId eq '$webhookAppId'\" Write-Host \"âœ“ Found webhook app: $($webhookSP.DisplayName)\"\n# Get Event Grid service principal\n$eventGridSP = Get-MgServicePrincipal -Filter \"appId eq '4962773b-9cdb-44cf-a8bf-237846a00ab7'\" Write-Host \"âœ“ Found Event Grid service principal\"\n# Get the app role\n$appRole = $webhookSP.AppRoles | Where-Object {$\\_.Value -eq \"AzureEventGridSecureWebhookSubscriber\"} Write-Host \"âœ“ Found app role: $($appRole.DisplayName)\"\n# Create the assignment\nNew-MgServicePrincipalAppRoleAssignment ` -ServicePrincipalId $eventGridSP.Id ` -PrincipalId $eventGridSP.Id ` -ResourceId $webhookSP.Id ` -AppRoleId $appRole.Id Write-Host \"Successfully assigned Event Grid to your webhook app!\"\n\n**Verification Steps:**\n\n1. Verify the App Role was created:\n\n- Your App Registration â†’ App roles\n- You should see: AzureEventGridSecureWebhookSubscriber\n\n1. Verify your user assignment:\n\n- Enterprise application (your webhook app) â†’ Users and groups\n- You should see your user with role AzureEventGridSecureWebhookSubscriber\n\n1. Verify Event Grid assignment:\n\n- Same location â†’ Users and groups\n- You should see Microsoft.EventGrid with role AzureEventGridSecureWebhookSubscriber\n\n#### Sample Flow:\n\n![]()\n\n#### Analogy For Simplification:\n\nLets think it similar to the construction site bulding where you are the owner of the building.\n\nBuilding = Azure Entra app (webhook app)\n\nBuilding (Azure Entra App Registration for Webhook) â”œâ”€ Building Name: \"MyWebhook-App\" â”œâ”€ Building Address: Application ID â”œâ”€ Building Owner: You â”œâ”€ Security System: App Roles (the security badges you create) â””â”€ Security Team: Azure Entra and your actual webhook auth code (which validates tokens) like doorman\n\nStep 1: Creat the badge (App role)\n\nYou (the building owner) create a special badge:\n- Badge name: \"AzureEventGridSecureWebhookSubscriber\"\n- Badge color: Let's say it's GOLD\n- Who can have it: Companies (Applications) and People (Users)\n\nThis badge is stored in your building's system (Webhook App Registration)\n\nStep 2: Give badge to the Event Grid Service:\n\nEvent Grid: \"Hey, I need to deliver messages to your building\" You: \"Okay, here's a GOLD badge for your SP\" Event Grid: \\*wears the badge\\*\n\nNow Event Grid can:\n- Show the badge to Azure Entra\n- Get tokens that say \"I have the GOLD badge\"\n- Deliver messages to your webhook\n\nStep 3: Give badge to yourself (or your deployment tool)\n\nYou also need a GOLD badge because:\n\n- You want to create event grid event subscriptions\n\n- Entra checks: \"Does this person have a GOLD badge?\"\n\n- If yes: You can create subscriptions\n\n- If no: \"Access denied\"\n\nYour deployment pipeline also gets a GOLD badge:\n\n- So it can automatically set up event subscriptions during CI/CD deployments\n\n#### Disclaimer:\n\nThe sample scripts provided in this article are provided AS IS without warranty of any kind. The author is not responsible for any issues, damages, or problems that may arise from using these scripts. Users should thoroughly test any implementation in their environment before deploying to production. Azure services and APIs may change over time, which could affect the functionality of the provided scripts. Always refer to the latest Azure documentation for the most up-to-date information.\n\nThanks for reading this blog! I hope you found it helpful and informative for this specific integration use case ðŸ˜€",
  "OutputDir": "_community",
  "EnhancedContent": "#### Introduction:\n\nAzure Event Grid is a powerful event routing service that enables event-driven architectures in Azure. When delivering events to webhook endpoints, security becomes paramount. Microsoft provides a secure webhook delivery mechanism using Microsoft Entra ID (formerly Azure Active Directory) authentication through the AzureEventGridSecureWebhookSubscriber role.\n\n#### Problem Statement:\n\nWhen integrating Azure Communication Services with Dynamics 365 Contact Center using Microsoft Entra ID-authenticated Event Grid webhooks, the Event Grid subscription deployment fails with an error: **\"**HTTP POST request failed with unknown error code**\"** with empty HTTP status and code.\n\nFor example:\n\n***Important Note:***\n\n*Before moving forward, please verify that you have the Owner role assigned on app to create event subscription. Refer to the Microsoft guidelines below to validate the required prerequisites before proceeding:*\n\n*[Set up incoming calls, call recording, and SMS services | Microsoft Learn](https://learn.microsoft.com/en-us/dynamics365/customer-service/administer/voice-channel-configure-services)*\n\n#### Why This Happens:\n\nThis happens because AzureEventGridSecureWebhookSubscriber role is NOT properly configured on Microsoft EventGrid SP (Service Principal) and event subscription entra ID or application who is trying to create event grid subscription.\n\nWhat is AzureEventGridSecureWebhookSubscriber Role:\n\nThe AzureEventGridSecureWebhookSubscriber is an Azure Entra application role that:\n\n- Enables your application to verify the identity of event senders\n- Allows specific users/applications to create event subscriptions\n- Authorizes Event Grid to deliver events to your webhook\n\nHow It Works:\n\n1. Role Creation: You create this app role in your destination webhook application's Azure Entra registration\n2. Role Assignment: You assign this role to:\n- Microsoft Event Grid service principal (so it can deliver events)\n- Either Entra ID / Entra User or Event subscription creator applications (so they can create event grid subscriptions)\n3. Token Validation: When Event Grid delivers events, it includes an Azure Entra token with this role claim\n4. Authorization Check: Your webhook validates the token and checks for the role\n\nKey Participants:\n\n1. Webhook Application (Your App)\n\n- Purpose: Receives and processes events\n- App Registration: Created in Azure Entra\n- Contains: The AzureEventGridSecureWebhookSubscriber app role\n- Validates: Incoming tokens from Event Grid\n\n1. Microsoft Event Grid Service Principal\n\n- Purpose: Delivers events to webhooks\n- App ID: Different per Azure cloud (Public, Government, etc.)\n- Public Azure: 4962773b-9cdb-44cf-a8bf-237846a00ab7\n- Needs: AzureEventGridSecureWebhookSubscriber role assigned\n\n1. Event Subscription Creator Entra or Application\n\n- Purpose: Creates event subscriptions\n- Could be: You, Your deployment pipeline, admin tool, or another application\n- Needs: AzureEventGridSecureWebhookSubscriber role assigned\n\nAlthough the full PowerShell script is documented in the [Event Grid documentation](http://Although%20the%20full%20PowerShell%20script%20is%20documented%20in%20the%20Event%20Grid%20documentation,%20it%20may%20be%20complex%20to%20interpret%20and%20troubleshoot.%20To%20improve%20accessibility,%20the%20following%20section%20provides%20a%20simplified%20step-by-step%20solution%20along%20with%20verification%20steps%20suitable%20for%20all%20customers.), it may be complex to interpret and troubleshoot.\n\nTo improve accessibility, the following section provides a simplified step-by-step tested solution along with verification steps suitable for all users including non-technical:\n\n#### Steps:\n\n**STEP 1: Verify/Create Microsoft.EventGrid Service Principal**\n\nAzure Portal â†’ Microsoft Entra ID â†’ Enterprise applications\n\nChange filter to Application type: Microsoft Applications\n\nSearch for: Microsoft.EventGrid\n\nIdeally, your Azure subscription should include this application ID, which is common across all Azure subscriptions: 4962773b-9cdb-44cf-a8bf-237846a00ab7.\n\nIf this application ID is not present, please contact your Azure Cloud Administrator.\n\n**STEP 2: Create the App Role \"AzureEventGridSecureWebhookSubscriber\"**\n\nUsing Azure Portal:\n\n1. Navigate to your Webhook App Registration:\n- Azure Portal â†’ Microsoft Entra ID â†’ App registrations\n- Click All applications\n- Find your app by searching OR use the Object ID you have\n- Click on your app\n2. Create the App Role:\n- Display name: AzureEventGridSecureWebhookSubscriber\n- Allowed member types: Both (Users/Groups + Applications)\n- Value: AzureEventGridSecureWebhookSubscriber\n- Description: Azure Event Grid Role\n- Do you want to enable this app role?: Yes\n- In left menu, click App roles\n- Click + Create app role\n- Fill in the form:\n- Click Apply\n\n**STEP 3: Assign YOUR USER to the Role**\n\nUsing Azure Portal:\n\n1. Switch to Enterprise Application view:\n- Azure Portal â†’ Microsoft Entra ID â†’ Enterprise applications\n- Search for your webhook app (by name)\n- Click on it\n2. Assign yourself:\n- In left menu, click Users and groups\n- Click + Add user/group\n- Under Users, click None Selected\n- Search for your user account (use your email)\n- Select yourself\n- Click Select\n- Under Select a role, click None Selected\n- Select AzureEventGridSecureWebhookSubscriber\n- Click Select\n- Click Assign\n\n**STEP 4: Assign Microsoft.EventGrid Service Principal to the Role**\n\nThis step MUST be done via PowerShell or Azure CLI (Portal doesn't support this directly as we have seen) so PowerShell is recommended\n\nYou will need to execute this step with the help of your Entra admin.\n\n```\n# Connect to Microsoft Graph\nConnect-MgGraph -Scopes \"AppRoleAssignment.ReadWrite.All\"\n# Replace this with your webhook app's Application (client) ID\n$webhookAppId = \"YOUR-WEBHOOK-APP-ID-HERE\" #starting with c5\n# Get your webhook app's service principal\n$webhookSP = Get-MgServicePrincipal -Filter \"appId eq '$webhookAppId'\" Write-Host \"âœ“ Found webhook app: $($webhookSP.DisplayName)\"\n# Get Event Grid service principal\n$eventGridSP = Get-MgServicePrincipal -Filter \"appId eq '4962773b-9cdb-44cf-a8bf-237846a00ab7'\" Write-Host \"âœ“ Found Event Grid service principal\"\n# Get the app role\n$appRole = $webhookSP.AppRoles | Where-Object {$_.Value -eq \"AzureEventGridSecureWebhookSubscriber\"} Write-Host \"âœ“ Found app role: $($appRole.DisplayName)\"\n# Create the assignment\nNew-MgServicePrincipalAppRoleAssignment ` -ServicePrincipalId $eventGridSP.Id ` -PrincipalId $eventGridSP.Id ` -ResourceId $webhookSP.Id ` -AppRoleId $appRole.Id Write-Host \"Successfully assigned Event Grid to your webhook app!\" ```\n\n**Verification Steps:**\n\n1. Verify the App Role was created:\n\n- Your App Registration â†’ App roles\n- You should see: AzureEventGridSecureWebhookSubscriber\n\n1. Verify your user assignment:\n\n- Enterprise application (your webhook app) â†’ Users and groups\n- You should see your user with role AzureEventGridSecureWebhookSubscriber\n\n1. Verify Event Grid assignment:\n\n- Same location â†’ Users and groups\n- You should see Microsoft.EventGrid with role AzureEventGridSecureWebhookSubscriber\n\n#### Sample Flow:\n\n#### Analogy For Simplification:\n\nLets think it similar to the construction site bulding where you are the owner of the building.\n\nBuilding =Â  Azure Entra app (webhook app)\n\nBuilding (Azure Entra App Registration for Webhook) â”œâ”€ Building Name: \"MyWebhook-App\" â”œâ”€ Building Address: Application ID â”œâ”€ Building Owner: You â”œâ”€ Security System: App Roles (the security badges you create) â””â”€ Security Team: Azure Entra and your actual webhook auth code (which validates tokens) like doorman\n\nStep 1: Creat the badge (App role)\n\nYou (the building owner) create a special badge:\n- Badge name: \"AzureEventGridSecureWebhookSubscriber\"\n- Badge color: Let's say it's GOLD\n- Who can have it: Companies (Applications) and People (Users)\n\nThis badge is stored in your building's system (Webhook App Registration)\n\nStep 2: Give badge to the Event Grid Service:\n\nEvent Grid: \"Hey, I need to deliver messages to your building\" You: \"Okay, here's a GOLD badge for your SP\" Event Grid: \\*wears the badge\\*\n\nNow Event Grid can:\n- Show the badge to Azure Entra\n- Get tokens that say \"I have the GOLD badge\"\n- Deliver messages to your webhook\n\nStep 3: Give badge to yourself (or your deployment tool)\n\nYou also need a GOLD badge because:\n\n- You want to create event grid event subscriptions\n\n- Entra checks: \"Does this person have a GOLD badge?\"\n\n- If yes: You can create subscriptions\n\n- If no: \"Access denied\"\n\nYour deployment pipeline also gets a GOLD badge:\n\n- So it can automatically set up event subscriptions during CI/CD deployments\n\n#### Disclaimer:\n\nThe sample scripts provided in this article are provided AS IS without warranty of any kind. The author is not responsible for any issues, damages, or problems that may arise from using these scripts. Users should thoroughly test any implementation in their environment before deploying to production. Azure services and APIs may change over time, which could affect the functionality of the provided scripts. Always refer to the latest Azure documentation for the most up-to-date information.\n\nThanks for reading this blog! I hope you found it helpful and informative for this specific integration use case ðŸ˜€",
  "FeedName": "Microsoft Tech Community",
  "ProcessedDate": "2026-02-11 12:11:43",
  "Tags": []
}
