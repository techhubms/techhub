{
  "Tags": [],
  "Title": "Build a Custom SSL Certificate Monitor with Azure SRE Agent: From Python Tool to Production Skill",
  "PubDate": "2026-02-20T00:47:40+00:00",
  "FeedLevelAuthor": "rss.livelink.threads-in-node",
  "ProcessedDate": "2026-02-20 01:32:40",
  "EnhancedContent": "## Learn how to build a custom SSL certificate monitoring tool for Azure SRE Agent using Python tools and skills. This tutorial walks through creating a CheckSSLCertificateExpiry Python tool, composing it into a reusable skill, and deploying it as a dedicated SSLCertificateMonitor agent — all through the Azure SRE Agent portal.\n\n## TL;DR\n\nExpired SSL certificates cause outages that are 100% preventable. In this post, you’ll learn how to create a custom Python tool in Azure SRE Agent that checks SSL certificate expiry across your domains, then wrap it in a **skill** that gives your agent a complete certificate health audit workflow. The result: your SRE Agent proactively flags certificates expiring in the next 30 days and recommends renewal actions , before they become 3 AM pages.\n\n## The Problem Every ITOps Team Knows Too Well\n\nIt’s a Tuesday morning. Your monitoring dashboard lights up with alerts: your customer-facing API is returning connection errors. Users are calling. Slack is on fire. After 20 minutes of frantic debugging, someone discovers the root cause: **an SSL certificate expired overnight**.\n\nThis scenario plays out across enterprises every week. According to industry data, certificate-related outages cost an average of **$300,000 per incident** in downtime and remediation. The frustrating part? **Every single one is preventable.**\n\n> >\n> **ITOps teams say:** *“We have spreadsheets for tracking certs, but someone always forgets to update them after a renewal.”*\n> >\n\n> >\n> **On-call engineers say:** *“I spent 20 minutes debugging before realizing it was just an expired certificate.”*\n> >\n\nMost teams rely on a patchwork of solutions , and they all have gaps:\n\n| Current Approach | The Gap | | --- | --- | | Spreadsheets | Go stale , someone forgets to update after renewal | | Calendar reminders | Fire too late , 7 days isn’t enough for compliance review | | Standalone SaaS tools | Don’t integrate with existing incident workflows | | Manual checks | Don’t scale with multi-domain sprawl |\n\n**What if your SRE Agent could check certificate health as part of its regular investigation workflow, and proactively warn you during routine health checks?**\n\n## What We’ll Build\n\nIn this tutorial, you’ll create two things:\n\n1. **A Python Tool** (`CheckSSLCertificateExpiry`\n) , A custom tool that connects to any domain, retrieves its SSL certificate details, and returns structured data about the certificate’s validity, issuer, and days until expiry.\n2. **A Skill** (`ssl_certificate_audit`\n) , A reusable knowledge package that teaches your SRE Agent how to perform a complete certificate health audit across multiple domains, classify risk levels, and recommend actions.\n\nBy the end, your agent will respond to prompts like:\n\n- *“Check the SSL certificates for all our production domains”*\n- *“Are any of our certificates expiring in the next 30 days?”*\n- *“Run a certificate health audit for api.contoso.com, portal.contoso.com, and store.contoso.com”*\n\n*The CheckSSLCertificateExpiry tool in the Azure SRE Agent portal , showing the Python code, parameters, and description.*\n\n## Prerequisites\n\n- An Azure SRE Agent instance deployed in your subscription\n- Access to the Azure SRE Agent portal\n- Basic familiarity with Python and YAML\n\n## Part 1: Creating the Python Tool\n\n### Step 1: Create the Tool in the Portal\n\nNavigate to the **Azure SRE Agent portal**, go to **Settings &gt; Subagent Builder**, and click **Create New Tool**. Select **Python Tool** as the type, enter the name `CheckSSLCertificateExpiry` , and provide the description:\n\n> >\n> *Checks SSL/TLS certificate expiry for a given domain and returns certificate details including days until expiration, issuer, and validity dates.*\n> >\n\nAdd two parameters:\n\n- `domain`\n(string, required): The fully qualified domain name to check (e.g., api.contoso.com)\n- `port`\n(string, optional): The port to connect on (default 443)\n\n### Step 2: Write the Python Code\n\nIn the **Function Code** field, paste the following Python implementation:\n\n``` import ssl import socket import json from datetime import datetime, timezone\n\ndef main(domain, port=\"443\"): \"\"\"Check SSL certificate expiry for a domain.\"\"\" port = int(port) context = ssl.create_default_context()\n\ntry: with socket.create_connection((domain, port), timeout=10) as sock: with context.wrap_socket(sock, server_hostname=domain) as ssock: cert = ssock.getpeercert()\n\nnot_before = datetime.strptime(cert[\"notBefore\"], \"%b %d %H:%M:%S %Y %Z\").replace(tzinfo=timezone.utc) not_after = datetime.strptime(cert[\"notAfter\"], \"%b %d %H:%M:%S %Y %Z\").replace(tzinfo=timezone.utc) now = datetime.now(timezone.utc) days_remaining = (not_after - now).days\n\nissuer = dict(x[0] for x in cert.get(\"issuer\", [])) subject = dict(x[0] for x in cert.get(\"subject\", []))\n\nif days_remaining < 0: risk_level = \"EXPIRED\" elif days_remaining <= 7: risk_level = \"CRITICAL\" elif days_remaining <= 30: risk_level = \"WARNING\" elif days_remaining <= 60: risk_level = \"ATTENTION\" else: risk_level = \"HEALTHY\"\n\nsan_list = [] for entry_type, value in cert.get(\"subjectAltName\", []): if entry_type == \"DNS\": san_list.append(value)\n\nreturn { \"domain\": domain, \"port\": port, \"status\": \"valid\" if days_remaining >= 0 else \"expired\", \"risk_level\": risk_level, \"days_remaining\": days_remaining, \"not_before\": not_before.isoformat(), \"not_after\": not_after.isoformat(), \"issuer\": issuer.get(\"organizationName\", \"Unknown\"), \"issuer_cn\": issuer.get(\"commonName\", \"Unknown\"), \"subject_cn\": subject.get(\"commonName\", domain), \"serial_number\": cert.get(\"serialNumber\", \"Unknown\"), \"version\": cert.get(\"version\", \"Unknown\"), \"san_count\": len(san_list), \"san_domains\": san_list[:10], \"checked_at\": now.isoformat() }\n\nexcept ssl.SSLCertVerificationError as e: return { \"domain\": domain, \"port\": port, \"status\": \"verification_failed\", \"risk_level\": \"CRITICAL\", \"error\": str(e), \"checked_at\": datetime.now(timezone.utc).isoformat() } except (socket.timeout, socket.gaierror, ConnectionRefusedError, OSError) as e: return { \"domain\": domain, \"port\": port, \"status\": \"connection_failed\", \"risk_level\": \"UNKNOWN\", \"error\": str(e), \"checked_at\": datetime.now(timezone.utc).isoformat() } ```\n\n> >\n> **Key Design Decisions:**\n> > >\n> **Structured output** , The tool returns a JSON object with clearly labeled fields so the LLM can compare, sort, and aggregate results across multiple domains.\n> > >\n> **Risk classification** , Five risk levels (EXPIRED, CRITICAL, WARNING, ATTENTION, HEALTHY) give the agent clear thresholds to reason about.\n> > >\n> **Error handling** , Specific exception types return structured error objects rather than crashing, so the agent gets useful information even when a domain is unreachable.\n> > >\n> **Zero dependencies** , Uses only Python standard library (`ssl`\n> , `socket`\n> , `datetime`\n> ) for fast cold starts and no supply chain risk.\n> >\n\n### Step 3: Deploy the Tool\n\nClick **Save** in the tool editor to deploy the tool to your SRE Agent instance. The portal validates the YAML and Python code before saving.\n\n*The Subagent Builder in the Azure SRE Agent portal , showing all deployed subagents, Python tools, and skills at a glance.*\n\n### Step 4: Test the Tool\n\nOpen a new chat thread in the portal, select the **SSLCertificateMonitor** agent, and type: *\"Check the SSL certificate for microsoft.com\"*\n\n*The agent checks microsoft.com and returns real certificate data: valid, healthy, 164 days remaining, issued by Microsoft Azure RSA TLS Issuing CA 04.*\n\n## Part 2: Creating the Skill\n\nA tool gives the agent a **capability**. A skill gives the agent a **methodology**.\n\n> >\n> **Tool**: *“I can check one certificate.”*\n> > >\n> **Skill**: *“Here’s how to audit all your certificates, classify the risks, and tell you exactly what to do about each one.”*\n> >\n\n### What is a Skill?\n\nA skill is a markdown document with YAML frontmatter that contains:\n\n- **Metadata**: name, description, and which tools the skill uses\n- **Instructions**: step-by-step guidance the agent follows when the skill is loaded\n\nThink of it as a **runbook injected into the agent’s context** when relevant.\n\n### Step 1: Create the Skill in the Portal\n\nIn the **Azure SRE Agent portal**, go to **Settings &gt; Subagent Builder** and click **Create New Skill**. You will need to provide the full `SKILL.md` content, which includes both the YAML frontmatter and the markdown instructions.\n\n### Step 2: Write the Skill Document\n\nPaste the following as the complete skill content:\n\n``` --- name: ssl_certificate_audit description: | Load this skill when the user asks about SSL/TLS certificate health, certificate expiry, certificate monitoring, or requests a certificate audit across one or more domains. Trigger phrases: \"check our certificates\", \"are any certs expiring\", \"SSL audit\", \"certificate health check\", \"TLS certificate status\", \"cert renewal needed\". Do NOT load for general security assessments, network connectivity issues unrelated to TLS, or application-level HTTPS errors (use standard troubleshooting for those). tools:\n- CheckSSLCertificateExpiry\n---\n\n# SSL/TLS Certificate Health Audit Skill\n\n## Purpose\n\nPerform a structured certificate health audit across one or more domains: check each certificate, classify risk, aggregate findings, and deliver a prioritized action plan with specific renewal deadlines.\n\n## Scope\n\nFocus ONLY on SSL/TLS certificate validity, expiry, and health. Exclude:\n- Application-level HTTPS configuration issues\n- Cipher suite or TLS version analysis (unless certificate is the root cause)\n- Certificate Authority trust chain debugging (unless verification fails)\n\n## Workflow\n\n### Phase 1: Domain Collection\n\n1. If the user provides specific domains, use those directly.\n2. If the user says \"all our domains\" or \"production domains,\" ask them to list the domains or provide a resource group to discover App Services, Front Doors, or API Management instances with custom domains.\n3. Confirm the domain list before proceeding.\n\n### Phase 2: Certificate Checks\n\n1. Run CheckSSLCertificateExpiry for each domain. Execute checks in parallel when possible.\n2. Collect all results before analysis.\n3. If any domain returns a connection error, note it separately; do not abort the audit.\n\n### Phase 3: Risk Classification and Reporting\n\nClassify each certificate into one of these categories:\n\n| Risk Level | Criteria | Required Action | |------------|----------|-----------------| | EXPIRED | days_remaining < 0 | Immediate renewal, this is causing outages | | CRITICAL | days_remaining <= 7 | Emergency renewal within 24 hours | | WARNING | days_remaining <= 30 | Schedule renewal this sprint | | ATTENTION | days_remaining <= 60 | Add to next renewal cycle | | HEALTHY | days_remaining > 60 | No action needed |\n\n### Phase 4: Summary Report\n\nPresent findings in this order:\n\n1. **Executive Summary** (1-2 sentences): Total domains checked, how many need action.\n2. **Certificates Needing Action** (table): Domain, expiry date, days remaining, risk level, recommended action. Sort by days_remaining ascending (most urgent first).\n3. **Healthy Certificates** (compact list): Domain and expiry date only.\n4. **Unreachable Domains** (if any): Domain and error reason.\n5. **Recommendations**: Specific next steps based on findings.\n\n### Phase 5: Actionable Recommendations\n\nBased on findings, recommend:\n\n- **For EXPIRED or CRITICAL**: \"Renew the certificate for {domain} immediately. If using Azure-managed certificates, check the App Service custom domain binding. If using a third-party CA, initiate the renewal process with {issuer}.\"\n- **For WARNING**: \"Schedule renewal for {domain} (expires {date}). Recommended to renew by {date - 7 days} to allow for propagation and testing.\"\n- **For ATTENTION**: \"Add {domain} to the renewal queue. Certificate expires {date}.\"\n- **For mixed results**: \"Consider implementing automated certificate management (e.g., Azure Key Vault with auto-renewal) to prevent future expiry risks.\"\n\n## Output Format\n\nUse markdown tables for certificate status. Include the checked_at timestamp to establish when the audit was performed. Bold the risk level for EXPIRED and CRITICAL entries.\n\n## Example Output (Condensed)\n\nCertificate Health Audit: 5 domains checked at 2026-02-18T14:30:00Z.\n\n2 certificates need immediate attention; 3 are healthy.\n\n| Domain | Expires | Days Left | Risk | Action | |--------|---------|-----------|------|--------| | api.contoso.com | 2026-02-20 | **2** | **CRITICAL** | Renew within 24 hours | | store.contoso.com | 2026-03-10 | 20 | WARNING | Schedule renewal this sprint | | portal.contoso.com | 2026-06-15 | 117 | HEALTHY | None | | auth.contoso.com | 2026-08-22 | 185 | HEALTHY | None | | cdn.contoso.com | 2026-09-01 | 195 | HEALTHY | None |\n\nRecommendation: Renew api.contoso.com immediately to prevent service disruption. Schedule store.contoso.com renewal by March 3rd.\n\n## Quality Principles\n\n- Check all domains before reporting (don't report one-by-one).\n- Never guess certificate details; only report what the tool returns.\n- Sort urgent items first in all outputs.\n- Include specific dates, not vague timeframes.\n- Align with system prompt: answer first, then evidence.\n```\n\n### Step 3: Deploy the Skill and Configure the Agent\n\nBack in the **Subagent Builder**, create a new subagent called `SSLCertificateMonitor` . In the agent configuration:\n\n1. Add the `CheckSSLCertificateExpiry`\ntool to the agent's tool list\n2. Enable **Allow Parallel Tool Calls** in the agent settings\n3. Click **Save** to deploy the agent\n\nSkills are automatically enabled on every agent, so no additional configuration is needed. The portal will validate and deploy the skill, tool, and agent together.\n\n*The SSLCertificateMonitor subagent in the portal , showing the CheckSSLCertificateExpiry tool, agent instructions, and skills enabled.*\n\n## Part 3: See It in Action\n\nHere’s what happens when you ask the agent to audit four real domains , microsoft.com, azure.com, github.com, and learn.microsoft.com:\n\nOpen a new chat thread in the portal, select the **SSLCertificateMonitor** agent, and type:\n\n> >\n> *\"Run a certificate health audit for microsoft.com, azure.com, github.com, and learn.microsoft.com\"*\n> >\n\n*The agent checks all 4 domains in parallel, classifies github.com as ATTENTION (45 days remaining), and recommends scheduling renewal by March 29, 2026.*\n\nThe agent:\n\n1. ✅ Loaded the `ssl_certificate_audit`\nskill (matched by “certificate health audit”)\n2. ✅ Ran `CheckSSLCertificateExpiry`\nfor all 4 domains in parallel\n3. ✅ Classified github.com as **ATTENTION** (45 days) and the rest as **HEALTHY**\n4. ✅ Produced a prioritized report , action items first, healthy domains second\n5. ✅ Recommended a specific renewal date and suggested Azure Key Vault auto-renewal\n\n> >\n> **Real result**: This audit ran against live production domains and completed in under 25 seconds. The agent correctly identified that github.com’s certificate expires soonest and needs to be added to the renewal cycle.\n> >\n\n### Scenario 1: Morning Certificate Health Check\n\n> >\n> **User**: *“Run a certificate health check across our production domains: api.contoso.com, portal.contoso.com, store.contoso.com, auth.contoso.com, and payments.contoso.com”*\n> >\n\nThe agent:\n\n1. ✅ Loads the `ssl_certificate_audit`\nskill (matched by “certificate health check”)\n2. ✅ Runs `CheckSSLCertificateExpiry`\nfor each domain in parallel\n3. ✅ Classifies each result by risk level\n4. ✅ Delivers a prioritized report with specific action items\n\n### Scenario 2: Discovering Cert Issues During Incident Investigation\n\nDuring a connectivity incident, the agent may use `CheckSSLCertificateExpiry` to check if the certificate has expired , discovering the root cause without the engineer needing to manually check.\n\n### Scenario 3: Cross-Agent Integration\n\nBecause the skill references tools by name, **any agent** with access to `CheckSSLCertificateExpiry` can use it , add it to your triage agent, weekly health-check workflow, or other skills that deal with frontend health.\n\n## How Tools and Skills Work Together\n\n``` ┌──────────────────────────────────────┐ │ Skill │ │ \"ssl_certificate_audit\" │ │ │ │ Methodology: │ │ 1. Collect domains │ │ 2. Check each certificate ─┐ │ │ 3. Classify risk levels │ │ │ 4. Generate report │ │ │ 5. Recommend actions │ │ └──────────────────────────────┼───────┘ │ ▼ ┌──────────────────────────────────────┐ │ Tool │ │ \"CheckSSLCertificateExpiry\" │ │ │ │ Capability: │ │ - Connect to domain:port │ │ - Read SSL certificate │ │ - Return structured cert data │ └──────────────────────────────────────┘ ```\n\n| Concept | Role | Analogy | | --- | --- | --- | | **Tool** | Atomic capability , does one thing, returns data | A stethoscope | | **Skill** | Methodology , combines tools, interprets results, makes decisions | A diagnostic protocol |\n\n## Key Takeaways\n\n**Custom Python tools are first-class citizens** You don’t need to build a microservice or deploy an MCP server. Write a Python function, deploy it through the Azure SRE Agent portal, and it’s immediately available.\n\n**Skills turn tools into expertise** A tool tells the agent what it *can* do. A skill tells the agent what it *should* do and *how*. The audit skill transforms a simple certificate check into a comprehensive capability.\n\n**Start small, iterate fast** Tool creation, skill creation, deployment, and testing , under 30 minutes. Start with one domain check and expand incrementally.\n\n**ITOps value is immediate** Every team has certificates. Every team has been burned by an expired one. Deploy this on day one and prevent the next certificate outage.\n\n*Want to learn more about Azure SRE Agent extensibility? Check out the YAML Schema Reference and the Python Tool documentation.*\n\nUpdated Feb 19, 2026\n\nVersion 1.0\n\n[azure sre agent](/tag/azure%20sre%20agent?nodeId=board%3AAppsonAzureBlog)\n\n[!\\[dbandaru&#x27;s avatar\\](https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/dS0xODc2Mjc5LTU4NDM2OWk2MjcxQjY2RTZCMEQzMDkw?image-dimensions=50x50)](/users/dbandaru/1876279) [dbandaru](/users/dbandaru/1876279) ![Icon for Microsoft rank](https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/cmstNC05WEo0blc?image-dimensions=100x16&amp;constrain-image=true)Microsoft\n\nJoined May 24, 2023\n\n[View Profile](/users/dbandaru/1876279)\n\n/category/azure/blog/appsonazureblog [Apps on Azure Blog](/category/azure/blog/appsonazureblog) Follow this blog board to get notified when there's new activity",
  "Author": "dbandaru",
  "Link": "https://techcommunity.microsoft.com/t5/apps-on-azure-blog/build-a-custom-ssl-certificate-monitor-with-azure-sre-agent-from/ba-p/4495832",
  "Description": "## TL;DR\n\nExpired SSL certificates cause outages that are 100% preventable. In this post, you’ll learn how to create a custom Python tool in Azure SRE Agent that checks SSL certificate expiry across your domains, then wrap it in a **skill** that gives your agent a complete certificate health audit workflow. The result: your SRE Agent proactively flags certificates expiring in the next 30 days and recommends renewal actions , before they become 3 AM pages.\n\n## The Problem Every ITOps Team Knows Too Well\n\nIt’s a Tuesday morning. Your monitoring dashboard lights up with alerts: your customer-facing API is returning connection errors. Users are calling. Slack is on fire. After 20 minutes of frantic debugging, someone discovers the root cause: **an SSL certificate expired overnight**.\n\nThis scenario plays out across enterprises every week. According to industry data, certificate-related outages cost an average of **$300,000 per incident** in downtime and remediation. The frustrating part? **Every single one is preventable.**\n\n> >\n> **ITOps teams say:** *“We have spreadsheets for tracking certs, but someone always forgets to update them after a renewal.”*\n> >\n\n> >\n> **On-call engineers say:** *“I spent 20 minutes debugging before realizing it was just an expired certificate.”*\n> >\n\nMost teams rely on a patchwork of solutions , and they all have gaps:\n\n| Current Approach | The Gap | | --- | --- | | Spreadsheets | Go stale , someone forgets to update after renewal | | Calendar reminders | Fire too late , 7 days isn’t enough for compliance review | | Standalone SaaS tools | Don’t integrate with existing incident workflows | | Manual checks | Don’t scale with multi-domain sprawl |\n\n**What if your SRE Agent could check certificate health as part of its regular investigation workflow, and proactively warn you during routine health checks?**\n\n## What We’ll Build\n\nIn this tutorial, you’ll create two things:\n\n1. **A Python Tool** (`CheckSSLCertificateExpiry`\n) , A custom tool that connects to any domain, retrieves its SSL certificate details, and returns structured data about the certificate’s validity, issuer, and days until expiry.\n2. **A Skill** (`ssl_certificate_audit`\n) , A reusable knowledge package that teaches your SRE Agent how to perform a complete certificate health audit across multiple domains, classify risk levels, and recommend actions.\n\nBy the end, your agent will respond to prompts like:\n\n- *“Check the SSL certificates for all our production domains”*\n- *“Are any of our certificates expiring in the next 30 days?”*\n- *“Run a certificate health audit for api.contoso.com, portal.contoso.com, and store.contoso.com”*\n\n![]()\n\n*The CheckSSLCertificateExpiry tool in the Azure SRE Agent portal , showing the Python code, parameters, and description.*\n\n## Prerequisites\n\n- An Azure SRE Agent instance deployed in your subscription\n- Access to the Azure SRE Agent portal\n- Basic familiarity with Python and YAML\n\n## Part 1: Creating the Python Tool\n\n### Step 1: Create the Tool in the Portal\n\nNavigate to the **Azure SRE Agent portal**, go to **Settings > Subagent Builder**, and click **Create New Tool**. Select **Python Tool** as the type, enter the name `CheckSSLCertificateExpiry` , and provide the description:\n\n> >\n> *Checks SSL/TLS certificate expiry for a given domain and returns certificate details including days until expiration, issuer, and validity dates.*\n> >\n\nAdd two parameters:\n\n- `domain`\n(string, required): The fully qualified domain name to check (e.g., api.contoso.com)\n- `port`\n(string, optional): The port to connect on (default 443)\n\n### Step 2: Write the Python Code\n\nIn the **Function Code** field, paste the following Python implementation:\n\n``` import ssl import socket import json from datetime import datetime, timezone\n\ndef main(domain, port=\"443\"): \"\"\"Check SSL certificate expiry for a domain.\"\"\" port = int(port) context = ssl.create_default_context()\n\ntry: with socket.create_connection((domain, port), timeout=10) as sock: with context.wrap_socket(sock, server_hostname=domain) as ssock: cert = ssock.getpeercert()\n\nnot_before = datetime.strptime(cert[\"notBefore\"], \"%b %d %H:%M:%S %Y %Z\").replace(tzinfo=timezone.utc) not_after = datetime.strptime(cert[\"notAfter\"], \"%b %d %H:%M:%S %Y %Z\").replace(tzinfo=timezone.utc) now = datetime.now(timezone.utc) days_remaining = (not_after - now).days\n\nissuer = dict(x[0] for x in cert.get(\"issuer\", [])) subject = dict(x[0] for x in cert.get(\"subject\", []))\n\nif days_remaining = 0 else \"expired\", \"risk_level\": risk_level, \"days_remaining\": days_remaining, \"not_before\": not_before.isoformat(), \"not_after\": not_after.isoformat(), \"issuer\": issuer.get(\"organizationName\", \"Unknown\"), \"issuer_cn\": issuer.get(\"commonName\", \"Unknown\"), \"subject_cn\": subject.get(\"commonName\", domain), \"serial_number\": cert.get(\"serialNumber\", \"Unknown\"), \"version\": cert.get(\"version\", \"Unknown\"), \"san_count\": len(san_list), \"san_domains\": san_list[:10], \"checked_at\": now.isoformat() }\n\nexcept ssl.SSLCertVerificationError as e: return { \"domain\": domain, \"port\": port, \"status\": \"verification_failed\", \"risk_level\": \"CRITICAL\", \"error\": str(e), \"checked_at\": datetime.now(timezone.utc).isoformat() } except (socket.timeout, socket.gaierror, ConnectionRefusedError, OSError) as e: return { \"domain\": domain, \"port\": port, \"status\": \"connection_failed\", \"risk_level\": \"UNKNOWN\", \"error\": str(e), \"checked_at\": datetime.now(timezone.utc).isoformat() } ```\n\n> >\n> **Key Design Decisions:**\n> > >\n> **Structured output** , The tool returns a JSON object with clearly labeled fields so the LLM can compare, sort, and aggregate results across multiple domains.\n> > >\n> **Risk classification** , Five risk levels (EXPIRED, CRITICAL, WARNING, ATTENTION, HEALTHY) give the agent clear thresholds to reason about.\n> > >\n> **Error handling** , Specific exception types return structured error objects rather than crashing, so the agent gets useful information even when a domain is unreachable.\n> > >\n> **Zero dependencies** , Uses only Python standard library (`ssl`\n> , `socket`\n> , `datetime`\n> ) for fast cold starts and no supply chain risk.\n> >\n\n### Step 3: Deploy the Tool\n\nClick **Save** in the tool editor to deploy the tool to your SRE Agent instance. The portal validates the YAML and Python code before saving.\n\n![]()\n\n*The Subagent Builder in the Azure SRE Agent portal , showing all deployed subagents, Python tools, and skills at a glance.*\n\n### Step 4: Test the Tool\n\nOpen a new chat thread in the portal, select the **SSLCertificateMonitor** agent, and type: *\"Check the SSL certificate for microsoft.com\"*\n\n![]()\n\n*The agent checks microsoft.com and returns real certificate data: valid, healthy, 164 days remaining, issued by Microsoft Azure RSA TLS Issuing CA 04.*\n\n## Part 2: Creating the Skill\n\nA tool gives the agent a **capability**. A skill gives the agent a **methodology**.\n\n> >\n> **Tool**: *“I can check one certificate.”*\n> > >\n> **Skill**: *“Here’s how to audit all your certificates, classify the risks, and tell you exactly what to do about each one.”*\n> >\n\n### What is a Skill?\n\nA skill is a markdown document with YAML frontmatter that contains:\n\n- **Metadata**: name, description, and which tools the skill uses\n- **Instructions**: step-by-step guidance the agent follows when the skill is loaded\n\nThink of it as a **runbook injected into the agent’s context** when relevant.\n\n### Step 1: Create the Skill in the Portal\n\nIn the **Azure SRE Agent portal**, go to **Settings > Subagent Builder** and click **Create New Skill**. You will need to provide the full `SKILL.md` content, which includes both the YAML frontmatter and the markdown instructions.\n\n### Step 2: Write the Skill Document\n\nPaste the following as the complete skill content:\n\n``` --- name: ssl_certificate_audit description: | Load this skill when the user asks about SSL/TLS certificate health, certificate expiry, certificate monitoring, or requests a certificate audit across one or more domains. Trigger phrases: \"check our certificates\", \"are any certs expiring\", \"SSL audit\", \"certificate health check\", \"TLS certificate status\", \"cert renewal needed\". Do NOT load for general security assessments, network connectivity issues unrelated to TLS, or application-level HTTPS errors (use standard troubleshooting for those). tools:\n- CheckSSLCertificateExpiry\n---\n\n# SSL/TLS Certificate Health Audit Skill\n\n## Purpose\n\nPerform a structured certificate health audit across one or more domains: check each certificate, classify risk, aggregate findings, and deliver a prioritized action plan with specific renewal deadlines.\n\n## Scope\n\nFocus ONLY on SSL/TLS certificate validity, expiry, and health. Exclude:\n- Application-level HTTPS configuration issues\n- Cipher suite or TLS version analysis (unless certificate is the root cause)\n- Certificate Authority trust chain debugging (unless verification fails)\n\n## Workflow\n\n### Phase 1: Domain Collection\n\n1. If the user provides specific domains, use those directly.\n2. If the user says \"all our domains\" or \"production domains,\" ask them to list the domains or provide a resource group to discover App Services, Front Doors, or API Management instances with custom domains.\n3. Confirm the domain list before proceeding.\n\n### Phase 2: Certificate Checks\n\n1. Run CheckSSLCertificateExpiry for each domain. Execute checks in parallel when possible.\n2. Collect all results before analysis.\n3. If any domain returns a connection error, note it separately; do not abort the audit.\n\n### Phase 3: Risk Classification and Reporting\n\nClassify each certificate into one of these categories:\n\n| Risk Level | Criteria | Required Action | |------------|----------|-----------------| | EXPIRED | days_remaining 60 | No action needed |\n\n### Phase 4: Summary Report\n\nPresent findings in this order:\n\n1. **Executive Summary** (1-2 sentences): Total domains checked, how many need action.\n2. **Certificates Needing Action** (table): Domain, expiry date, days remaining, risk level, recommended action. Sort by days_remaining ascending (most urgent first).\n3. **Healthy Certificates** (compact list): Domain and expiry date only.\n4. **Unreachable Domains** (if any): Domain and error reason.\n5. **Recommendations**: Specific next steps based on findings.\n\n### Phase 5: Actionable Recommendations\n\nBased on findings, recommend:\n\n- **For EXPIRED or CRITICAL**: \"Renew the certificate for {domain} immediately. If using Azure-managed certificates, check the App Service custom domain binding. If using a third-party CA, initiate the renewal process with {issuer}.\"\n- **For WARNING**: \"Schedule renewal for {domain} (expires {date}). Recommended to renew by {date - 7 days} to allow for propagation and testing.\"\n- **For ATTENTION**: \"Add {domain} to the renewal queue. Certificate expires {date}.\"\n- **For mixed results**: \"Consider implementing automated certificate management (e.g., Azure Key Vault with auto-renewal) to prevent future expiry risks.\"\n\n## Output Format\n\nUse markdown tables for certificate status. Include the checked_at timestamp to establish when the audit was performed. Bold the risk level for EXPIRED and CRITICAL entries.\n\n## Example Output (Condensed)\n\nCertificate Health Audit: 5 domains checked at 2026-02-18T14:30:00Z.\n\n2 certificates need immediate attention; 3 are healthy.\n\n| Domain | Expires | Days Left | Risk | Action | |--------|---------|-----------|------|--------| | api.contoso.com | 2026-02-20 | **2** | **CRITICAL** | Renew within 24 hours | | store.contoso.com | 2026-03-10 | 20 | WARNING | Schedule renewal this sprint | | portal.contoso.com | 2026-06-15 | 117 | HEALTHY | None | | auth.contoso.com | 2026-08-22 | 185 | HEALTHY | None | | cdn.contoso.com | 2026-09-01 | 195 | HEALTHY | None |\n\nRecommendation: Renew api.contoso.com immediately to prevent service disruption. Schedule store.contoso.com renewal by March 3rd.\n\n## Quality Principles\n\n- Check all domains before reporting (don't report one-by-one).\n- Never guess certificate details; only report what the tool returns.\n- Sort urgent items first in all outputs.\n- Include specific dates, not vague timeframes.\n- Align with system prompt: answer first, then evidence.\n```\n\n### Step 3: Deploy the Skill and Configure the Agent\n\nBack in the **Subagent Builder**, create a new subagent called `SSLCertificateMonitor` . In the agent configuration:\n\n1. Add the `CheckSSLCertificateExpiry`\ntool to the agent's tool list\n2. Enable **Allow Parallel Tool Calls** in the agent settings\n3. Click **Save** to deploy the agent\n\nSkills are automatically enabled on every agent, so no additional configuration is needed. The portal will validate and deploy the skill, tool, and agent together.\n\n![]()\n\n*The SSLCertificateMonitor subagent in the portal , showing the CheckSSLCertificateExpiry tool, agent instructions, and skills enabled.*\n\n## Part 3: See It in Action\n\nHere’s what happens when you ask the agent to audit four real domains , microsoft.com, azure.com, github.com, and learn.microsoft.com:\n\nOpen a new chat thread in the portal, select the **SSLCertificateMonitor** agent, and type:\n\n> >\n> *\"Run a certificate health audit for microsoft.com, azure.com, github.com, and learn.microsoft.com\"*\n> >\n\n![]()\n\n*The agent checks all 4 domains in parallel, classifies github.com as ATTENTION (45 days remaining), and recommends scheduling renewal by March 29, 2026.*\n\nThe agent:\n\n1. ✅ Loaded the `ssl_certificate_audit`\nskill (matched by “certificate health audit”)\n2. ✅ Ran `CheckSSLCertificateExpiry`\nfor all 4 domains in parallel\n3. ✅ Classified github.com as **ATTENTION** (45 days) and the rest as **HEALTHY**\n4. ✅ Produced a prioritized report , action items first, healthy domains second\n5. ✅ Recommended a specific renewal date and suggested Azure Key Vault auto-renewal\n\n> >\n> **Real result**: This audit ran against live production domains and completed in under 25 seconds. The agent correctly identified that github.com’s certificate expires soonest and needs to be added to the renewal cycle.\n> >\n\n### Scenario 1: Morning Certificate Health Check\n\n> >\n> **User**: *“Run a certificate health check across our production domains: api.contoso.com, portal.contoso.com, store.contoso.com, auth.contoso.com, and payments.contoso.com”*\n> >\n\nThe agent:\n\n1. ✅ Loads the `ssl_certificate_audit`\nskill (matched by “certificate health check”)\n2. ✅ Runs `CheckSSLCertificateExpiry`\nfor each domain in parallel\n3. ✅ Classifies each result by risk level\n4. ✅ Delivers a prioritized report with specific action items\n\n### Scenario 2: Discovering Cert Issues During Incident Investigation\n\nDuring a connectivity incident, the agent may use `CheckSSLCertificateExpiry` to check if the certificate has expired , discovering the root cause without the engineer needing to manually check.\n\n### Scenario 3: Cross-Agent Integration\n\nBecause the skill references tools by name, **any agent** with access to `CheckSSLCertificateExpiry` can use it , add it to your triage agent, weekly health-check workflow, or other skills that deal with frontend health.\n\n## How Tools and Skills Work Together\n\n``` ┌──────────────────────────────────────┐ │ Skill │ │ \"ssl_certificate_audit\" │ │ │ │ Methodology: │ │ 1. Collect domains │ │ 2. Check each certificate ─┐ │ │ 3. Classify risk levels │ │ │ 4. Generate report │ │ │ 5. Recommend actions │ │ └──────────────────────────────┼───────┘ │ ▼ ┌──────────────────────────────────────┐ │ Tool │ │ \"CheckSSLCertificateExpiry\" │ │ │ │ Capability: │ │ - Connect to domain:port │ │ - Read SSL certificate │ │ - Return structured cert data │ └──────────────────────────────────────┘ ```\n\n| Concept | Role | Analogy | | --- | --- | --- | | **Tool** | Atomic capability , does one thing, returns data | A stethoscope | | **Skill** | Methodology , combines tools, interprets results, makes decisions | A diagnostic protocol |\n\n## Key Takeaways\n\n**Custom Python tools are first-class citizens** You don’t need to build a microservice or deploy an MCP server. Write a Python function, deploy it through the Azure SRE Agent portal, and it’s immediately available.\n\n**Skills turn tools into expertise** A tool tells the agent what it *can* do. A skill tells the agent what it *should* do and *how*. The audit skill transforms a simple certificate check into a comprehensive capability.\n\n**Start small, iterate fast** Tool creation, skill creation, deployment, and testing , under 30 minutes. Start with one domain check and expand incrementally.\n\n**ITOps value is immediate** Every team has certificates. Every team has been burned by an expired one. Deploy this on day one and prevent the next certificate outage.\n\n*Want to learn more about Azure SRE Agent extensibility? Check out the YAML Schema Reference and the Python Tool documentation.*",
  "FeedUrl": "https://techcommunity.microsoft.com/t5/s/gxcuf89792/rss/Category?category.id=Azure",
  "FeedName": "Microsoft Tech Community",
  "OutputDir": "_community"
}
