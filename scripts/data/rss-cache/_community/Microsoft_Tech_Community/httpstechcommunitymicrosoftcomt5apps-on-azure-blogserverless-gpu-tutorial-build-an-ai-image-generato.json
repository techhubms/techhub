{
  "FeedLevelAuthor": "rss.livelink.threads-in-node",
  "Tags": [],
  "ProcessedDate": "2026-02-04 18:17:44",
  "Link": "https://techcommunity.microsoft.com/t5/apps-on-azure-blog/serverless-gpu-tutorial-build-an-ai-image-generator-with-azure/ba-p/4492228",
  "Title": "Serverless GPU Tutorial: Build an AI Image Generator with Azure Functions on Container Apps",
  "FeedUrl": "https://techcommunity.microsoft.com/t5/s/gxcuf89792/rss/Category?category.id=Azure",
  "EnhancedContent": "Ever wanted to create your own AI-powered image generator? In this tutorial, we'll show you how to build one using Azure Functions running on Azure Container Apps with serverless GPUs. The best part? You don't need to worry about managing servers or installing GPU drivers‚ÄîAzure handles all of that for you!\n\nWe're going to create an API that turns text descriptions into images using Stable Diffusion. Send it a prompt like \"a cute robot painting a sunset\" and get back a unique AI-generated image!\n\n## What We're Building\n\nHere's what the final result looks like:\n\n``` POST /api/generate { \"prompt\": \"A friendly robot chef cooking pasta in a cozy kitchen\" }\n\nResponse: { \"success\": true, \"image\": \"base64-encoded-image...\" } ```\n\nThe magic happens inside an Azure Function running on Azure Container Apps with GPU access. When a request comes in:\n\n1. The function receives your text prompt\n2. Stable Diffusion (running on a Tesla T4 GPU) generates the image\n3. You get back a base64-encoded PNG image\n\nThe simple flow: **Your App ‚Üí Azure Function on Container Apps ‚Üí Stable Diffusion (on GPU) ‚Üí Image!**\n\n## Why Azure Functions + GPUs?\n\n- **üöÄ Fast** - NVIDIA T4 GPUs generate images in seconds\n- **üí∞ Cost-effective** - Only pay when generating images (scales to zero!)\n- **üîß Simple** - No GPU drivers or infrastructure to manage\n- **üìà Scalable** - Handles multiple requests automatically\n\n## Before You Start\n\nYou'll need a few things ready:\n\n| What You Need | Why | | --- | --- | | Azure account | Create a [free account](https://azure.microsoft.com/free/) if you don't have one | | GPU access | GPUs require special quota approval. [Request access here](https://aka.ms/aca-gpu-request) - it usually takes a day or two | | Azure CLI | [Download here](https://docs.microsoft.com/cli/azure/install-azure-cli) - this is how we'll deploy everything |\n\n**üí° Tip:** Request GPU access first since it takes time to approve. You can read through this tutorial while waiting!\n\n## Step 1: Get the Code\n\nFirst, grab the sample code from GitHub:\n\n``` git clone https://github.com/Azure-Samples/function-on-aca-gpu.git cd function-on-aca-gpu ```\n\nHere's what's in the project:\n\n``` gpu-function-image-gen/ ‚îú‚îÄ‚îÄ function_app.py # The main code - handles requests and generates images ‚îú‚îÄ‚îÄ requirements.txt # Python packages we need ‚îú‚îÄ‚îÄ Dockerfile # Packages everything into a container ‚îú‚îÄ‚îÄ host.json # Azure Functions settings ‚îî‚îÄ‚îÄ deploy.ps1 # One-click deployment script! ```\n\n## Step 2: Understand the Code\n\nLet's look at the key parts. Don't worry‚Äîit's simpler than it looks!\n\nThe image generation function (function\\_app.py):\n\n``` .route(route=\"generate\", methods=[\"POST\"]) def generate_image(req: func.HttpRequest) -> func.HttpResponse:\n# Get the prompt from the request\nreq_body = req.get_json() prompt = req_body.get('prompt', '')\n\n# Load our AI model (only happens once, then it's cached)\npipe = get_pipeline()\n\n# Generate the image - this is where the GPU magic happens!\nresult = pipe(prompt=prompt, num_inference_steps=25)\n\n# Convert to base64 and send back\nimage = result.images[0]\n# ... encoding logic ...\n\nreturn func.HttpResponse(json.dumps({\"success\": True, \"image\": img_base64})) ```\n\nThat's it! The heavy lifting is done by the diffusers library and the GPU.\n\n## Step 3: Deploy to Azure\n\nYou have three options for deployment:\n\n| Option | Method | Best For | | --- | --- | --- | | **Option A** | Azure Developer CLI (azd up) | Fastest, one-command deployment | | **Option B** | PowerShell/Bash scripts | More control, customizable | | **Option C** | Azure Portal | Learning, visual approach |\n\n#### Option A: Deploy using Azure Developer CLI (azd up) üöÄ\n\nThis is the¬†**fastest and recommended**¬†way to deploy! One command does everything.\n\n**Prerequisites:**\n\n- Install¬†[Azure Developer CLI](https://learn.microsoft.com/azure/developer/azure-developer-cli/install-azd)\n\n**Deploy:**\n\n```\n# Clone the repo\ngit clone https://github.com/Azure-Samples/function-on-aca-gpu.git cd function-on-aca-gpu\n\n# Deploy everything with one command!\nazd up ```\n\nYou'll be prompted for:\n\n- **Environment name**: A unique name for your deployment (e.g.,¬†*gpufunc-dev*)\n- **Azure location**: Select¬†*swedencentral*(has GPU quota)\n- **Azure subscription**: Select your subscription\n\n‚òï Grab a coffee - this takes about 15-20 minutes. The¬†*azd up*¬†command will:\n\n1. Create a resource group (*rg-{environmentName}*)\n2. Set up Log Analytics and Application Insights for monitoring\n3. Create a Container Registry and build your image in the cloud\n4. Create a Storage Account for Azure Functions\n5. Create a Container Apps Environment with GPU workload profile\n6. Deploy your Function App with GPU access\n7. Give you the URL when it's done!\n\nWhen it finishes, you'll see:\n\n``` Deploying services (azd deploy)\n\n(‚úì) Done: Deploying service api\n- Endpoint: https://ca-{envname}.{random}.swedencentral.azurecontainerapps.io/\n\nSUCCESS: Your up workflow to provision and deploy to Azure completed in 20 minutes.\n\n```\n\n**Resources Created:**\n\n| Resource | Name | | --- | --- | | Resource Group | *rg-{environmentName}* | | Log Analytics | *log-{environmentName}* | | Application Insights | *appi-{environmentName}* | | Container Registry | *acr{environmentName}* | | Storage Account | *st{environmentName}* | | Container Apps Environment | *cae-{environmentName}* | | Function App | *ca-{environmentName}* |\n\n**Clean up when done:**\n\n``` azd down ```\n\n### Option B: Deploy Using Command Line üíª\n\nUse our deployment scripts for more control over the deployment process.\n\n**On Windows (PowerShell):**\n\n``` cd function-on-aca-gpu .\\deploy.ps1 ```\n\n**On Mac/Linux:**\n\n``` cd function-on-aca-gpu chmod +x deploy.sh ./deploy.sh ```\n\n**‚òï Grab a coffee** - this takes about 10-15 minutes. The script will:\n\n1. Create a resource group for all our resources\n2. Set up a container registry to store our Docker image\n3. Build and upload the Docker image (no Docker Desktop needed!)\n4. Create a Container Apps environment with GPU support\n5. Deploy the function app\n6. Give you the URL when it's done!\n\nWhen it finishes, you'll see something like:\n\n``` ============================================ üéâ Deployment Complete! ============================================ Function App URL: https://gpu-image-gen-func.jollybay-xxx.swedencentral.azurecontainerapps.io\n\nEndpoints:\n- Generate: https://gpu-image-gen-func.../api/generate\n- Health: https://gpu-image-gen-func.../api/health\n============================================ ```\n\n### Option C: Deploy Using Azure Portal üñ±\n\nIf you prefer clicking through a UI, follow these steps:\n\n#### Part 1: Create a Container Registry\n\n1. Go to the [Azure Portal](https://portal.azure.com/) and search for **Container Registries**\n2. Click **+ Create**\n3. Fill in the details:\n\n| Setting | Value | | --- | --- | | Subscription | Select your subscription | | Resource group | Create new ‚Üí *gpu-functions-rg* | | Registry name | *gpufunctionsacr* (must be globally unique) | | Location | Sweden Central | | SKU | Standard |\n\nClick¬†**Review + create**¬†‚Üí¬†**Create**\n\nüí°¬†**Note:** We'll use system-assigned managed identity for authentication, so no need to enable admin user or save credentials!\n\n#### Part 2: Build and Push the Docker Image\n\nSince we can't build Docker images directly in the portal, use Azure Cloud Shell:\n\n1. Click the **Cloud Shell** icon (&gt;\\_) in the top navigation bar\n2. Choose **Bash**\n3. Navigate to your cloned repo folder (from Step 1) and run:\n\n``` cd function-on-aca-gpu\n\n# Build and push to your registry\naz acr build --registry gpufunctionsacr --image gpu-image-gen:latest --file Dockerfile . ```\n\n#### Part 3: Create a Container Apps Environment with GPU\n\n1. Search for **Container Apps Environments** and click **+ Create**\n2. Fill in the **Basics** tab:\n\n| Setting | Value | | --- | --- | | Subscription | Select your subscription | | Resource group | *gpu-functions-rg* | | Environment name | *gpu-functions-env* | | Region | Sweden Central | | Environment type | Workload profiles |\n\n1. Click **Workload profiles** tab ‚Üí **+ Add workload profile**\n2. Configure the GPU profile:\n\n| Setting | Value | | --- | --- | | Workload profile name | *gpu-profile* | | Workload profile size | Consumption - GPU NC8as-T4 |\n\n1. Click **Add** ‚Üí **Review + create** ‚Üí **Create**\n\n#### Part 4: Create the Container App with Azure Functions\n\n1. Search for **Container Apps** and click **+ Create** ‚Üí **Container App**\n2. Fill in the **Basics** tab:\n\n| Setting | Value | | --- | --- | | Subscription | Select your subscription | | Resource group | *gpu-functions-rg* | | Container app name | *gpu-image-gen-func* | | Optimize for Azure Functions | ‚úÖ Check this box! (This is important - it enables Azure Functions support) | | Region | Sweden Central | | Container Apps Environment | Select *gpu-functions-env* |\n\n1. Click **Next: Container &gt;** and fill in:\n\n| Setting | Value | | --- | --- | | Use quickstart image | ‚ùå Uncheck | | Name | *gpu-image-gen-container* | | Image source | Azure Container Registry | | Registry | *gpufunctionsacr* | | Image | *gpu-image-gen* | | Image tag | *latest* | | Workload profile | *gpu-profile* | | GPU | ‚úÖ Check this box | | Managed Identity | *'System assigned'* |\n\n1. Add environment variables at the bottom of the **Container** tab:\n\n| Name | Value | | --- | --- | | MODEL\\_ID | *runwayml/stable-diffusion-v1-5* | | FUNCTIONS\\_WORKER\\_RUNTIME | *python* |\n\n1. Click **Next: Ingress &gt;** and configure:\n\n| Setting | Value | | --- | --- | | Ingress | ‚úÖ Enabled | | Ingress traffic | Accepting traffic from anywhere | | Target port | *80* |\n\n1. Click **Review + create** ‚Üí **Create**\n\n#### Part 5: Grant ACR Pull Permission to the Container App\n\nAfter the Container App is created, we need to grant it permission to pull images from the registry:\n\n1. Go to your Container App (gpu-image-gen-func) ‚Üí¬†**Identity**¬†(under Settings)\n2. Verify¬†**System assigned**¬†is¬†**On**¬†and note the¬†**Object ID**\n3. Go to your Container Registry (gpufunctionsacr) ‚Üí¬†**Access control (IAM)**\n4. Click¬†**+ Add**¬†‚Üí¬†**Add role assignment**\n5. Select¬†**AcrPull**¬†role ‚Üí Click¬†**Next**\n6. Select¬†**Managed identity**¬†‚Üí Click¬†**+ Select members**\n7. Choose¬†**Container App**¬†and select¬†gpu-image-gen-func\n8. Click¬†**Select**¬†‚Üí¬†**Review + assign**¬†‚Üí¬†**Review + assign**\n\nüí°¬†**Tip:**¬†The first deployment may fail because the identity wasn't ready yet. Simply restart the Container App or create a new revision after granting the role.\n\nüéâ¬†**Done!**¬†Once deployed, find your function URL under¬†**Overview**¬†‚Üí¬†**Application Url**\n\n## Test Your Image Generator! üß™\n\nNow that your function is deployed, let's make sure everything works!\n\n### Check the Health Endpoint\n\nFirst, verify the GPU is available:\n\n``` Invoke-RestMethod -Uri \"https://YOUR-FUNCTION-URL/api/health\" ```\n\nYou should see:\n\n``` { \"status\": \"healthy\", \"gpu_available\": true, \"gpu_info\": { \"name\": \"Tesla T4\", \"memory_total_gb\": 15.56 } } ```\n\nüéâ GPU detected! Now let's generate an image.\n\n### Generate Your First Image\n\n```\n# Create the request\n$body = @{ prompt = \"A happy corgi astronaut floating in space, digital art\" num_steps = 25 } | ConvertTo-Json\n\n# Call the API\n$response = Invoke-RestMethod -Uri \"https://YOUR-FUNCTION-URL/api/generate\" ` -Method POST ` -ContentType \"application/json\" ` -Body $body\n\n# Save the image to a file\n$imageBytes = [Convert]::FromBase64String($response.image) [IO.File]::WriteAllBytes(\"corgi-astronaut.png\", $imageBytes)\n\n# Open it!\nStart-Process \"corgi-astronaut.png\" ```\n\n**‚è±Ô∏è Note:** First request is slow (1-2 minutes) because it downloads the AI model (~5GB). After that, images generate in just a few seconds!\n\n## Customize Your Prompts üé®\n\nPlay around with different prompts! Here are some ideas:\n\n| Prompt | What You Get | | --- | --- | | \"A cozy cabin in a snowy forest, warm lighting\" | Peaceful winter scene | | \"Cyberpunk city at night with neon signs\" | Futuristic cityscape | | \"Watercolor painting of a cat reading a book\" | Artistic cat portrait | | \"Steampunk robot serving tea, detailed\" | Victorian-style robot |\n\n**Pro tips for better results:**\n\n- **Be specific:** \"golden retriever\" works better than just \"dog\"\n- **Add style hints:** \"digital art\", \"oil painting\", \"photograph\"\n- **Describe lighting:** \"sunset\", \"dramatic lighting\", \"soft glow\"\n\n## API Reference\n\nHere's everything you can send to the */api/generate* endpoint:\n\n| Parameter | Type | Default | What It Does | | --- | --- | --- | --- | | prompt | string | required | Describe what you want to see | | negative\\_prompt | string | \"\" | What to avoid (e.g., \"blurry, ugly\") | | num\\_steps | int | 25 | More steps = better quality but slower | | guidance\\_scale | float | 7.5 | Higher = follows prompt more strictly | | width | int | 512 | Image width (keep at 512 for best results) | | height | int | 512 | Image height |\n\nExample with all options:\n\n``` { \"prompt\": \"A magical library with floating books\", \"negative_prompt\": \"blurry, low quality, distorted\", \"num_steps\": 30, \"guidance_scale\": 8.0, \"width\": 512, \"height\": 512 } ```\n\n## Making It Faster ‚ö°\n\nThe first request is slow because of \"cold start\"‚Äîthe container needs to start up and load the AI model. Here's how to speed things up:\n\n### Option 1: Keep One Instance Warm\n\nTell Azure to always keep one container running:\n\n``` az functionapp config set \\ --name gpu-image-gen-func \\ --resource-group gpu-functions-rg \\ --min-replicas 1 ```\n\n**‚ö†Ô∏è Heads up:** This keeps the GPU running 24/7, which costs more. Great for production, but maybe not for testing.\n\n### Option 2: Enable Artifact Streaming\n\nThis makes the container start faster:\n\n``` az acr artifact-streaming update \\ --name gpufunctionsacr \\ --repository gpu-image-gen \\ --enable ```\n\n## What About Costs? üí∞\n\nThis can be very affordable! Here's where to find pricing for each resource:\n\n| Resource | Pricing Info | | --- | --- | | Azure Container Apps (GPU) | [Container Apps Pricing](https://azure.microsoft.com/pricing/details/container-apps/) - GPU workload profiles section | | Azure Container Registry | [ACR Pricing](https://azure.microsoft.com/pricing/details/container-registry/) | | Azure Functions | [Functions Pricing](https://azure.microsoft.com/pricing/details/functions/) - Container Apps hosting |\n\n**Key cost-saving tips:**\n\n- **üí° Set min-replicas to 0 during development** - you only pay when the function is running!\n- **üí° GPU billing is per-second** when containers are active\n- **üí° Scale to zero means $0 when idle** (just wait for cold starts)\n- **üí° Use the [Azure Pricing Calculator](https://azure.microsoft.com/pricing/calculator/)** to estimate your monthly costs\n\n## Troubleshooting üîß\n\n### \"Model failed to load\" error?\n\nSome models require a Hugging Face account. We use *runwayml/stable-diffusion-v1-5* which works without authentication.\n\n### Images look weird?\n\n- Try adding \"blurry, distorted, low quality\" to negative\\_prompt\n- Increase *num\\_steps* to 30 or 40\n\n### Function times out?\n\n- First request can take 2+ minutes. Be patient!\n- Check GPU is available with the */api/health* endpoint\n\n### GPU not detected?\n\n- Make sure GPU quota was approved\n- Verify *gpu-profile* workload profile was created\n\n## What's Next? üöÄ\n\nNow that you have a working image generator, here are some ideas:\n\n- **Build a web UI** - Create a simple HTML page to call your API\n- **Try different models** - Swap to SDXL for higher quality images\n- **Add image-to-image** - Modify existing images with AI\n- **Create a Discord bot** - Let your friends generate images!\n\n## Wrapping Up\n\nYou just built your own AI image generator! üéâ\n\nHere's what we accomplished:\n\n‚úÖ Deployed an Azure Function with GPU support ‚úÖ Set up Stable Diffusion for image generation ‚úÖ Created a simple API anyone can call ‚úÖ Learned how to optimize costs and performance\n\nThe full source code is available at: [github.com/Azure-Samples/function-on-aca-gpu](https://github.com/Azure-Samples/function-on-aca-gpu)\n\nHave questions or built something cool? We'd love to hear about it!\n\n## Resource Clean-up\n\nDon't want to keep paying? Delete everything with one command:\n\n``` az group delete --name gpu-functions-rg --yes ```\n\nThis removes all the resources we created. You can always redeploy later!\n\n## Support and Feedback\n\nThe sample code shared in this blog post is provided as-is for learning and demonstration purposes. While Microsoft provides support for the underlying Azure infrastructure and services (Azure Container Apps, Azure Functions, Azure Container Registry), the sample application code is not a managed solution.\n\nIf you need assistance with Azure services, feel free to open a support request through the Microsoft Azure portal: [New support request - Microsoft Azure](https://portal.azure.com/#blade/Microsoft_Azure_Support/HelpAndSupportBlade/newsupportrequest)\n\nWe value your feedback and suggestions to help us improve this sample. Please feel free to share your thoughts or start a conversation by opening an issue on the [GitHub repository](https://github.com/Azure-Samples/function-on-aca-gpu/issues).\n\n## References\n\n- [Azure Container Apps GPU documentation](https://learn.microsoft.com/azure/container-apps/gpu-support)\n- [Azure Functions on Container Apps](https://learn.microsoft.com/azure/azure-functions/functions-container-apps-hosting)\n- [Stable Diffusion guide](https://huggingface.co/docs/diffusers/using-diffusers/conditional_image_generation)\n- [Sample code on GitHub](https://github.com/Azure-Samples/function-on-aca-gpu)\n\nUpdated Feb 04, 2026\n\nVersion 3.0\n\n[azure container apps](/tag/azure%20container%20apps?nodeId=board%3AAppsonAzureBlog)\n\n[azure functions](/tag/azure%20functions?nodeId=board%3AAppsonAzureBlog)\n\n[serverless](/tag/serverless?nodeId=board%3AAppsonAzureBlog)\n\n[!\\[Nitesh_Jain&#x27;s avatar\\](https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/dS0yNTM1MTUyLWZSbnBaag?image-coordinates=0%2C38%2C383%2C421&amp;image-dimensions=50x50)](/users/nitesh_jain/2535152) [Nitesh_Jain](/users/nitesh_jain/2535152) ![Icon for Microsoft rank](https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/cmstNC05WEo0blc?image-dimensions=100x16&amp;constrain-image=true)Microsoft\n\nJoined June 20, 2024\n\n[View Profile](/users/nitesh_jain/2535152)\n\n/category/azure/blog/appsonazureblog [Apps on Azure Blog](/category/azure/blog/appsonazureblog) Follow this blog board to get notified when there's new activity",
  "OutputDir": "_community",
  "FeedName": "Microsoft Tech Community",
  "PubDate": "2026-02-04T17:43:54+00:00",
  "Author": "Nitesh_Jain",
  "Description": "Ever wanted to create your own AI-powered image generator? In this tutorial, we'll show you how to build one using Azure Functions running on Azure Container Apps with serverless GPUs. The best part? You don't need to worry about managing servers or installing GPU drivers‚ÄîAzure handles all of that for you!\n\nWe're going to create an API that turns text descriptions into images using Stable Diffusion. Send it a prompt like \"a cute robot painting a sunset\" and get back a unique AI-generated image!\n\n## What We're Building\n\nHere's what the final result looks like:\n\n- POST /api/generate\n{ \"prompt\": \"A friendly robot chef cooking pasta in a cozy kitchen\" }\n\nResponse: { \"success\": true, \"image\": \"base64-encoded-image...\" }\n\nThe magic happens inside an Azure Function running on Azure Container Apps with GPU access. When a request comes in:\n\n1. The function receives your text prompt\n2. Stable Diffusion (running on a Tesla T4 GPU) generates the image\n3. You get back a base64-encoded PNG image\n\nThe simple flow: **Your App ‚Üí Azure Function on Container Apps ‚Üí Stable Diffusion (on GPU) ‚Üí Image!**\n\n## Why Azure Functions + GPUs?\n\n- **üöÄ Fast** - NVIDIA T4 GPUs generate images in seconds\n- **üí∞ Cost-effective** - Only pay when generating images (scales to zero!)\n- **üîß Simple** - No GPU drivers or infrastructure to manage\n- **üìà Scalable** - Handles multiple requests automatically\n\n## Before You Start\n\nYou'll need a few things ready:\n\n| What You Need | Why | | --- | --- | | Azure account | Create a [free account](https://azure.microsoft.com/free/) if you don't have one | | GPU access | GPUs require special quota approval. [Request access here](https://aka.ms/aca-gpu-request) - it usually takes a day or two | | Azure CLI | [Download here](https://docs.microsoft.com/cli/azure/install-azure-cli) - this is how we'll deploy everything |\n\n**üí° Tip:** Request GPU access first since it takes time to approve. You can read through this tutorial while waiting!\n\n## Step 1: Get the Code\n\nFirst, grab the sample code from GitHub:\n- git clone https://github.com/Azure-Samples/function-on-aca-gpu.git\ncd function-on-aca-gpu\n\nHere's what's in the project:\n- gpu-function-image-gen/\n‚îú‚îÄ‚îÄ function\\_app.py # The main code - handles requests and generates images ‚îú‚îÄ‚îÄ requirements.txt # Python packages we need ‚îú‚îÄ‚îÄ Dockerfile # Packages everything into a container ‚îú‚îÄ‚îÄ host.json # Azure Functions settings ‚îî‚îÄ‚îÄ deploy.ps1 # One-click deployment script!\n\n## Step 2: Understand the Code\n\nLet's look at the key parts. Don't worry‚Äîit's simpler than it looks!\n\nThe image generation function (function\\_app.py):\n- .route(route=\"generate\", methods=[\"POST\"])\ndef generate\\_image(req: func.HttpRequest) -> func.HttpResponse:\n# Get the prompt from the request\nreq\\_body = req.get\\_json() prompt = req\\_body.get('prompt', '')\n\n# Load our AI model (only happens once, then it's cached)\npipe = get\\_pipeline()\n\n# Generate the image - this is where the GPU magic happens!\nresult = pipe(prompt=prompt, num\\_inference\\_steps=25)\n\n# Convert to base64 and send back\nimage = result.images[0]\n# ... encoding logic ...\n\nreturn func.HttpResponse(json.dumps({\"success\": True, \"image\": img\\_base64}))\n\nThat's it! The heavy lifting is done by the diffusers library and the GPU.\n\n## Step 3: Deploy to Azure\n\nYou have three options for deployment:\n\n| Option | Method | Best For | | --- | --- | --- | | **Option A** | Azure Developer CLI (azd up) | Fastest, one-command deployment | | **Option B** | PowerShell/Bash scripts | More control, customizable | | **Option C** | Azure Portal | Learning, visual approach |\n\n#### Option A: Deploy using Azure Developer CLI (azd up) üöÄ\n\nThis is the **fastest and recommended** way to deploy! One command does everything.\n\n**Prerequisites:**\n\n- Install [Azure Developer CLI](https://learn.microsoft.com/azure/developer/azure-developer-cli/install-azd)\n\n**Deploy:**\n- # Clone the repo\ngit clone https://github.com/Azure-Samples/function-on-aca-gpu.git cd function-on-aca-gpu\n\n# Deploy everything with one command!\nazd up\n\nYou'll be prompted for:\n\n- **Environment name**: A unique name for your deployment (e.g., *gpufunc-dev*)\n- **Azure location**: Select *swedencentral* (has GPU quota)\n- **Azure subscription**: Select your subscription\n\n‚òï Grab a coffee - this takes about 15-20 minutes. The *azd up* command will:\n\n1. Create a resource group (*rg-{environmentName}*)\n2. Set up Log Analytics and Application Insights for monitoring\n3. Create a Container Registry and build your image in the cloud\n4. Create a Storage Account for Azure Functions\n5. Create a Container Apps Environment with GPU workload profile\n6. Deploy your Function App with GPU access\n7. Give you the URL when it's done!\n\nWhen it finishes, you'll see:\n- Deploying services (azd deploy)\n\n(‚úì) Done: Deploying service api\n- Endpoint: https://ca-{envname}.{random}.swedencentral.azurecontainerapps.io/\n\nSUCCESS: Your up workflow to provision and deploy to Azure completed in 20 minutes.\n\n**Resources Created:**\n\n| Resource | Name | | --- | --- | | Resource Group | *rg-{environmentName}* | | Log Analytics | *log-{environmentName}* | | Application Insights | *appi-{environmentName}* | | Container Registry | *acr{environmentName}* | | Storage Account | *st{environmentName}* | | Container Apps Environment | *cae-{environmentName}* | | Function App | *ca-{environmentName}* |\n\n**Clean up when done:**\n- azd down\n\n### Option B: Deploy Using Command Line üíª\n\nUse our deployment scripts for more control over the deployment process.\n\n**On Windows (PowerShell):**\n- cd function-on-aca-gpu\n.\\deploy.ps1\n\n**On Mac/Linux:**\n- cd function-on-aca-gpu\nchmod +x deploy.sh ./deploy.sh\n\n**‚òï Grab a coffee** - this takes about 10-15 minutes. The script will:\n\n1. Create a resource group for all our resources\n2. Set up a container registry to store our Docker image\n3. Build and upload the Docker image (no Docker Desktop needed!)\n4. Create a Container Apps environment with GPU support\n5. Deploy the function app\n6. Give you the URL when it's done!\n\nWhen it finishes, you'll see something like:\n- ============================================\nüéâ Deployment Complete! ============================================ Function App URL: https://gpu-image-gen-func.jollybay-xxx.swedencentral.azurecontainerapps.io\n\nEndpoints:\n- Generate: https://gpu-image-gen-func.../api/generate\n- Health: https://gpu-image-gen-func.../api/health\n============================================\n\n### Option C: Deploy Using Azure Portal üñ±\n\nIf you prefer clicking through a UI, follow these steps:\n\n#### Part 1: Create a Container Registry\n\n1. Go to the [Azure Portal](https://portal.azure.com/) and search for **Container Registries**\n2. Click **+ Create**\n3. Fill in the details:\n\n| Setting | Value | | --- | --- | | Subscription | Select your subscription | | Resource group | Create new ‚Üí *gpu-functions-rg* | | Registry name | *gpufunctionsacr* (must be globally unique) | | Location | Sweden Central | | SKU | Standard |\n\nClick **Review + create** ‚Üí **Create**\n\nüí° **Note:** We'll use system-assigned managed identity for authentication, so no need to enable admin user or save credentials!\n\n#### Part 2: Build and Push the Docker Image\n\nSince we can't build Docker images directly in the portal, use Azure Cloud Shell:\n\n1. Click the **Cloud Shell** icon (>\\_) in the top navigation bar\n2. Choose **Bash**\n3. Navigate to your cloned repo folder (from Step 1) and run:\n- cd function-on-aca-gpu\n\n# Build and push to your registry\naz acr build --registry gpufunctionsacr --image gpu-image-gen:latest --file Dockerfile .\n\n#### Part 3: Create a Container Apps Environment with GPU\n\n1. Search for **Container Apps Environments** and click **+ Create**\n2. Fill in the **Basics** tab:\n\n| Setting | Value | | --- | --- | | Subscription | Select your subscription | | Resource group | *gpu-functions-rg* | | Environment name | *gpu-functions-env* | | Region | Sweden Central | | Environment type | Workload profiles |\n\n1. Click **Workload profiles** tab ‚Üí **+ Add workload profile**\n2. Configure the GPU profile:\n\n| Setting | Value | | --- | --- | | Workload profile name | *gpu-profile* | | Workload profile size | Consumption - GPU NC8as-T4 |\n\n1. Click **Add** ‚Üí **Review + create** ‚Üí **Create**\n\n#### Part 4: Create the Container App with Azure Functions\n\n1. Search for **Container Apps** and click **+ Create** ‚Üí **Container App**\n2. Fill in the **Basics** tab:\n\n| Setting | Value | | --- | --- | | Subscription | Select your subscription | | Resource group | *gpu-functions-rg* | | Container app name | *gpu-image-gen-func* | | Optimize for Azure Functions | ‚úÖ Check this box! (This is important - it enables Azure Functions support) | | Region | Sweden Central | | Container Apps Environment | Select *gpu-functions-env* |\n\n1. Click **Next: Container >** and fill in:\n\n| Setting | Value | | --- | --- | | Use quickstart image | ‚ùå Uncheck | | Name | *gpu-image-gen-container* | | Image source | Azure Container Registry | | Registry | *gpufunctionsacr* | | Image | *gpu-image-gen* | | Image tag | *latest* | | Workload profile | *gpu-profile* | | GPU | ‚úÖ Check this box | | Managed Identity | *'System assigned'* |\n\n1. Add environment variables at the bottom of the **Container** tab:\n\n| Name | Value | | --- | --- | | MODEL\\_ID | *runwayml/stable-diffusion-v1-5* | | FUNCTIONS\\_WORKER\\_RUNTIME | *python* |\n\n1. Click **Next: Ingress >** and configure:\n\n| Setting | Value | | --- | --- | | Ingress | ‚úÖ Enabled | | Ingress traffic | Accepting traffic from anywhere | | Target port | *80* |\n\n1. Click **Review + create** ‚Üí **Create**\n\n#### Part 5: Grant ACR Pull Permission to the Container App\n\nAfter the Container App is created, we need to grant it permission to pull images from the registry:\n\n1. Go to your Container App (gpu-image-gen-func) ‚Üí **Identity** (under Settings)\n2. Verify **System assigned** is **On** and note the **Object ID**\n3. Go to your Container Registry (gpufunctionsacr) ‚Üí **Access control (IAM)**\n4. Click **+ Add** ‚Üí **Add role assignment**\n5. Select **AcrPull** role ‚Üí Click **Next**\n6. Select **Managed identity** ‚Üí Click **+ Select members**\n7. Choose **Container App** and select gpu-image-gen-func\n8. Click **Select** ‚Üí **Review + assign** ‚Üí **Review + assign**\n\nüí° **Tip:** The first deployment may fail because the identity wasn't ready yet. Simply restart the Container App or create a new revision after granting the role.\n\nüéâ **Done!** Once deployed, find your function URL under **Overview** ‚Üí **Application Url**\n\n## Test Your Image Generator! üß™\n\nNow that your function is deployed, let's make sure everything works!\n\n### Check the Health Endpoint\n\nFirst, verify the GPU is available:\n- Invoke-RestMethod -Uri \"https://YOUR-FUNCTION-URL/api/health\"\n\nYou should see:\n- {\n\"status\": \"healthy\", \"gpu\\_available\": true, \"gpu\\_info\": { \"name\": \"Tesla T4\", \"memory\\_total\\_gb\": 15.56 } }\n\nüéâ GPU detected! Now let's generate an image.\n\n### Generate Your First Image\n- # Create the request\n$body = @{ prompt = \"A happy corgi astronaut floating in space, digital art\" num\\_steps = 25 } | ConvertTo-Json\n\n# Call the API\n$response = Invoke-RestMethod -Uri \"https://YOUR-FUNCTION-URL/api/generate\" ` -Method POST ` -ContentType \"application/json\" ` -Body $body\n\n# Save the image to a file\n$imageBytes = [Convert]::FromBase64String($response.image) [IO.File]::WriteAllBytes(\"corgi-astronaut.png\", $imageBytes)\n\n# Open it!\nStart-Process \"corgi-astronaut.png\"\n\n**‚è±Ô∏è Note:** First request is slow (1-2 minutes) because it downloads the AI model (~5GB). After that, images generate in just a few seconds!\n\n## Customize Your Prompts üé®\n\nPlay around with different prompts! Here are some ideas:\n\n| Prompt | What You Get | | --- | --- | | \"A cozy cabin in a snowy forest, warm lighting\" | Peaceful winter scene | | \"Cyberpunk city at night with neon signs\" | Futuristic cityscape | | \"Watercolor painting of a cat reading a book\" | Artistic cat portrait | | \"Steampunk robot serving tea, detailed\" | Victorian-style robot |\n\n**Pro tips for better results:**\n\n- **Be specific:** \"golden retriever\" works better than just \"dog\"\n- **Add style hints:** \"digital art\", \"oil painting\", \"photograph\"\n- **Describe lighting:** \"sunset\", \"dramatic lighting\", \"soft glow\"\n\n## API Reference\n\nHere's everything you can send to the */api/generate* endpoint:\n\n| Parameter | Type | Default | What It Does | | --- | --- | --- | --- | | prompt | string | required | Describe what you want to see | | negative\\_prompt | string | \"\" | What to avoid (e.g., \"blurry, ugly\") | | num\\_steps | int | 25 | More steps = better quality but slower | | guidance\\_scale | float | 7.5 | Higher = follows prompt more strictly | | width | int | 512 | Image width (keep at 512 for best results) | | height | int | 512 | Image height |\n\nExample with all options:\n- {\n\"prompt\": \"A magical library with floating books\", \"negative\\_prompt\": \"blurry, low quality, distorted\", \"num\\_steps\": 30, \"guidance\\_scale\": 8.0, \"width\": 512, \"height\": 512 }\n\n## Making It Faster ‚ö°\n\nThe first request is slow because of \"cold start\"‚Äîthe container needs to start up and load the AI model. Here's how to speed things up:\n\n### Option 1: Keep One Instance Warm\n\nTell Azure to always keep one container running:\n- az functionapp config set \\\n--name gpu-image-gen-func \\ --resource-group gpu-functions-rg \\ --min-replicas 1\n\n**‚ö†Ô∏è Heads up:** This keeps the GPU running 24/7, which costs more. Great for production, but maybe not for testing.\n\n### Option 2: Enable Artifact Streaming\n\nThis makes the container start faster:\n- az acr artifact-streaming update \\\n--name gpufunctionsacr \\ --repository gpu-image-gen \\ --enable\n\n## What About Costs? üí∞\n\nThis can be very affordable! Here's where to find pricing for each resource:\n\n| Resource | Pricing Info | | --- | --- | | Azure Container Apps (GPU) | [Container Apps Pricing](https://azure.microsoft.com/pricing/details/container-apps/) - GPU workload profiles section | | Azure Container Registry | [ACR Pricing](https://azure.microsoft.com/pricing/details/container-registry/) | | Azure Functions | [Functions Pricing](https://azure.microsoft.com/pricing/details/functions/) - Container Apps hosting |\n\n**Key cost-saving tips:**\n\n- **üí° Set min-replicas to 0 during development** - you only pay when the function is running!\n- **üí° GPU billing is per-second** when containers are active\n- **üí° Scale to zero means $0 when idle** (just wait for cold starts)\n- **üí° Use the [Azure Pricing Calculator](https://azure.microsoft.com/pricing/calculator/)** to estimate your monthly costs\n\n## Troubleshooting üîß\n\n### \"Model failed to load\" error?\n\nSome models require a Hugging Face account. We use *runwayml/stable-diffusion-v1-5* which works without authentication.\n\n### Images look weird?\n\n- Try adding \"blurry, distorted, low quality\" to negative\\_prompt\n- Increase *num\\_steps* to 30 or 40\n\n### Function times out?\n\n- First request can take 2+ minutes. Be patient!\n- Check GPU is available with the */api/health* endpoint\n\n### GPU not detected?\n\n- Make sure GPU quota was approved\n- Verify *gpu-profile* workload profile was created\n\n## What's Next? üöÄ\n\nNow that you have a working image generator, here are some ideas:\n\n- **Build a web UI** - Create a simple HTML page to call your API\n- **Try different models** - Swap to SDXL for higher quality images\n- **Add image-to-image** - Modify existing images with AI\n- **Create a Discord bot** - Let your friends generate images!\n\n## Wrapping Up\n\nYou just built your own AI image generator! üéâ\n\nHere's what we accomplished:\n\n‚úÖ Deployed an Azure Function with GPU support ‚úÖ Set up Stable Diffusion for image generation ‚úÖ Created a simple API anyone can call ‚úÖ Learned how to optimize costs and performance\n\nThe full source code is available at: [github.com/Azure-Samples/function-on-aca-gpu](https://github.com/Azure-Samples/function-on-aca-gpu)\n\nHave questions or built something cool? We'd love to hear about it!\n\n## Resource Clean-up\n\nDon't want to keep paying? Delete everything with one command:\n- az group delete --name gpu-functions-rg --yes\n\nThis removes all the resources we created. You can always redeploy later!\n\n## Support and Feedback\n\nThe sample code shared in this blog post is provided as-is for learning and demonstration purposes. While Microsoft provides support for the underlying Azure infrastructure and services (Azure Container Apps, Azure Functions, Azure Container Registry), the sample application code is not a managed solution.\n\nIf you need assistance with Azure services, feel free to open a support request through the Microsoft Azure portal: [New support request - Microsoft Azure](https://portal.azure.com/#blade/Microsoft_Azure_Support/HelpAndSupportBlade/newsupportrequest)\n\nWe value your feedback and suggestions to help us improve this sample. Please feel free to share your thoughts or start a conversation by opening an issue on the [GitHub repository](https://github.com/Azure-Samples/function-on-aca-gpu/issues).\n\n## References\n\n- [Azure Container Apps GPU documentation](https://learn.microsoft.com/azure/container-apps/gpu-support)\n- [Azure Functions on Container Apps](https://learn.microsoft.com/azure/azure-functions/functions-container-apps-hosting)\n- [Stable Diffusion guide](https://huggingface.co/docs/diffusers/using-diffusers/conditional_image_generation)\n- [Sample code on GitHub](https://github.com/Azure-Samples/function-on-aca-gpu)"
}
