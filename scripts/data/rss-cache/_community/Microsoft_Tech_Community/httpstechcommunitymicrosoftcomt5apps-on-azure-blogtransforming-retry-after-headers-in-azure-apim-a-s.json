{
  "Tags": [],
  "FeedName": "Microsoft Tech Community",
  "Author": "pratikpanda",
  "FeedUrl": "https://techcommunity.microsoft.com/t5/s/gxcuf89792/rss/Category?category.id=Azure",
  "EnhancedContent": "In this blog post, you'll learn how to customize the Retry-After response header in Azure API Management (APIM) rate-limiting policies, enhancing your API's flexibility and user experience. While it does not delve into the specifics of the **rate-limit** or **rate-limit-by-key** policies, it provides a practical guide for altering the Retry-After header. For detailed information on the rate-limit policy, please visit [Azure API Management policy reference - rate-limit | Microsoft Learn](https://learn.microsoft.com/en-us/azure/api-management/rate-limit-policy).\n\n# Understanding Rate Limiting: Protecting Your API from Overuse\n\nRate limiting is a technique used to control how often requests are made to a resource. It helps prevent excessive or abusive use and ensures the resource is available to all users.\n\nRate limiting is often used to protect against denial-of-service (DoS) attacks, which aim to overwhelm a network or server with too many requests, making it unavailable to legitimate users. It can also limit the number of requests from individual users to prevent a single user or group from monopolizing the resource.\n\n# Azure API Management Rate Limit Policies\n\nIn Azure, access to APIs is controlled using the following API Management policies:\n\n- rate-limit\n- rate-limit-by-key\n\nThe implementation of these policies is straightforward but somewhat limited and less flexible, in my opinion.\n\n# The Default Retry-After Header: What You Need to Know\n\nIn the Azure APIM rate-limit policy documentation, it is mentioned that once the client's requests are throttled, the service starts returning a response header containing the time interval (in seconds) after which the client should retry the request. The default name of the header is **Retry-After**, and this name can be customized.\n\nFor example: **Retry-After**: 60\n\nHowever, in one use case for a customer, there was a requirement to provide a timestamp instead of a time interval as a header value.\n\nFor example: **Retry-After**: 2020-05-04T12:23:41.6181792Z\n\nTo implement this, the header value needs to change, but this is something that the rate-limit policy does not support.\n\n# Customizing the Retry-After Header\n\nThe basis for changing the response header value lies in the on-error scope. You can implement a policy like the following:\n\n``` <inbound> <base> <rate-limit-by-key calls=\"1000\" renewal-period=\"60\" counter-key=\"@(context.Request.IpAddress)\" increment-condition=\"@(context.Response.StatusCode == 200)\" remaining-calls-variable-name=\"remainingCallsPerIP\" retry-after-header-name=\"Retry-After\" remaining-calls-header-name=\"Requests-Remaining\" retry-after-variable-name=\"retryAfter\"> </rate-limit-by-key></inbound>\n\n```\n\n``` <on-error> <choose> <when condition=\"@(context.LastError.Reason == \" ratelimitexceeded\")\"=\"\"> <set-header name=\"Retry-After\" exists-action=\"override\"> <value>@(DateTime.UtcNow.AddSeconds(context.Variables.GetValueOrDefault<int>(\"retryAfter\")).ToString(\"o\"))</int></value> </set-header> </when> </choose> <base> </on-error>\n\n```\n\nPlease refer to APIM predefined errors for policies here: [Error handling in Azure API Management policies | Microsoft Learn](https://learn.microsoft.com/en-us/azure/api-management/api-management-error-handling-policies#predefined-errors-for-policies)\n\nHere, the key point is that whenever the APIM rate limit is reached, an error occurs, which is then captured in the on-error scope. To set or override the response header only in rate-limiting scenarios, you need to filter using the RateLimitExceeded error reason. After that, the exact error value is determined by adding the current UTC timestamp with the value of the retryAfter variable in seconds.\n\nWith this, you have now customized the Retry-After header with a timestamp instead of a time interval (in seconds).\n\n# Conclusion\n\nIn conclusion, customizing the Retry-After response header in Azure API Management can significantly enhance the flexibility and user experience of your API services. By leveraging the on-error scope and handling the RateLimitExceeded error, you can provide a more informative and user-friendly response to clients when rate limits are exceeded. This approach not only meets specific customer requirements but also demonstrates the adaptability of Azure APIM in handling various scenarios. With these steps, you can ensure that your API remains robust, efficient, and user centric.\n\nPublished Jan 27, 2026\n\nVersion 1.0\n\n[azure api management](/tag/azure%20api%20management?nodeId=board%3AAppsonAzureBlog)\n\n[azure paas](/tag/azure%20paas?nodeId=board%3AAppsonAzureBlog)\n\n[best practices](/tag/best%20practices?nodeId=board%3AAppsonAzureBlog)\n\n[!\\[pratikpanda&#x27;s avatar\\](https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/dS0xMjc0MjQzLTMzOTI1MGk4NTAyREFGNDFEQzkxQTE2?image-dimensions=50x50)](/users/pratikpanda/1274243) [pratikpanda](/users/pratikpanda/1274243) ![Icon for Microsoft rank](https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/cmstNC05WEo0blc?image-dimensions=100x16&amp;constrain-image=true)Microsoft\n\nJoined January 12, 2022\n\n[View Profile](/users/pratikpanda/1274243)\n\n/category/azure/blog/appsonazureblog [Apps on Azure Blog](/category/azure/blog/appsonazureblog) Follow this blog board to get notified when there's new activity",
  "FeedLevelAuthor": "rss.livelink.threads-in-node",
  "Title": "Transforming Retry-After Headers in Azure APIM: A Step-by-Step Guide",
  "Description": "In this blog post, you'll learn how to customize the Retry-After response header in Azure API Management (APIM) rate-limiting policies, enhancing your API's flexibility and user experience. While it does not delve into the specifics of the **rate-limit** or **rate-limit-by-key** policies, it provides a practical guide for altering the Retry-After header. For detailed information on the rate-limit policy, please visit [Azure API Management policy reference - rate-limit | Microsoft Learn](https://learn.microsoft.com/en-us/azure/api-management/rate-limit-policy).\n\n# Understanding Rate Limiting: Protecting Your API from Overuse\n\nRate limiting is a technique used to control how often requests are made to a resource. It helps prevent excessive or abusive use and ensures the resource is available to all users.\n\nRate limiting is often used to protect against denial-of-service (DoS) attacks, which aim to overwhelm a network or server with too many requests, making it unavailable to legitimate users. It can also limit the number of requests from individual users to prevent a single user or group from monopolizing the resource.\n\n# Azure API Management Rate Limit Policies\n\nIn Azure, access to APIs is controlled using the following API Management policies:\n\n- rate-limit\n- rate-limit-by-key\n\nThe implementation of these policies is straightforward but somewhat limited and less flexible, in my opinion.\n\n# The Default Retry-After Header: What You Need to Know\n\nIn the Azure APIM rate-limit policy documentation, it is mentioned that once the client's requests are throttled, the service starts returning a response header containing the time interval (in seconds) after which the client should retry the request. The default name of the header is **Retry-After**, and this name can be customized.\n\nFor example: **Retry-After**: 60\n\nHowever, in one use case for a customer, there was a requirement to provide a timestamp instead of a time interval as a header value.\n\nFor example: **Retry-After**: 2020-05-04T12:23:41.6181792Z\n\nTo implement this, the header value needs to change, but this is something that the rate-limit policy does not support.\n\n# Customizing the Retry-After Header\n\nThe basis for changing the response header value lies in the on-error scope. You can implement a policy like the following:\n\n-\n- @(DateTime.UtcNow.AddSeconds(context.Variables.GetValueOrDefault(\"retryAfter\")).ToString(\"o\"))\n\nPlease refer to APIM predefined errors for policies here: [Error handling in Azure API Management policies | Microsoft Learn](https://learn.microsoft.com/en-us/azure/api-management/api-management-error-handling-policies#predefined-errors-for-policies)\n\nHere, the key point is that whenever the APIM rate limit is reached, an error occurs, which is then captured in the on-error scope. To set or override the response header only in rate-limiting scenarios, you need to filter using the RateLimitExceeded error reason. After that, the exact error value is determined by adding the current UTC timestamp with the value of the retryAfter variable in seconds.\n\nWith this, you have now customized the Retry-After header with a timestamp instead of a time interval (in seconds).\n\n# Conclusion\n\nIn conclusion, customizing the Retry-After response header in Azure API Management can significantly enhance the flexibility and user experience of your API services. By leveraging the on-error scope and handling the RateLimitExceeded error, you can provide a more informative and user-friendly response to clients when rate limits are exceeded. This approach not only meets specific customer requirements but also demonstrates the adaptability of Azure APIM in handling various scenarios. With these steps, you can ensure that your API remains robust, efficient, and user centric.",
  "ProcessedDate": "2026-01-27 15:07:45",
  "PubDate": "2026-01-27T14:18:10+00:00",
  "OutputDir": "_community",
  "Link": "https://techcommunity.microsoft.com/t5/apps-on-azure-blog/transforming-retry-after-headers-in-azure-apim-a-step-by-step/ba-p/4489762"
}
