{
  "EnhancedContent": "## Summary\n\nThe Azure Migrate appliance for physical server discovery fails to complete discovery due to a crash bug in ServerDiscoveryService.exe. The service successfully connects to target servers but crashes during WSMan transport cleanup before any discovery data is collected.\n\n## Environment\n\n- **Appliance OS:** Windows Server 2022 Standard Evaluation (Build 20348)\n- **Appliance Type:** Physical server discovery (script-based installation)\n- **ServerDiscoveryService.exe Version:** 2.0.3300.663\n- **.NET Version:** 8.0.22 (CoreCLR 8.0.2225.52707)\n- **Target Servers:** Windows Server (various) and Linux, all on-premises\n- **Discovery Agent Version:** 2.0.03300.663\n- **Appliance Configuration Manager Version:** 6.1.294.1847\n\n## Symptoms\n\n1. Target server validation succeeds in the appliance configuration manager\n2. CIM sessions connect successfully (logs show \"TestConnection succeeded for CIM Session with HTTP protocol\")\n3. Connections are immediately disposed with \"Disposing all connections when the process is shutdown\"\n4. No discovery data is collected\n5. Azure portal shows error 60001 with misleading \"Could not load file or assembly 'Microsoft.Management.Infrastructure'\" message\n6. Discovery status remains \"Discovery Incomplete\" for all Windows servers\n\n## Root Cause\n\nThe ServerDiscoveryService.exe process crashes repeatedly with an unhandled NullReferenceException in the WSMan transport finalizer. This is visible in the Windows Application Event Log:\n\nApplication: ServerDiscoveryService.exe CoreCLR Version: 8.0.2225.52707 .NET Version: 8.0.22 Description: The process was terminated due to an unhandled exception. Exception Info: System.NullReferenceException: Object reference not set to an instance of an object. at System.Management.Automation.Remoting.Client.BaseClientTransportManager.CloseAsync() at System.Management.Automation.Remoting.Client.WSManClientSessionTransportManager.CloseAsync() at System.Management.Automation.Remoting.Client.BaseClientTransportManager.Finalize()\n\nThe crash also triggers an access violation:\n\nFaulting application name: ServerDiscoveryService.exe, version: 2.0.3300.663 Exception code: 0xc0000005 Faulting application path: C:\\Program Files\\Microsoft Azure Server Discovery Service\\ServerDiscoveryService.exe\n\nThese crashes occur approximately every 10 minutes.\n\n## Troubleshooting Completed\n\n1. **Verified manual connectivity works:** PowerShell Invoke-Command and New-CimSession both succeed from the appliance to target servers using the same credentials\n2. **Verified WinRM configuration:** Targets have WinRM HTTP listener on port 5985, LocalAccountTokenFilterPolicy is set to 1\n3. **Verified assemblies exist:** Microsoft.Management.Infrastructure.dll is present in the GAC on both the appliance and target servers\n4. **Tested both FQDNs and IP addresses:** Same failure occurs with both\n5. **Tested both local and domain credentials:** Same failure with properly formatted credentials (domain\\user)\n6. **Verified time synchronization:** Appliance clock is accurate\n7. **Verified appliance is up to date:** All components show current versions\n8. **Tested with fresh appliance:** Previously tried OVA-based appliance with similar results; rebuilt using Microsoft's PowerShell script installer on clean Server 2022—same issue\n\n## Relevant Log Locations\n\n- C:\\ProgramData\\Microsoft Azure\\Logs\\ConfigManager\\ClientOperations\\_\\*.log - Shows successful CIM connections followed by immediate disposal\n- C:\\ProgramData\\Microsoft Azure\\Logs\\ConfigManager\\ApplianceOnboarding-Portal-\\*.log - Shows error 60000 \"UnhandledException\" with message \"Internal error occured.\" (note: typo is in original)\n- Windows Event Log (Application) - Contains the actual crash stack traces\n\n## Conclusion\n\nThis is a code defect in ServerDiscoveryService.exe—a null reference exception in a finalizer is a programming error that cannot be caused by configuration or environmental factors. The service connects successfully but crashes before completing its work.\n\n## Request\n\nPlease escalate to the Azure Migrate engineering team for a bug fix in ServerDiscoveryService.exe version 2.0.3300.663.",
  "FeedUrl": "https://techcommunity.microsoft.com/t5/s/gxcuf89792/rss/Category?category.id=Azure",
  "Tags": [],
  "Title": "Azure Migrate Physical Server Discovery - ServerDiscoveryService.exe Crash Bug",
  "PubDate": "2026-01-29T02:24:12+00:00",
  "FeedName": "Microsoft Tech Community",
  "Link": "https://techcommunity.microsoft.com/t5/azure-migration-and/azure-migrate-physical-server-discovery-serverdiscoveryservice/m-p/4490238#M733",
  "FeedLevelAuthor": "rss.livelink.threads-in-node",
  "ProcessedDate": "2026-01-29 19:13:06",
  "OutputDir": "_community",
  "Author": "cbrnit",
  "Description": "## Summary\n\nThe Azure Migrate appliance for physical server discovery fails to complete discovery due to a crash bug in ServerDiscoveryService.exe. The service successfully connects to target servers but crashes during WSMan transport cleanup before any discovery data is collected.\n\n## Environment\n\n- **Appliance OS:** Windows Server 2022 Standard Evaluation (Build 20348)\n- **Appliance Type:** Physical server discovery (script-based installation)\n- **ServerDiscoveryService.exe Version:** 2.0.3300.663\n- **.NET Version:** 8.0.22 (CoreCLR 8.0.2225.52707)\n- **Target Servers:** Windows Server (various) and Linux, all on-premises\n- **Discovery Agent Version:** 2.0.03300.663\n- **Appliance Configuration Manager Version:** 6.1.294.1847\n\n## Symptoms\n\n1. Target server validation succeeds in the appliance configuration manager\n2. CIM sessions connect successfully (logs show \"TestConnection succeeded for CIM Session with HTTP protocol\")\n3. Connections are immediately disposed with \"Disposing all connections when the process is shutdown\"\n4. No discovery data is collected\n5. Azure portal shows error 60001 with misleading \"Could not load file or assembly 'Microsoft.Management.Infrastructure'\" message\n6. Discovery status remains \"Discovery Incomplete\" for all Windows servers\n\n## Root Cause\n\nThe ServerDiscoveryService.exe process crashes repeatedly with an unhandled NullReferenceException in the WSMan transport finalizer. This is visible in the Windows Application Event Log:\n\nApplication: ServerDiscoveryService.exe CoreCLR Version: 8.0.2225.52707 .NET Version: 8.0.22 Description: The process was terminated due to an unhandled exception. Exception Info: System.NullReferenceException: Object reference not set to an instance of an object. at System.Management.Automation.Remoting.Client.BaseClientTransportManager.CloseAsync() at System.Management.Automation.Remoting.Client.WSManClientSessionTransportManager.CloseAsync() at System.Management.Automation.Remoting.Client.BaseClientTransportManager.Finalize()\n\nThe crash also triggers an access violation:\n\nFaulting application name: ServerDiscoveryService.exe, version: 2.0.3300.663 Exception code: 0xc0000005 Faulting application path: C:\\Program Files\\Microsoft Azure Server Discovery Service\\ServerDiscoveryService.exe\n\nThese crashes occur approximately every 10 minutes.\n\n## Troubleshooting Completed\n\n1. **Verified manual connectivity works:** PowerShell Invoke-Command and New-CimSession both succeed from the appliance to target servers using the same credentials\n2. **Verified WinRM configuration:** Targets have WinRM HTTP listener on port 5985, LocalAccountTokenFilterPolicy is set to 1\n3. **Verified assemblies exist:** Microsoft.Management.Infrastructure.dll is present in the GAC on both the appliance and target servers\n4. **Tested both FQDNs and IP addresses:** Same failure occurs with both\n5. **Tested both local and domain credentials:** Same failure with properly formatted credentials (domain\\user)\n6. **Verified time synchronization:** Appliance clock is accurate\n7. **Verified appliance is up to date:** All components show current versions\n8. **Tested with fresh appliance:** Previously tried OVA-based appliance with similar results; rebuilt using Microsoft's PowerShell script installer on clean Server 2022—same issue\n\n## Relevant Log Locations\n\n- C:\\ProgramData\\Microsoft Azure\\Logs\\ConfigManager\\ClientOperations\\_\\*.log - Shows successful CIM connections followed by immediate disposal\n- C:\\ProgramData\\Microsoft Azure\\Logs\\ConfigManager\\ApplianceOnboarding-Portal-\\*.log - Shows error 60000 \"UnhandledException\" with message \"Internal error occured.\" (note: typo is in original)\n- Windows Event Log (Application) - Contains the actual crash stack traces\n\n## Conclusion\n\nThis is a code defect in ServerDiscoveryService.exe—a null reference exception in a finalizer is a programming error that cannot be caused by configuration or environmental factors. The service connects successfully but crashes before completing its work.\n\n## Request\n\nPlease escalate to the Azure Migrate engineering team for a bug fix in ServerDiscoveryService.exe version 2.0.3300.663."
}
