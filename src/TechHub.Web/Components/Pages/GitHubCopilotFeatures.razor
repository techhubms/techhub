@page "/github-copilot/features"
@using TechHub.Core.DTOs
@using TechHub.Web.Services
@using TechHub.Web.Components.Shared
@inject TechHubApiClient ApiClient
@inject NavigationManager Navigation
@inject ErrorService ErrorService
@inject ILogger<GitHubCopilotFeatures> Logger

<PageTitle>@(contentItem?.Title ?? "GitHub Copilot Features") - Tech Hub</PageTitle>

@if (sectionData != null && contentItem != null)
{
    <HeadContent>
        <link rel="canonical" href="@($"https://tech.hub.ms{contentItem.Url}")" />
    </HeadContent>

    <PageHeader Section="@sectionData" />

    <div class="page-with-sidebar">
        <aside class="sidebar">
            <SidebarBack BackUrl="/github-copilot" BackText="Back to GitHub Copilot" />
            <SidebarToc HtmlContent="@contentItem.RenderedHtml" />
        </aside>

        <main class="page-main-content">
            <article class="content-detail">
                <header class="content-detail-header">
                    <h1 class="page-h1" tabindex="-1">@contentItem.Title</h1>
                    @if (!string.IsNullOrWhiteSpace(contentItem.Description))
                    {
                        <p class="page-description">@contentItem.Description</p>
                    }
                </header>

                <div class="content-detail-body markdown-content">
                    @((MarkupString)contentItem.RenderedHtml)
                </div>
            </article>
        </main>
    </div>
}

@code {
    private SectionDto? sectionData;
    private ContentItemDetailDto? contentItem;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            sectionData = await ApiClient.GetSectionAsync("github-copilot");
            contentItem = await ApiClient.GetContentDetailAsync("github-copilot", "custom", "github-copilot-features");

            if (sectionData == null || contentItem == null)
            {
                Navigation.NavigateTo("/not-found");
            }
        }
        catch (Exception ex)
        {
            ErrorService.HandleError(ex, Navigation, Logger);
        }
    }
}