@page "/github-copilot/levels-of-enlightenment"
@using TechHub.Core.DTOs
@using TechHub.Web.Services
@using TechHub.Web.Components.Shared
@inject TechHubApiClient ApiClient
@inject NavigationManager Navigation
@inject ErrorService ErrorService
@inject ILogger<GitHubCopilotLevels> Logger

<PageTitle>@(customPage?.Title ?? "GitHub Copilot Levels") - Tech Hub</PageTitle>

@if (sectionData != null && customPage != null)
{
    <HeadContent>
        <link rel="canonical" href="@($"https://tech.hub.ms{customPage.Url}")" />
    </HeadContent>

    <PageHeader Section="@sectionData" />

    <div class="page-with-sidebar">
        <aside class="sidebar">
            <SidebarBack BackUrl="/github-copilot" BackText="Back to GitHub Copilot" />
            <SidebarToc HtmlContent="@customPage.RenderedHtml" />
        </aside>

        <main class="page-main-content">
            <article class="content-detail">
                <header class="content-detail-header">
                    <h1 class="page-h1" tabindex="-1">@customPage.Title</h1>
                    @if (!string.IsNullOrWhiteSpace(customPage.Description))
                    {
                        <p class="page-description">@customPage.Description</p>
                    }
                </header>

                <div class="content-detail-body markdown-content">
                    @((MarkupString)customPage.RenderedHtml)
                </div>
            </article>
        </main>
    </div>
}

@code {
    private SectionDto? sectionData;
    private CustomPageDetailDto? customPage;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            sectionData = await ApiClient.GetSectionAsync("github-copilot");
            customPage = await ApiClient.GetCustomPageAsync("github-copilot-levels");

            if (sectionData == null || customPage == null)
            {
                Navigation.NavigateTo("/not-found");
            }
        }
        catch (Exception ex)
        {
            ErrorService.HandleError(ex, Navigation, Logger);
        }
    }
}