@page "/{sectionName}/{collection}/{itemId}"
@using TechHub.Core.DTOs
@using TechHub.Web.Services
@inject TechHubApiClient ApiClient
@inject NavigationManager Navigation

<PageTitle>@PageTitle - Tech Hub</PageTitle>

<div class="content-page">
    @if (isLoading)
    {
        <div class="loading">
            <p>Loading content...</p>
        </div>
    }
    else if (errorMessage != null)
    {
        <div class="error">
            <h2>Error Loading Content</h2>
            <p>@errorMessage</p>
            <button @onclick="LoadContent">Retry</button>
        </div>
    }
    else if (item != null)
    {
        <nav class="breadcrumb">
            <a href="/">Home</a>
            <span class="separator">/</span>
            <a href="/@SectionName">@SectionName</a>
            <span class="separator">/</span>
            <span>@item.Title</span>
        </nav>

        <ContentDetail Item="@item" />

        <nav class="content-navigation">
            <a href="/@SectionName" class="back-link">‚Üê Back to @SectionName</a>
        </nav>
    }
</div>

@code {
    [Parameter]
    public string SectionName { get; set; } = null!;

    [Parameter]
    public string Collection { get; set; } = null!;

    [Parameter]
    public string ItemId { get; set; } = null!;

    private ContentItemDetailDto? item;
    private bool isLoading = true;
    private string? errorMessage;

    private string PageTitle => item?.Title ?? "Loading...";

    protected override async Task OnInitializedAsync()
    {
        await LoadContent();
    }

    protected override async Task OnParametersSetAsync()
    {
        if (!string.IsNullOrEmpty(SectionName) && !string.IsNullOrEmpty(Collection) && !string.IsNullOrEmpty(ItemId))
        {
            await LoadContent();
        }
    }

    private async Task LoadContent()
    {
        isLoading = true;
        errorMessage = null;
        StateHasChanged(); // Update UI to show loading state
        
        try
        {
            item = await ApiClient.GetContentDetailAsync(SectionName, Collection, ItemId);
        }
        catch (Exception ex)
        {
            errorMessage = $"Failed to load content: {ex.Message}";
        }
        finally
        {
            isLoading = false;
            StateHasChanged(); // Update UI with results or error
        }
    }
}
