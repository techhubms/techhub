@using System.Text.Json
@* Reusable sidebar component for rendering page info from sidebar-info frontmatter *@

@if (SidebarInfo.HasValue)
{
    @if (SidebarInfo.Value.TryGetProperty("sections", out var sections))
    {
        foreach (var section in sections.EnumerateArray())
        {
            <div class="sidebar-section sidebar-metadata">
                @if (section.TryGetProperty("title", out var title))
                {
                    <h3>@title.GetString()</h3>
                }

                @if (section.TryGetProperty("items", out var items))
                {
                    <dl>
                        @foreach (var item in items.EnumerateArray())
                        {
                            @if (item.TryGetProperty("label", out var label))
                            {
                                <dt>@label.GetString()</dt>
                            }
                            @if (item.TryGetProperty("value", out var value))
                            {
                                <dd>@GetValueString(value)</dd>
                            }
                        }
                    </dl>
                }
            </div>
        }
    }
}

@code {
    [Parameter, EditorRequired]
    public required JsonElement? SidebarInfo { get; set; }

    private static string GetValueString(JsonElement value)
    {
        return value.ValueKind switch
        {
            JsonValueKind.String => value.GetString() ?? string.Empty,
            JsonValueKind.Number => value.GetInt32().ToString(),
            JsonValueKind.True => "Yes",
            JsonValueKind.False => "No",
            _ => value.ToString()
        };
    }
}