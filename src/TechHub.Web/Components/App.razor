@using TechHub.Web.Services
@inject FaviconService FaviconService

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <base href="/" />

    <ImportMap />
    <HeadOutlet @rendermode="InteractiveServer" />

    @if (Environment.GetEnvironmentVariable("ASPNETCORE_ENVIRONMENT") == "Development")
    {
        <!-- Development: Individual files for easy debugging -->
        @foreach (var cssFile in TechHub.Web.Configuration.CssFiles.All)
        {
            <link rel="stylesheet" href="@cssFile" />
        }
    }
    else
    {
        <!-- Production: Bundled and minified CSS for optimal performance -->
        <link rel="stylesheet" href="css/bundle.css" />
    }

    <!-- Scoped Component Styles -->
    <link rel="stylesheet" href="@Assets["TechHub.Web.styles.css"]" />

    <!-- Favicon embedded as data URI to eliminate HTTP requests during navigation -->
    <link id="favicon" rel="icon" type="image/x-icon" href="@FaviconService.DataUri" sizes="any" data-permanent />
</head>

<body>
    <Routes @rendermode="InteractiveServer" />
    <ReconnectModal />
    <script src="@Assets["_framework/blazor.web.js"]"></script>

    <!-- Page Timing - Performance monitoring -->
    <script src="@Assets["js/page-timing.js"]"></script>

    <!-- Navigation Helpers - Back to Top and Back to Previous -->
    <!-- Uses @Assets for fingerprinted URL (cache busting). See Configuration/JsFiles.cs -->
    <script src="@Assets["js/nav-helpers.js"]" defer></script>

    <!-- CDN Configuration - bridges C# version management to JavaScript -->
    <!-- CDN versions configured in Configuration/CdnLibraries.cs -->
    <script>
        // CDN Library Configuration - rendered from C# for single source of truth
        // See: Configuration/CdnLibraries.cs
        window.TechHubCDN = {
            highlightJs: {
                version: '@TechHub.Web.Configuration.CdnLibraries.HighlightJs.Version',
                cdnUrl: '@TechHub.Web.Configuration.CdnLibraries.HighlightJs.CdnUrl',
                coreIntegrity: '@TechHub.Web.Configuration.CdnLibraries.HighlightJs.CoreIntegrity',
                themeIntegrity: '@TechHub.Web.Configuration.CdnLibraries.HighlightJs.ThemeIntegrity',
                themeFile: '@TechHub.Web.Configuration.CdnLibraries.HighlightJs.ThemeFile',
                languages: @(new MarkupString(System.Text.Json.JsonSerializer.Serialize(TechHub.Web.Configuration.CdnLibraries.HighlightJs.Languages))),
                thirdPartyLanguages: {
                    terraform: '@TechHub.Web.Configuration.CdnLibraries.HighlightJs.ThirdPartyLanguages.TerraformCdnUrl'
                }
            },
            mermaid: {
                version: '@TechHub.Web.Configuration.CdnLibraries.Mermaid.Version',
                cdnUrl: '@TechHub.Web.Configuration.CdnLibraries.Mermaid.CdnUrl'
            }
        };
    </script>

    <!-- Page Script Initializers - loaded as ES module for lazy-loading support -->
    <!-- Individual Blazor components call initHighlighting/initMermaid/etc. from OnAfterRenderAsync -->
    <script type="module" src="@Assets["js/page-scripts.js"]"></script>
</body>

</html>