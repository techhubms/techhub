@using TechHub.Core.DTOs
@using TechHub.Web.Services
@inject SectionCache SectionCache
@inject NavigationManager Navigation
@implements IDisposable
@rendermode InteractiveServer

<header class="site-header">
    <div class="header-content">
        <a href="/" class="site-logo" aria-label="Tech Hub Home">
            <span class="logo-text">Tech Hub</span>
        </a>
        
        <nav class="main-nav" aria-label="Primary navigation">
            @foreach (var item in SectionCache.Sections.Take(8))
            {
                <a href="/@item.Name" class="nav-link @(IsActiveSection(item.Name) ? "active" : "")">
                    @item.Title
                </a>
            }
            <a href="/about" class="nav-link about-link @(IsActivePage("/about") ? "active" : "")">
                About
            </a>
        </nav>
    </div>
</header>

@code {
    private string currentSection = "";

    protected override void OnInitialized()
    {
        Navigation.LocationChanged += OnLocationChanged;
        UpdateCurrentSection();
    }

    private void OnLocationChanged(object? sender, Microsoft.AspNetCore.Components.Routing.LocationChangedEventArgs e)
    {
        UpdateCurrentSection();
        StateHasChanged();
    }

    private void UpdateCurrentSection()
    {
        var uri = new Uri(Navigation.Uri);
        var path = uri.AbsolutePath.Trim('/');
        
        // Get the first segment - that's our section
        var segments = path.Split('/', StringSplitOptions.RemoveEmptyEntries);
        currentSection = segments.Length > 0 ? segments[0] : "";
    }

    private bool IsActiveSection(string sectionId)
    {
        return string.Equals(currentSection, sectionId, StringComparison.OrdinalIgnoreCase);
    }

    private bool IsActivePage(string path)
    {
        var uri = new Uri(Navigation.Uri);
        return string.Equals(uri.AbsolutePath, path, StringComparison.OrdinalIgnoreCase);
    }

    public void Dispose()
    {
        Navigation.LocationChanged -= OnLocationChanged;
    }
}
