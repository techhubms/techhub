@using TechHub.Core.Models
@using TechHub.Web.Services
@inject SectionCache SectionCache
@inject NavigationManager Navigation
@implements IDisposable

<nav class="main-nav" aria-label="Primary navigation">
    <div class="main-nav-content">
        <a href="/" class="site-logo" aria-label="Tech Hub Home">
            <span class="logo-text">Tech Hub</span>
        </a>

        <div class="nav-links">
            @foreach (var item in SectionCache.Sections)
            {
                <a href="/@item.Name" class="nav-link @(IsActiveSection(item.Name) ? "active" : "")">
                    @item.Title
                </a>
            }
            <a href="/about" class="nav-link about-link @(IsActivePage("/about") ? "active" : "")">
                About
            </a>
        </div>
    </div>
</nav>

@code {
    protected override void OnInitialized()
    {
        Navigation.LocationChanged += OnLocationChanged;
    }

    private async void OnLocationChanged(object? sender, Microsoft.AspNetCore.Components.Routing.LocationChangedEventArgs e)
    {
        await InvokeAsync(StateHasChanged);
    }

    private string GetCurrentSection()
    {
        var uri = new Uri(Navigation.Uri);
        var path = uri.AbsolutePath.Trim('/');
        var segments = path.Split('/', StringSplitOptions.RemoveEmptyEntries);
        return segments.Length > 0 ? segments[0] : "";
    }

    private bool IsActiveSection(string sectionId)
    {
        return string.Equals(GetCurrentSection(), sectionId, StringComparison.OrdinalIgnoreCase);
    }

    private bool IsActivePage(string path)
    {
        var uri = new Uri(Navigation.Uri);
        return string.Equals(uri.AbsolutePath, path, StringComparison.OrdinalIgnoreCase);
    }

    public void Dispose()
    {
        Navigation.LocationChanged -= OnLocationChanged;
    }
}