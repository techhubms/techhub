@using TechHub.Core.DTOs
@inject NavigationManager Navigation
@rendermode InteractiveServer

<nav class="collection-nav">
    <h2>Collections</h2>
    
    @if (Section?.Collections != null && Section.Collections.Any())
    {
        <ul>
            <li>
                <button @onclick="@(() => OnCollectionSelected("all"))" 
                        class="@(SelectedCollection == "all" ? "active" : "")"
                        disabled="@IsLoadingContent">
                    All
                </button>
            </li>
            @foreach (var collection in RegularCollections)
            {
                var collectionName = collection.Name;
                <li>
                    <button @onclick="() => OnCollectionSelected(collectionName)" 
                            class="@(SelectedCollection == collectionName ? "active" : "")"
                            disabled="@IsLoadingContent">
                        @collection.Title
                    </button>
                </li>
            }
        </ul>
        
        @if (CustomPages.Any())
        {
            <h3>Pages</h3>
            <ul>
                @foreach (var customPage in CustomPages)
                {
                    <li>
                        <a href="@customPage.Url" class="custom-page-link">
                            @customPage.Title
                        </a>
                    </li>
                }
            </ul>
        }
    }
</nav>

@code {
    [Parameter, EditorRequired]
    public required SectionDto Section { get; set; }

    [Parameter]
    public string SelectedCollection { get; set; } = "all";

    [Parameter]
    public bool IsLoadingContent { get; set; }

    [Parameter]
    public EventCallback<string> OnCollectionChange { get; set; }
    
    private IEnumerable<CollectionReferenceDto> RegularCollections => 
        Section?.Collections.Where(c => !c.IsCustom) ?? Enumerable.Empty<CollectionReferenceDto>();
    
    private IEnumerable<CollectionReferenceDto> CustomPages => 
        Section?.Collections.Where(c => c.IsCustom) ?? Enumerable.Empty<CollectionReferenceDto>();

    private async Task OnCollectionSelected(string collectionName)
    {
        Navigation.NavigateTo($"/{Section.Name}/{collectionName}", forceLoad: true);
        await OnCollectionChange.InvokeAsync(collectionName);
    }
}
