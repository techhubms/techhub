@using TechHub.Core.DTOs
@inject NavigationManager Navigation
@rendermode InteractiveServer

<nav class="collection-nav">
    <h2>Collections</h2>
    
    @if (Section?.Collections != null && Section.Collections.Any())
    {
        <ul>
            <li>
                <button @onclick="@(() => OnCollectionSelected("all"))" 
                        class="@(SelectedCollection == "all" ? "active" : "")"
                        disabled="@IsLoadingContent">
                    All
                </button>
            </li>
            @foreach (var collection in Section.Collections)
            {
                var collectionName = collection.Name;
                <li>
                    <button @onclick="() => OnCollectionSelected(collectionName)" 
                            class="@(SelectedCollection == collectionName ? "active" : "")"
                            disabled="@IsLoadingContent">
                        @collection.Title
                    </button>
                </li>
            }
        </ul>
    }
</nav>

@code {
    [Parameter, EditorRequired]
    public required SectionDto Section { get; set; }

    [Parameter]
    public string SelectedCollection { get; set; } = "all";

    [Parameter]
    public bool IsLoadingContent { get; set; }

    [Parameter]
    public EventCallback<string> OnCollectionChange { get; set; }

    private async Task OnCollectionSelected(string collectionName)
    {
        // Navigate to new URL with full page reload (forceLoad: true)
        // This is required because Section.razor uses static SSR and won't receive
        // parameter updates from client-side navigation. Full reload ensures
        // OnParametersSetAsync is called with new CollectionName parameter.
        Navigation.NavigateTo($"/{Section.Name}/{collectionName}", forceLoad: true);
        
        // Notify parent component
        await OnCollectionChange.InvokeAsync(collectionName);
    }
}
