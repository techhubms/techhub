@using TechHub.Core.DTOs
@using Microsoft.JSInterop
@inject IJSRuntime JS

<nav class="collection-nav">
    <h2>Collections</h2>
    
    @if (Section?.Collections != null && Section.Collections.Any())
    {
        <ul>
            <li>
                <button @onclick="@(() => OnCollectionSelected("all"))" 
                        class="@(SelectedCollection == "all" ? "active" : "")"
                        disabled="@IsLoadingContent">
                    Everything
                </button>
            </li>
            @foreach (var collection in Section.Collections)
            {
                var collectionName = collection.Name;
                <li>
                    <button @onclick="() => OnCollectionSelected(collectionName)" 
                            class="@(SelectedCollection == collectionName ? "active" : "")"
                            disabled="@IsLoadingContent">
                        @collection.Title
                    </button>
                </li>
            }
        </ul>
    }
</nav>

@code {
    [Parameter, EditorRequired]
    public required SectionDto Section { get; set; }

    [Parameter]
    public string SelectedCollection { get; set; } = "all";

    [Parameter]
    public bool IsLoadingContent { get; set; }

    [Parameter]
    public EventCallback<string> OnCollectionChange { get; set; }

    private async Task OnCollectionSelected(string collectionName)
    {
        // Update URL using JavaScript history API
        if (JS != null)
        {
            await JS.InvokeVoidAsync("history.pushState", null, "", $"/{Section.Name}/{collectionName}");
        }
        
        // Notify parent component
        await OnCollectionChange.InvokeAsync(collectionName);
    }
}
