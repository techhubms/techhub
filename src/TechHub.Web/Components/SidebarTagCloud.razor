@using TechHub.Core.Models
@rendermode @(new InteractiveServerRenderMode(prerender: true))

@* Tag cloud component for sidebar filtering *@
<nav class="sidebar-section" aria-label="Filter by tags">
    <h2 class="sidebar-h2">@Title</h2>

    @if (_isLoading)
    {
        @* Skeleton loader - subtle placeholder during initial load *@
        <div class="tag-cloud" aria-label="Loading tags">
            @for (int i = 0; i < 20; i++)
            {
                <span class="tag-cloud-skeleton"></span>
            }
        </div>
    }
    else if (_hasError)
    {
        <p class="sidebar-text error">Error loading tags</p>
    }
    else if (_tags != null && _tags.Count > 0)
    {
        <div class="tag-cloud">
            @foreach (var tagItem in _tags)
            {
                var sizeClass = tagItem.Size switch
                {
                    TagSize.Large => "tag-size-large",
                    TagSize.Medium => "tag-size-medium",
                    TagSize.Small => "tag-size-small",
                    _ => ""
                };

                var isSelected = _selectedTagsInternal.Contains(tagItem.Tag.Trim().ToLowerInvariant());
                var isDisabled = tagItem.Count == 0;
                var cssClass = $"tag-cloud-item {sizeClass} {(isSelected ? "selected" : "")} {(isDisabled ? "disabled" : "")}".Trim();

                @if (isDisabled)
                {
                    <button type="button" 
                            class="@cssClass" 
                            disabled="true"
                            aria-disabled="true">
                        @tagItem.Tag (@tagItem.Count.ToString("N0"))
                    </button>
                }
                else
                {
                    <button type="button" 
                            class="@cssClass" 
                            @onclick="() => HandleTagClick(tagItem.Tag)"
                            aria-disabled="false">
                        @tagItem.Tag (@tagItem.Count.ToString("N0"))
                    </button>
                }
            }
        </div>
    }
    else
    {
        <p class="sidebar-text">No tags available</p>
    }
</nav>