@using TechHub.Core.DTOs

<a href="@Item.GetHref()"
   class="content-item-card"
   target="@Item.GetTarget()"
   rel="@Item.GetRel()"
   data-enhance-nav="@Item.GetDataEnhanceNav()"
   aria-label="@Item.GetAriaLabel()">
    <div class="card-content">
        <div class="content-header">
            <h3 class="content-title">@Item.Title</h3>
            <div class="content-meta">
                <time datetime="@Item.DateIso">@FormatDate(Item.DateEpoch)</time>
                @if (!string.IsNullOrWhiteSpace(Item.Author))
                {
                    <span class="content-author">by @Item.Author</span>
                }
            </div>
        </div>

        @if (!string.IsNullOrWhiteSpace(Item.Excerpt))
        {
            <div class="content-excerpt">
                @((MarkupString)Item.Excerpt)
            </div>
        }

        @if (Item.Tags.Any() || (ShowCollectionBadge && !string.IsNullOrWhiteSpace(Item.CollectionName)))
        {
            <div class="content-tags" @onclick:preventDefault @onclick:stopPropagation>
                @foreach (var tag in Item.Tags.Take(5))
                {
                    <span class="content-item-card-tag">@tag</span>
                }
                @if (Item.Tags.Count > 5)
                {
                    <span class="content-item-card-tag-more">+@(Item.Tags.Count - 5) more</span>
                }
                @if (ShowCollectionBadge && !string.IsNullOrWhiteSpace(Item.CollectionName))
                {
                    <span class="collection-badge-white">@CapitalizeCollection(Item.CollectionName)</span>
                }
            </div>
        }
    </div>
</a>

@code {
    [Parameter, EditorRequired]
    public ContentItemDto Item { get; set; } = null!;

    [Parameter]
    public bool ShowCollectionBadge { get; set; } = true;

    [Parameter]
    public bool ShowSectionName { get; set; } = true;

    private string FormatDate(long epochSeconds)
    {
        var dateTime = DateTimeOffset.FromUnixTimeSeconds(epochSeconds);
        var now = DateTimeOffset.UtcNow;
        var diff = now - dateTime;

        if (diff.TotalDays < 1)
            return "Today";
        if (diff.TotalDays < 2)
            return "Yesterday";
        if (diff.TotalDays < 7)
            return $"{(int)diff.TotalDays} days ago";
        if (diff.TotalDays < 30)
            return $"{(int)(diff.TotalDays / 7)} weeks ago";

        return dateTime.ToString("MMM d, yyyy");
    }

    private string CapitalizeCollection(string collection)
    {
        if (string.IsNullOrWhiteSpace(collection))
            return collection;

        // Capitalize first letter of each word
        return System.Globalization.CultureInfo.CurrentCulture.TextInfo.ToTitleCase(collection.ToLower());
    }
}