@using TechHub.Core.DTOs

<article class="content-item-card">
    <div class="content-header">
        <h3 class="content-title">
            <a href="@Item.Url">@Item.Title</a>
        </h3>
        <div class="content-meta">
            <time datetime="@Item.DateIso">@FormatDate(Item.DateEpoch)</time>
            @if (!string.IsNullOrWhiteSpace(Item.Author))
            {
                <span class="content-author">by @Item.Author</span>
            }
        </div>
    </div>
    
    @if (!string.IsNullOrWhiteSpace(Item.Excerpt))
    {
        <div class="content-excerpt">
            @((MarkupString)Item.Excerpt)
        </div>
    }
    else if (!string.IsNullOrWhiteSpace(Item.Description))
    {
        <p class="content-description">@Item.Description</p>
    }
    
    @if (Item.Tags.Any())
    {
        <div class="content-tags">
            @foreach (var tag in Item.Tags.Take(5))
            {
                <span class="tag">@tag</span>
            }
            @if (Item.Tags.Count > 5)
            {
                <span class="tag-more">+@(Item.Tags.Count - 5) more</span>
            }
        </div>
    }
    
    <div class="content-footer">
        <span class="collection-badge">@Item.Collection</span>
        @if (!string.IsNullOrWhiteSpace(Item.VideoId))
        {
            <span class="video-indicator">ðŸŽ¥ Video</span>
        }
        @if (!string.IsNullOrWhiteSpace(Item.ExternalUrl))
        {
            <span class="external-indicator">ðŸ”— External</span>
        }
    </div>
</article>

@code {
    [Parameter, EditorRequired]
    public ContentItemDto Item { get; set; } = null!;

    private string FormatDate(long epochSeconds)
    {
        var dateTime = DateTimeOffset.FromUnixTimeSeconds(epochSeconds);
        var now = DateTimeOffset.UtcNow;
        var diff = now - dateTime;

        if (diff.TotalDays < 1)
            return "Today";
        if (diff.TotalDays < 2)
            return "Yesterday";
        if (diff.TotalDays < 7)
            return $"{(int)diff.TotalDays} days ago";
        if (diff.TotalDays < 30)
            return $"{(int)(diff.TotalDays / 7)} weeks ago";
        
        return dateTime.ToString("MMM d, yyyy");
    }
}
