{
  "Tags": [
    "asp.net"
  ],
  "OutputDir": "_posts",
  "FeedLevelAuthor": "Rick Strahl's Web Log",
  "ProcessedDate": "2025-08-05 14:25:42",
  "FeedUrl": "https://feeds.feedburner.com/rickstrahl",
  "Title": "Getting the ASP.NET Core Server Hosting Urls at Startup and in Requests",
  "Description": "Ever need to retrieve an ASP.NET application's hosting Urls? There are million ways to set these URLs but there's no easy fixed location where you can pick the addresses up from. Instead you have to go through a bit of a dance, and use one of two approaches depending on whether you need the addresses during startup or inside of a request.",
  "Link": "https://weblog.west-wind.com/posts/2024/Sep/03/Getting-the-ASPNET-Core-Server-Hosting-Urls-at-Startup-and-in-Requests",
  "FeedName": "Rick Strahl's Blog",
  "Author": "Rick Strahl",
  "EnhancedContent": "![](/images/HeroImages/RickHero10.jpg) ![](/images/rick175x175.jpg)\n\nhttps://twitter.com/rickstrahl https://feeds.feedburner.com/rickstrahl\n\n[Contact](https://west-wind.com/contact/) Â  â€¢ [Articles](https://west-wind.com/articles.aspx) Â  â€¢ [Products](https://store.west-wind.com) Â  â€¢ [Support](https://support.west-wind.com) Â  â€¢ [Advertise](https://weblog.west-wind.com/advertise)\n\nSponsored by:\n\n[!\\[\\](https://markdownmonster.west-wind.com/Images/MarkdownMonster_Icon_256.png) **Markdown Monster**](https://markdownmonster.west-wind.com?utm_campaign=westwind-weblog-sponsored)\n- The Markdown Editor for Windows\nhttps://markdownmonster.west-wind.com?utm_campaign=westwind-weblog-sponsored\n\n[advertise here](/advertise)\n\nShare on:\n\nhttps://twitter.com/intent/tweet?url=https://weblog.west-wind.com/posts/2024/Sep/03/Getting-the-ASPNET-Core-Server-Hosting-Urls-at-Startup-and-in-Requests&amp;text=Getting%20the%20ASP.NET%20Core%20Server%20Hosting%20Urls%20at%20Startup%20and%20in%20Requests&amp;via=RickStrahl https://www.facebook.com/sharer/sharer.php?u=https://weblog.west-wind.com/posts/2024/Sep/03/Getting-the-ASPNET-Core-Server-Hosting-Urls-at-Startup-and-in-Requests&amp;t=Getting%20the%20ASP.NET%20Core%20Server%20Hosting%20Urls%20at%20Startup%20and%20in%20Requests http://www.reddit.com/submit?url=https://weblog.west-wind.com/posts/2024/Sep/03/Getting-the-ASPNET-Core-Server-Hosting-Urls-at-Startup-and-in-Requests&amp;title=Getting%20the%20ASP.NET%20Core%20Server%20Hosting%20Urls%20at%20Startup%20and%20in%20Requests\n\nSeptember 03, 2024 â€¢ from Hood River, Oregon\n\nâ€¢ Â  4 comments\n\n:P\n\nOn this page:\n\n![Startup Banner](https://weblog.west-wind.com/images/2024/Getting-the-ASP-NET-Core-Server-Hosting-Urls-during-Server-Startup/StartupBanner.jpg)\n\nToday I was helping out a customer with their ASP.NET core application that wasn't starting up on a live server, hosted in IIS. Not uncommon in a first install, and when this happens I often resort to starting the app directly using Kestrel first, rather than trying to debug startup problems through the IIS system context and hunting down errors in the unwieldy event log.\n\nTo do this I can simply run the `.exe` file of the project (or `dotnet run` if the SDK is installed) and 90% of the time it's easy to track down issues this way especially if running in debug mode.\n\n## Which Port am I Hosting?\n\nBut in this case there was a problem: We couldn't figure out which port the app was running on. ðŸ˜„ A lot of hilarity (NOT!) ensued trying to guess port numbers - the default port of 5000, the dev port that I typically use 5200/5201 plus a few others. Long story short none of those ports worked.\n\n...because... it turns out the developer had changed the default startup Url in code and so the server started a custom port that neither of us would have guessed - until we looked at the source code.\n\n[!\\[\\](/images/sponsors/banner-example.png?v=1.2)](https://markdownmonster.west-wind.com?ut=weblog)\n\nWouldn't it be nice if we could display that Url somewhere **reliably**? As it turns we can do that with some startup code, but it's not what I would call easily discoverable, and there are different ways that work at different times in the ASP.NET lifecycle.\n\nNow, you can override the startup Urls via command line and environment options, but in this case even that didn't work because of the explicit override. But for most scenarios explicitly using `--urls \"<urlList>\"` or `--https_ports` works to override the Url.\n\n> >\n> ##### Overiding Hosting Urls on Startup\n> > >\n> FWIW there are million ways to specify startup Urls, and I'm going to refer you to [Andrew Lock's in depth post that shows 8 ways to set the hosting Urls](https://andrewlock.net/8-ways-to-set-the-urls-for-an-aspnetcore-app/).\n> >\n\n## Getting the Server Urls at Runtime is not Easy\n\nLooking in the source code solved the problem, but that shouldn't be necessary and really what I want in all of my apps is a **reliable way that shows me the actual startup urls that are being used** and display them on startup as part of an application banner.\n\nI'm a big fan of writing out some useful startup information that tells me the startup Urls, platform and environment at minimum. Something like this:\n\n![Startup Information](https://weblog.west-wind.com/images/2024/Getting-the-ASP-NET-Core-Server-Hosting-Urls-during-Server-Startup/StartupInformation.png)\n\n**Figure 1** - Showing a startup banner that includes the startup hosting Urls\n\nSpecifically I want to see those startup Urls and I want to see them consistently regardless of whether I'm running in dev with Launch Profiles or environment variables or whether the Urls were set in code.\n\nBesides providing valuable information on what port to use, it's also nice to have the Urls right there during development, because you can click on them to open the browser from the terminal, which is handy.\n\n## Lots of ways, but use the Right Way!\n\nSo the task at hand is to get the Hosting Urls as part of the startup code in `program.cs` so that it can be written out as part of a start up banner as shown in **Figure 1**.\n\n[I have actually written about this topic before](https://weblog.west-wind.com/posts/2021/Nov/09/Add-an-ASPNET-Runtime-Information-Startup-Banner) *(updated now)* and in that previous post I mentioned a different approach that works in most cases, but **didn't work in this case**:\n\n```cs // in program.cs - DON'T USE THIS var urls = builder.WebHost .GetSetting(WebHostDefaults.ServerUrlsKey)? .Replace(\";\", \" \"); // make clickable\n\n```\n\nThis code works only with **assigned Urls** from Launch Profile, explicitly assigned urls from the command line (--urls) or environment variables. **It does not work with the default url, or urls that are explicitly assigned in the WebBuilder startup.** Because this solution returns the **assigned Urls** not the actual Urls, the values can be returned before the server starts running but after the Urls have been assigned. But again - this only works if the Urls were explicitly assigned via configuration in some way, **so it's not a 100% reliable solution**.\n\nTo reliably retrieve the actually running Urls rather than the assigned values, you have to make sure the app has started running. Once it's running `app.Urls` is set with a string collection that you can read and it reflects the actual Urls that have been assigned and are live.\n\nSo how do we do that? We have to make sure we access `app.Urls` after `app.Start()` has been fired:\n\n![Capturing Addresses On Startup](https://weblog.west-wind.com/images/2024/Getting-the-ASP-NET-Core-Server-Hosting-Urls-during-Server-Startup/CapturingAddressesOnStartup.png)\n\n**Figure 2** - Capturing Hosting Addresses on Startup\n\nThis code works in all situations, but it requires that you not use the conventional `app.Run()` command, but instead use explicit `app.Start()` and `app.WaitForShutdown()` to execute your server event loop. The code to retrieve the host Urls must then live somewhere between these two statements. Effectively you have to put the Url retrieval code towards the very end of your startup code after the server has been started.\n\nHere's the code for the complete code for the startup banner in **Figure 2**:\n\n```cs // at the bottom of program.cs // app.Run() // can't use this\n\n// use this instead app.Start();\n\nConsole.ForegroundColor = ConsoleColor.DarkYellow; Console.WriteLine($@\"--------------------------------- West Wind Web Store v{wsApp.Version} ---------------------------------\"); Console.ResetColor();\n\nvar urlList = app.Urls; string urls = string.Join(\" \", urlList);\n\nConsole.Write(\" Urls: \"); Console.ForegroundColor = ConsoleColor.DarkCyan; Console.WriteLine(urls, ConsoleColor.DarkCyan); Console.ResetColor();\n\nConsole.WriteLine($\" Runtime: {RuntimeInformation.FrameworkDescription} - {builder.Environment.EnvironmentName}\"); Console.WriteLine($\"Platform: {RuntimeInformation.OSDescription} ({RuntimeInformation.OSArchitecture})\"); Console.WriteLine();\n\napp.WaitForShutdown();\n\n```\n\nThis appears to work for all scenarios and always returned the Urls regardless on how they were set. Yay!\n\n[!\\[\\](/images/Sponsors/Websurge-Display.png)](https://websurge.west-wind.com?ut=weblog)\n\n## Retrieving Host Urls in a Request\n\nYou can also retrieve the host urls inside of a request by requesting a `IServerAddressesFeature` from an `IServer` instance and then requesting the feature and the addresses:\n\n```csharp\n\npublic object SystemInfo([FromServices] IServer server) { var addresses = server.Features.Get<IServerAddressesFeature>()?.Addresses; ... }\n\n```\n\nwhich looks like this:\n\n![Returning Server Addresses As Part Of Json Service Response](https://weblog.west-wind.com/images/2024/Getting-the-ASP-NET-Core-Server-Hosting-Urls-during-Server-Startup/ReturningServerAddressesAsPartOfJsonServiceResponse.png)\n\n**Figure 3** - Returning addresses as part of a request.\n\nYou can grab `IServer` from dependency injection either via method (used here) or ctor injection.\n\nFor completeness sake, you can also use this same `IServer` approach in the Startup code:\n\n```cs app.Start();\n\nvar server = app.Services.GetService(typeof(IServer)) as IServer; var addrs = server.Features.Get<IServerAddressesFeature>()?.Addresses;\n\n...\n\napp.WaitForShutDown();\n\n```\n\nLike `app.Urls` this code also works only after `app.Start()` has fired, and given that `app.Urls` is simpler and gets you the same result, there's no good reason to use that code. Stick to `app.Urls` there.\n\n## Addendum: ASP.NET Core Debug Information\n\nAs @Thomas pointed out in the comments, ASP.NET Core apps print out the hosting ports **if Information logging** is enabled.\n\nAssuming you are running the Development environment you can see the ports listed at startup:\n\n![Asp Net Core Information Log Output](https://weblog.west-wind.com/images/2024/Getting-the-ASP-NET-Core-Server-Hosting-Urls-during-Server-Startup/AspNetCoreInformationLogOutput.png)\n\n**Figure 4** - Debug log output displays hosting Urls, but requires special config you likely wouldn't use in production.\n\nYou can switch environments via the command with:\n\n```ps $env:ASPNETCORE_ENVIRONMENT = \"Development\" dotnet run\n\n```\n\nActually, the host port logging is triggered by the logging settings for `\"Microsoft.Hosting.Lifetime\" = \"Information\"` and you can also adjust those directly in the local `appsettings.json` without making other environment changes:\n\n```json { \"Logging\": { \"LogLevel\": { \"Default\": \"Warning\", \"Microsoft\": \"Error\",\n\n// this!!! \"Microsoft.Hosting.Lifetime\": \"Information\" } } ... }\n\n```\n\nBoth of these work in a pinch if you're hunting for ports, but it's not a consistent solution as you're unlikely to run an application in `Development` or have `Information` logging enabled in a production app.\n\n## Summary\n\nWhile it's easy to set hosting Urls with many different ways to specify them, getting them back out at runtime is a little more tricky as there are specific rules that need to be followed. Specifically you can only reliably get the the hosting addresses **after the server has been started** and you have to use the magically undiscoverable references of `Iserver.Features` to extract the `IServerAddressesFeature` to retrieve the addresses at runtime. Well, once you know, you know, and now you know ðŸ˜„\n\n## Resources\n\n- [Andrew Lock: 8 ways to set the URLs for an ASP.NET Core app](https://andrewlock.net/8-ways-to-set-the-urls-for-an-aspnetcore-app/)\n- [Back to Basics: Add an ASP.NET Runtime Information Startup Banner](https://weblog.west-wind.com/posts/2021/Nov/09/Add-an-ASPNET-Runtime-Information-Startup-Banner)\n\n![](https://markdownmonster.west-wind.com/favicon.png) this post created and published with the [Markdown Monster Editor](https://markdownmonster.west-wind.com)\n\n### Other Posts you might also like\n\n- [Adding minimal OWIN Identity Authentication to an Existing ASP.NET MVC Application](https://weblog.west-wind.com/posts/2015/Apr/29/Adding-minimal-OWIN-Identity-Authentication-to-an-Existing-ASPNET-MVC-Application)\n- [Keeping Content Out of the Publish Folder for WebDeploy](https://weblog.west-wind.com/posts/2022/Aug/24/Keeping-Content-Out-of-the-Publish-Folder-for-WebDeploy)\n- [Map Physical Paths with an HttpContext.MapPath() Extension Method in ASP.NET](https://weblog.west-wind.com/posts/2023/Aug/15/Map-Physical-Paths-with-an-HttpContextMapPath-Extension-Method-in-ASPNET)\n- [Back to Basics: UTC and TimeZones in .NET Web Apps](https://weblog.west-wind.com/posts/2015/Feb/10/Back-to-Basics-UTC-and-TimeZones-in-NET-Web-Apps)\n\nShare on:\n\nhttps://twitter.com/intent/tweet?url=https://weblog.west-wind.com/posts/2024/Sep/03/Getting-the-ASPNET-Core-Server-Hosting-Urls-at-Startup-and-in-Requests&amp;text=Getting%20the%20ASP.NET%20Core%20Server%20Hosting%20Urls%20at%20Startup%20and%20in%20Requests&amp;via=RickStrahl\n\nhttps://www.facebook.com/sharer/sharer.php?u=https://weblog.west-wind.com/posts/2024/Sep/03/Getting-the-ASPNET-Core-Server-Hosting-Urls-at-Startup-and-in-Requests&amp;t=Getting%20the%20ASP.NET%20Core%20Server%20Hosting%20Urls%20at%20Startup%20and%20in%20Requests http://www.reddit.com/submit?url=https://weblog.west-wind.com/posts/2024/Sep/03/Getting-the-ASPNET-Core-Server-Hosting-Urls-at-Startup-and-in-Requests&amp;title=Getting%20the%20ASP.NET%20Core%20Server%20Hosting%20Urls%20at%20Startup%20and%20in%20Requests\n\n![Make Donation](/images/donation.png \"Find this content useful? Consider making a small donation.\")\n\nIs this content useful to you? **Consider making a small donation** to show your support.\n\nPosted in **[asp.net](/ShowPosts.aspx?Category=asp.net)**\n\n## The Voices of Reason\n\n![](https://www.gravatar.com/avatar.php?gravatar_id=2367a326cab67f0b4659fbc1fa736db2&size=100&rating=R)\n\n[Thomas Ardal](https://elmah.io)\n\nSeptember 04, 2024\n\n### # re: Getting the ASP.NET Core Server Hosting Urls at Startup and in Requests\n\nMaybe I misunderstood something. But can't you just enable this through logging? ASP.NET Core outputs the URL and port it is hosted on through `ILogger` . If you enable info logging on the `Microsoft.Hosting.Lifetime` category it outputs log lines like these:\n\n``` Now listening on: https://localhost:7028 Now listening on: http://localhost:5010\n\n```\n\n![](https://www.gravatar.com/avatar.php?gravatar_id=beb7fdd4bcd15e35472a96ab8182f034&size=100&rating=R)\n\n[Rick Strahl](https://west-wind.com)\n\nSeptember 06, 2024\n\n### # re: Getting the ASP.NET Core Server Hosting Urls at Startup and in Requests\n\n@Thomas, that's not wrong - except when logging is off. I tend to run without information prompts and in production that is off by default.\n\nBut - you're right - I didn't think of that when we were hunting for ports ðŸ˜€\n\n![](https://www.gravatar.com/avatar.php?gravatar_id=2367a326cab67f0b4659fbc1fa736db2&size=100&rating=R)\n\n[Thomas Ardal](https://elmah.io)\n\nSeptember 11, 2024\n\n### # re: Getting the ASP.NET Core Server Hosting Urls at Startup and in Requests\n\n@Rick It's probably a matter of preference. But I really like having the option to enable/disable information like these by changing log levels for specific log categories. It requires you to update the appsettings.json file or create environment variables which kind of sucks. But very powerful.\n\n![](https://www.gravatar.com/avatar.php?gravatar_id=beb7fdd4bcd15e35472a96ab8182f034&size=100&rating=R)\n\n[Rick Strahl](https://west-wind.com)\n\nSeptember 12, 2024\n\n### # re: Getting the ASP.NET Core Server Hosting Urls at Startup and in Requests\n\n@Thomas - yeah choices are good. Thanks for the feedback - I added a small section in the post to clarify that the log output provides this.",
  "PubDate": "2024-09-04T09:31:35+00:00"
}
