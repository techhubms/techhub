{
  "Tags": [
    "Connectivity",
    "database",
    "entity framework core",
    "EntityFrameworkCore",
    "Health Checks"
  ],
  "OutputDir": "_posts",
  "FeedLevelAuthor": "Code Maze",
  "ProcessedDate": "2025-08-05 14:18:56",
  "FeedUrl": "https://code-maze.com/feed/",
  "Title": "Testing Database Connectivity with EF Core",
  "Description": "Whether during application startup, multi-step workflows, or monitoring an application’s overall health, verifying database connectivity is essential for smooth operation and graceful handling of potential failures. It improves reliability and the overall user experience. In modern containerized environments, often managed by orchestrators like Kubernetes (K8S), it’s equally important for services to report their health status. […]\n\nThe post [Testing Database Connectivity with EF Core](https://code-maze.com/efcore-testing-database-connectivity/) appeared first on [Code Maze](https://code-maze.com).",
  "Link": "https://code-maze.com/efcore-testing-database-connectivity/",
  "FeedName": "Code Maze Blog",
  "Author": "Georgi Georgiev",
  "EnhancedContent": "# Testing Database Connectivity with EF Core\n\nPosted by [Georgi Georgiev](https://code-maze.com/author/georgi-georgiev/) | Jan 23, 2025 | [2](https://code-maze.com/efcore-testing-database-connectivity/#comments)\n\n![Testing Database Connectivity with EF Core](https://code-maze.com/wp-content/uploads/2021/12/social-entity-framewrok.png)\n\n[!\\[Code Maze Book Collection\\](https://code-maze.com/wp-content/uploads/2024/10/courses-template-wide.png)](https://courses.code-maze.com/courses/?source=tbanner&p=efcore-testing-database-connectivity/)\n\nReady to take your skills to the next level? Jump into our high-impact courses in web development and software architecture, all with a focus on mastering the .NET/C# framework. Whether you're **building sleek web applications or designing scalable software solutions**, our expert-led training will give you the tools to succeed. Visit our **[COURSES](https://courses.code-maze.com/courses/?source=tbanner&p=efcore-testing-database-connectivity/)** page now and kickstart your journey!\n\nWhether during application startup, multi-step workflows, or monitoring an application’s overall health, verifying database connectivity is essential for smooth operation and graceful handling of potential failures. It improves reliability and the overall user experience.\n\nIn modern containerized environments, often managed by orchestrators like Kubernetes (K8S), it’s equally important for services to report their health status. This allows orchestrators to monitor and effectively manage containerized applications. Database health checks play an important role in this process.\n\nIn this article, we’ll explore two common and straightforward approaches for testing database availability with EF Core. First, the CanConnectAsync() method for application-level checks, and second, the DbContext check with ASP.NET Core health checks framework for infrastructure-level monitoring.\n\nSupport Code Maze on Patreon to get rid of ads and get the best discounts on our products!\n\n[![Become a patron at Patreon!](https://code-maze.com/wp-content/plugins/patron-plugin-pro/plugin/lib/patron-button-and-widgets-by-codebard/images/become_a_patron_button.png)](https://www.patreon.com/oauth2/become-patron?response_type=code&amp;min_cents=100&amp;client_id=9_akhcsDQMGo-FTlVmNpM_uxSV4fbW3vnrz7CBRV9RxwjMPCLfWgodhrcE0UuHH4&amp;scope=identity%20identity[email]&amp;redirect_uri=https://code-maze.com/patreon-authorization/&amp;state=eyJmaW5hbF9yZWRpcmVjdF91cmkiOiJodHRwczpcL1wvY29kZS1tYXplLmNvbVwvaGF0ZW9hcy1hc3BuZXQtY29yZS13ZWItYXBpXC8ifQ%3D%3D&amp;utm_source=https%3A%2F%2Fcode-maze.com%2Fhateoas-aspnet-core-web-api%2F&amp;utm_medium=patreon_wordpress_plugin&amp;utm_campaign=11086160&amp;utm_term=&amp;utm_content=post_unlock_button)\n\nTo download the source code for this article, you can visit our [GitHub repository](https://github.com/CodeMazeBlog/CodeMazeGuides/tree/main/dotnet-efcore/TestForValidDbConnection).\n\nLet’s dive in!\n\n## Prerequisites for Running the Database Connectivity Checks\n\nThis article requires a running SQL Server database. To keep things simple and automated, we’ll use the [Testcontainers](https://code-maze.com/csharp-testing-using-testcontainers-for-net-and-docker/) NuGet package to programmatically create and manage a SQL Server instance in a Docker container.\n\nPlease note, that **Testcontainers** requires **Docker** to be installed and running, as it will run a local database container.\n\nAfter configuring a **SQL Server Test Container**, we then need to configure our `ApplicationDbContext` to connect to this **SQL Server** instance:\n\n``` builder.Services.AddDbContext<ApplicationDbContext>(options => options.UseSqlServer(connectionString), contextLifetime: ServiceLifetime.Scoped); ```\n\nWith our setup complete, we’re ready to explore how to test database connectivity.\n\nLet’s begin!\n\n## Using CanConnectAsync for Database Connectivity Checks\n\nSometimes it is important for our application to determine whether it can obtain a database connection prior to attempting an execution of a specific task. This is particularly helpful for processes that span multiple requests. In other cases, periodic connectivity checks can enable the application to take preemptive actions to handle potential issues.\n\nLet’s look at a few examples of when checking the connection state can be useful:\n\n- In a multi-step process that relies on repeated database interactions, it’s more efficient to verify connectivity upfront than to fail halfway due to an unavailable database\n- Applications that can run offline with limited features and notify the user\n- Applications that can switch to backup infrastructure when the main one is unavailable\n- Monitoring and alerting database connectivity regularly can generate alerts for the operations team, enabling them to react swiftly and reduce downtime.\n\nLuckily, EF Core provides a built-in method: `CanConnectAsync()` . This method checks if the database connection is valid and open, enabling developers to handle potential connectivity issues. It works by attempting to execute a `SELECT 1` query in the database. If the attempt is successful, it returns `true` ; if it fails, it returns `false` .\n\nTo demonstrate this we’ll create a minimal API that internally uses the `CanConnectAsync()` method:\n\n``` app.MapGet(\"/can-connect\", async (ApplicationDbContext applicationDbContext, CancellationToken cancellationToken) => { var canConnect = await applicationDbContext.Database.CanConnectAsync(cancellationToken);\n\nreturn canConnect ? Results.Ok(\"Connected successfully\") : Results.Problem(\"Cannot connect\", statusCode: StatusCodes.Status503ServiceUnavailable); }); ```\n\nOur API returns a result based on the outcome of the connection attempt. If the connection attempt is successful the response will be `Connected successfully` with the status code `200 OK` . Otherwise, we’d get `Cannot connect` and a status code `503 Service Unavailable` .\n\nIs this material useful to you? Consider subscribing and get **ASP.NET Core Web API Best Practices** eBook for [FREE!](https://code-maze.com/free-ebook-aspnetcore-webapi-best-practices/)\n\nTo test our minimal API, let’s launch our application and send a GET request to `/can-connect` .\n\nIf our Docker database container is up and running, as expected we will get `Connected successfully` . On the other hand, if we pause or stop the container the result will be `Service Unavailable` .\n\nThis straightforward method helps us determine our database’s availability at runtime, enabling the application to handle connectivity issues gracefully.\n\n## Using HealthChecks for Infrastructure-Level Checks and Container Orchestrators\n\nModern software architecture often breaks down complex software into multiple applications. These applications typically interact with each other within a private network. As such, it’s important that they report their health status to other components or orchestrators, such as **Kubernetes**.\n\nIf you want to find out more about Microservices, check out our course [Microservices in .NET](https://courses.code-maze.com/courses/microservices-in-dotnet/).\n\nIn such scenarios, health checks are critical, because container orchestrators rely on them to determine whether to route traffic to an instance. If an instance cannot operate due to database connectivity issues, the orchestrator can disallow traffic to it, and reroute it to healthy instances.\n\n**ASP.NET Core** provides a complete and robust **health check framework** that integrates seamlessly with **EF Core**, making it ideal for monitoring database connectivity.\n\nTo learn more about health checks, please check out our dedicated article, [Health Checks in ASP.NET Core](https://code-maze.com/health-checks-aspnetcore/).\n\nTo register a health check for our **DbContext** we first need to add the HealthChecks NuGet package:\n\n`dotnet add package Microsoft.Extensions.Diagnostics.HealthChecks.EntityFrameworkCore`\n\nIs this material useful to you? Consider subscribing and get **ASP.NET Core Web API Best Practices** eBook for [FREE!](https://code-maze.com/free-ebook-aspnetcore-webapi-best-practices/)\n\nHaving the package installed, we can then register the health check to our service collection with `AddDbContextCheck<ApplicationDbContext>()` :\n\n``` builder.Services.AddHealthChecks() .AddDbContextCheck<ApplicationDbContext>(\"Database Health\", failureStatus: HealthStatus.Unhealthy); ```\n\nHere, we name the health check `Database Health` and configure it to report an **Unhealthy** status if the connection attempt fails. Of course, this is fully customizable.\n\nIn order to access our health checks, we define the health check endpoint in our application’s startup configuration in the `Program` class:\n\n`app.MapHealthChecks(\"/health\");`\n\nOnce everything is set up, we can test the health check by sending a request to the `/health` endpoint.\n\nAs before, if our database is operational, we’ll receive a `200` `Healthy` response; otherwise, it will return `503 Unhealthy` status. Even though this approach looks pretty simple, it’s actually very powerful. It allows container orchestrators to monitor applications and manage them effectively based on their health status.\n\n## Conclusion\n\nIn this article, we explored two practical approaches for testing database connectivity using EF Core. If your applications frequently encounter database unavailability, subsequent crashes, or unpredictable behavior, perhaps what we’ve learned today could prove valuable. Stay tuned for our next article!\n\n[!\\[Code Maze Book Collection\\](https://code-maze.com/wp-content/uploads/2024/10/courses-template-wide.png)](https://courses.code-maze.com/courses/?source=bbanner&p=efcore-testing-database-connectivity/)\n\nIs this material useful to you? Consider subscribing and get **ASP.NET Core Web API Best Practices** eBook for [FREE!](https://code-maze.com/free-ebook-aspnetcore-webapi-best-practices/)\n\nReady to take your skills to the next level? Jump into our high-impact courses in web development and software architecture, all with a focus on mastering the .NET/C# framework. Whether you're **building sleek web applications or designing scalable software solutions**, our expert-led training will give you the tools to succeed. Visit our **[COURSES](https://courses.code-maze.com/courses/?source=bbanner&p=efcore-testing-database-connectivity/)** page now and kickstart your journey!\n\nLiked it? Take a second to support Code Maze on Patreon and get the ad free reading experience!\n\n[![Become a patron at Patreon!](https://code-maze.com/wp-content/plugins/patron-plugin-pro/plugin/lib/patron-button-and-widgets-by-codebard/images/become_a_patron_button.png)](https://www.patreon.com/oauth2/become-patron?response_type=code&min_cents=100&client_id=9_akhcsDQMGo-FTlVmNpM_uxSV4fbW3vnrz7CBRV9RxwjMPCLfWgodhrcE0UuHH4&scope=identity%20identity[email]&redirect_uri=https://code-maze.com/patreon-authorization/&state=eyJmaW5hbF9yZWRpcmVjdF91cmkiOiJodHRwczpcL1wvY29kZS1tYXplLmNvbVwvZWZjb3JlLXRlc3RpbmctZGF0YWJhc2UtY29ubmVjdGl2aXR5XC8ifQ%3D%3D&utm_source=https%3A%2F%2Fcode-maze.com%2Fefcore-testing-database-connectivity%2F&utm_medium=patreon_wordpress_plugin&utm_campaign=11086160&utm_term=&utm_content=post_unlock_button)\n\nShare:\n\nhttp://www.facebook.com/sharer.php?u=https://code-maze.com/efcore-testing-database-connectivity/&#038;t=Testing%20Database%20Connectivity%20with%20EF%20Corehttp://twitter.com/intent/tweet?text=Testing%20Database%20Connectivity%20with%20EF%20Core%20https://code-maze.com/efcore-testing-database-connectivity/http://www.linkedin.com/shareArticle?mini=true&#038;url=https://code-maze.com/efcore-testing-database-connectivity/&#038;title=Testing%20Database%20Connectivity%20with%20EF%20Core\n\n![](data:image/gif;base64,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)\n\n#### Courses – Code Maze\n\n[!\\[code maze courses side\\](https://code-maze.com/wp-content/uploads/2024/10/code-maze-courses-template-v3.png)](https://courses.code-maze.com/courses/)\n\nWhether you want to master web development or software architecture you should check our [COURSES](https://courses.code-maze.com/courses/) and pick the one that you like.\n\n#### Ad 1\n\n#### Ad 2\n\n#### Ad 3\n\n#### Ad 4",
  "PubDate": "2025-01-23T11:08:23+00:00"
}
