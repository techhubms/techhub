{
  "Description": "Migrating an Azure subscription between tenants can sometimes surface unexpected authentication issues, especially for environments like **Azure Virtual Desktop (AVD)** that depend deeply on **Microsoft Entra ID (formerly Azure AD)** for identity and access control.\n\nThis post walks through a **real-world scenario** where users were suddenly locked out of AVD sessions after a tenant migration, the investigation that followed, and the steps taken to restore access.\n\n**Scenario Overview**\n\nShortly after an Azure subscription was migrated from **Tenant A** to **Tenant B**, several users reported being unable to connect to their virtual desktops. The error message displayed:\n\n“**Your account does not exist in this organization’s directory.**”\n\nThis problem appeared immediately after the migration—even though access roles had been correctly reassigned under the new tenant. Interestingly, users who had **active sessions before the migration** remained signed in until their tokens eventually expired.\n\n**Symptoms Observed**\n\n- Authentication failures during AVD sign-in\n- Error code **AADSTS53003**, indicating a Conditional Access policy block\n- The issue primarily affected **macOS clients**\n- Reinstalling or resetting the AVD client did **not** resolve the problem\n\n**Root Cause Analysis**\n\nThe investigation uncovered that cached tokens on user devices were still attempting to authenticate against the **legacy tenant**.\n\n**Contributing Factors**\n\n- **Token persistence** in macOS Keychain\n- **Cached refresh tokens** still bound to the old tenant’s directory ID\n\nThis mismatch meant that even though users had permission in the new tenant, their local authentication context still pointed to the previous one.\n\n**Understanding Token Behavior on macOS**\n\nThe AVD client on macOS uses **tokens** stored in the system **Keychain**.\n\n| **Token Type** | **Default Lifetime** | **Renewal Behavior** | | --- | --- | --- | | **Access Token** | ~1 hour | Automatically renewed via refresh token | | **Refresh Token** | 90 days of inactivity (rolling) | Each successful refresh resets the timer | | **Persistent Session** | Until refresh token expiry or manual deletion | Cached in Keychain until removed |\n\n**Key Takeaways:**\n\n- **Conditional Access (CA)** or **Sign-In Frequency** policies can shorten token validity (e.g., 12 hours or 7 days).\n- Cached tokens remain active until:\n- The refresh token expires.\n- They are manually deleted from Keychain.\n- A **tenant mismatch** triggers forced re-authentication.\n\n**Resolution Steps**\n\n1. **Validate AVD Configuration**\n\n- Verify that the **host pool**, **workspace**, and **application group** references all point to the **new tenant’s directory ID**.\n- Confirm that the appropriate **service principals** and **role assignments** exist under the new tenant.\n\n1. **Clear Cached Tokens**\n\n- On macOS, manually remove AVD’s cached MSAL tokens from **Keychain Access**.\n- Once users signed out and back in, authentication succeeded without further issues.\n\n**Mitigation Options**\n\n**Option 1 – Revoke Active Sessions via Microsoft Graph PowerShell**\n\nConnect-MgGraph -Scopes \"User.RevokeSessions.All\"\n\nRevoke-MgUserSignInSession\n\n**Option 2 – Manual Cleanup**\n\n- Instruct affected users to delete cached credentials or MSAL tokens from macOS Keychain.\n- Have them sign back in to re-establish authentication with the correct tenant.\n\n**Key Learnings**\n\n- Cached tokens can retain old tenant information long after migration—especially on macOS devices.\n- Conditional Access policies may inadvertently block token issuance during silent sign-ins.\n- Proactively revoking sessions and clearing tokens helps minimize user disruption.\n\n**Best Practices for Future Tenant Migrations**\n\n- **Validate** all AVD resources (host pools, workspaces, app groups) against the new directory ID.\n- **Instruct users** to clear cached credentials before reconnecting.\n- **Allow sufficient propagation time** for identity and access updates to take effect.\n- **Review Conditional Access policies** to prevent unintended sign-in blocks during transition periods.\n\n**Closing Thoughts**\n\nTenant migrations are complex, and even small gaps in token or directory synchronization can interrupt access to services like Azure Virtual Desktop. By planning token cleanup and access validation steps in advance, you can ensure a **smoother transition** with **minimal user downtime**.",
  "Link": "https://techcommunity.microsoft.com/t5/apps-on-azure-blog/troubleshooting-azure-virtual-desktop-sign-in-failures-after/ba-p/4467953",
  "Author": "psundars",
  "EnhancedContent": "Migrating an Azure subscription between tenants can sometimes surface unexpected authentication issues, especially for environments like **Azure Virtual Desktop (AVD)** that depend deeply on **Microsoft Entra ID (formerly Azure AD)** for identity and access control.\n\nThis post walks through a **real-world scenario** where users were suddenly locked out of AVD sessions after a tenant migration, the investigation that followed, and the steps taken to restore access.\n\n**Scenario Overview**\n\nShortly after an Azure subscription was migrated from **Tenant A** to **Tenant B**, several users reported being unable to connect to their virtual desktops. The error message displayed:\n\n“**Your account does not exist in this organization’s directory.**”\n\nThis problem appeared immediately after the migration—even though access roles had been correctly reassigned under the new tenant. Interestingly, users who had **active sessions before the migration** remained signed in until their tokens eventually expired.\n\n**Symptoms Observed**\n\n- Authentication failures during AVD sign-in\n- Error code **AADSTS53003**, indicating a Conditional Access policy block\n- The issue primarily affected **macOS clients**\n- Reinstalling or resetting the AVD client did **not** resolve the problem\n\n**Root Cause Analysis**\n\nThe investigation uncovered that cached tokens on user devices were still attempting to authenticate against the **legacy tenant**.\n\n**Contributing Factors**\n\n- **Token persistence** in macOS Keychain\n- **Cached refresh tokens** still bound to the old tenant’s directory ID\n\nThis mismatch meant that even though users had permission in the new tenant, their local authentication context still pointed to the previous one.\n\n**Understanding Token Behavior on macOS**\n\nThe AVD client on macOS uses **tokens** stored in the system **Keychain**.\n\n| **Token Type** | **Default Lifetime** | **Renewal Behavior** | | --- | --- | --- | | **Access Token** | ~1 hour | Automatically renewed via refresh token | | **Refresh Token** | 90 days of inactivity (rolling) | Each successful refresh resets the timer | | **Persistent Session** | Until refresh token expiry or manual deletion | Cached in Keychain until removed |\n\n**Key Takeaways:**\n\n- **Conditional Access (CA)** or **Sign-In Frequency** policies can shorten token validity (e.g., 12 hours or 7 days).\n- Cached tokens remain active until:\n- The refresh token expires.\n- They are manually deleted from Keychain.\n- A **tenant mismatch** triggers forced re-authentication.\n\n**Resolution Steps**\n\n1. **Validate AVD Configuration**\n\n- Verify that the **host pool**, **workspace**, and **application group** references all point to the **new tenant’s directory ID**.\n- Confirm that the appropriate **service principals** and **role assignments** exist under the new tenant.\n\n1. **Clear Cached Tokens**\n\n- On macOS, manually remove AVD’s cached MSAL tokens from **Keychain Access**.\n- Once users signed out and back in, authentication succeeded without further issues.\n\n**Mitigation Options**\n\n**Option 1 – Revoke Active Sessions via Microsoft Graph PowerShell**\n\nConnect-MgGraph -Scopes \"User.RevokeSessions.All\"\n\nRevoke-MgUserSignInSession\n\n**Option 2 – Manual Cleanup**\n\n- Instruct affected users to delete cached credentials or MSAL tokens from macOS Keychain.\n- Have them sign back in to re-establish authentication with the correct tenant.\n\n**Key Learnings**\n\n- Cached tokens can retain old tenant information long after migration—especially on macOS devices.\n- Conditional Access policies may inadvertently block token issuance during silent sign-ins.\n- Proactively revoking sessions and clearing tokens helps minimize user disruption.\n\n**Best Practices for Future Tenant Migrations**\n\n- **Validate** all AVD resources (host pools, workspaces, app groups) against the new directory ID.\n- **Instruct users** to clear cached credentials before reconnecting.\n- **Allow sufficient propagation time** for identity and access updates to take effect.\n- **Review Conditional Access policies** to prevent unintended sign-in blocks during transition periods.\n\n**Closing Thoughts**\n\nTenant migrations are complex, and even small gaps in token or directory synchronization can interrupt access to services like Azure Virtual Desktop. By planning token cleanup and access validation steps in advance, you can ensure a **smoother transition** with **minimal user downtime**.\n\nPublished Nov 07, 2025\n\nVersion 1.0\n\n[azure active directory](/tag/azure%20active%20directory?nodeId=board%3AAppsonAzureBlog)\n\n[!\\[psundars&#x27;s avatar\\](https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/dS0yNDEzODQtNTc0OTkzaUU3Qjk1MDBCQjE5NDQ5MkI?image-dimensions=50x50)](/users/psundars/241384) [psundars](/users/psundars/241384) ![Icon for Microsoft rank](https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/cmstNC05WEo0blc?image-dimensions=100x16&amp;constrain-image=true)Microsoft\n\nJoined November 12, 2018\n\n[View Profile](/users/psundars/241384)\n\n/category/azure/blog/appsonazureblog [Apps on Azure Blog](/category/azure/blog/appsonazureblog) Follow this blog board to get notified when there's new activity",
  "ProcessedDate": "2025-11-07 06:03:33",
  "OutputDir": "_community",
  "PubDate": "2025-11-07T05:32:56+00:00",
  "FeedUrl": "https://techcommunity.microsoft.com/t5/s/gxcuf89792/rss/Category?category.id=Azure",
  "FeedLevelAuthor": "rss.livelink.threads-in-node",
  "FeedName": "Microsoft Tech Community",
  "Title": "Troubleshooting Azure Virtual Desktop Sign-In Failures After Tenant Migration",
  "Tags": []
}
