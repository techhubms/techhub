{
  "EnhancedContent": "When working with [**Confidential VMs (CVMs)**](https://learn.microsoft.com/en-us/azure/confidential-computing/confidential-vm-overview) in Azure, ensuring secure backups is just as important as protecting workloads in use. Confidential VMs use hardware-based Trusted Execution Environments (TEEs) such as AMD SEV-SNP or Intel TDX to keep your data safe. But how do you securely back up this data without exposing it to the public internet? The answer lies in combining [**Azure Recovery Services Vault (RSV)**](https://learn.microsoft.com/en-us/azure/backup/backup-azure-recovery-services-vault-overview) with **Private Endpoints**.\n\nIn this blog, we’ll walk through why this setup matters, how to configure it, and what challenges you should watch out for.\n\n**Note:** This blog specifically deals with **CVMs encrypted with Confidential OS Encryption on the OS Disk**. As of now, Azure Backup for CVMs is in **Private Preview**, so make sure to engage with your **Microsoft Account Team or Product Team** for access.\n\n## Why Use Private Endpoints for RSV?\n\nBy default, the Recovery Services vault communicates over public endpoints. With private endpoints, all traffic between your Confidential VM and RSV flows over the secure Microsoft backbone instead of the public internet. This adds an extra layer of isolation and protection — a perfect match for sensitive workloads.\n\n## What You’ll Need (Prerequisites)\n\nBefore jumping in, make sure you have:\n\n- An **Azure Subscription** and appropriate permissions (Owner/Contributor for RSV, DNS Zone Contributor for DNS).\n- A **Confidential VM** on supported [SKUs](https://learn.microsoft.com/en-us/azure/confidential-computing/virtual-machine-options#sizes).\n- A **Recovery Services Vault** in the same or a peered region.\n- A **Virtual Network and Subnet**:\n- Use a dedicated subnet for private endpoints.\n- A private endpoint connection for Backup uses **11 private IPs** (including Azure Backup storage). This may be higher in certain regions.\n- Recommended subnet size: **/25 to /27** to ensure sufficient private IP availability.\n- **Private DNS Zones**:\n- privatelink.backup.windowsazure.com (for the vault itself)\n- privatelink.blob.core.windows.net (staging and recovery data)\n- privatelink.queue.core.windows.net (backup operations queue)\n- privatelink.table.core.windows.net (metadata storage)\n- **Azure Backup for CVMs** supports only the **3-blob** layout, which is now **generally available**. As a result, all new deployments on versions v5 and v6 SKUs will have 3-blob configuration by default instead of the previous 2-blob setup. Older deployments that did not enable the Preview Feature may need to be redeployed to align with this change.\n- **Azure Backup Private Preview Feature** enabled on the subscription-level in collaboration with the Azure Product Team.\n- Up-to-date **Backup Extension** on the VM.\n\n## Step-by-Step: Configuring Backup with Private Endpoints\n\n1. **Request Product Team Enablement**:\n- Work with Microsoft support/product team to enable the **Azure Backup Private Preview Feature** for your subscription.\n2. **Create the Recovery Services Vault** in the desired region.\n3. **Add a Private Endpoint**:\n- Go to RSV → Networking → Private Endpoint connections.\n- Select your VNet and subnet (ensure enough private IPs: /25 to /27 recommended).\n- Link to the required private DNS zones.\n4. **Enable Backup on the Confidential VM**:\n- Open the VM → Backup.\n- Select the RSV.\n- Choose or create an **Enhanced policy** (required for CVMs).\n- Trigger the initial backup.\n\n## Key Considerations for Confidential VM Backup\n\n1. **Enhanced Policies Only**: CVM backup supports only **Enhanced policies**. Backup support for CVM with confidential OS disk encryption using CMK is only available with Enhanced policies.\n2. **Zone-Redundant Recovery Services Vault (ZRS)**: Consider deploying RSV as **ZRS** if you want to restore CVMs across zones. Restores from other zones are possible only via vault; **snapshot restores are not supported** across zones.\n3. **CVM Backup with CMK Support**: Currently available only under **Private Preview on an enrollment basis**.\n4. **Key Vault and Managed HSM Permissions**:\n- When configuring via **Azure Portal**, access to Key Vault/Managed HSM is granted automatically.\n- When using **PowerShell, CLI, or REST API**, access issues occur because Azure Backup requires explicit permissions.\n- **Fix: Assign Permissions to Azure Backup**:\n- *For Key Vault*: Grant **Get, List, Backup** key permissions (no secret permissions needed).\n- *For Managed HSM*:\n- Go to **Managed HSM → Local RBAC → Add Role Assignment**.\n- Assign one of the following:\n- Built-in Role: **Managed HSM Crypto User**\n- Custom Role: Ensure dataActions include:\n- Microsoft.KeyVault/managedHsm/keys/read/action\n- Microsoft.KeyVault/managedHsm/keys/backup/action\n- Set scope to the specific key (or All Keys).\n- Assign role to **Backup Management Service**.\n- Once permissions are configured, proceed with CVM backup setup as usual.\n\n## Restore Options and Limitations\n\nWhen restoring a Confidential VM, Azure Backup provides several restore paths — each with certain caveats due to the confidential computing model:\n\n1. **Restore to Original Location**\n- You can restore the CVM directly to the same subscription, resource group, and network configuration.\n- Ideal for operational recovery after accidental deletion or corruption.\n2. **Restore to Alternate Location**\n- You can restore the backup to a different resource group, virtual network, or availability zone.\n- **Limitations:** Only supported when RSV is deployed as **Zone-Redundant (ZRS)**. Snapshot restore is **not supported** when restoring to other zones.\n3. **Disk-Level Restore**\n- Allows restoring specific managed disks (OS or data disks) from the backup vault.\n- Restored disks can be used to recreate CVMs manually.\n- **Limitations:** Replacement of OS Disk on the existing VM is **not supported**.\n4. **Point-in-Time Restore (Enhanced Policy Only)**\n- Available for Enhanced Backup Policies with configurable retention settings.\n\n#### Restore Limitations\n\n- **Encryption Constraints**: Restores for CVMs with CMK require the same Key Vault access and permissions to be valid at restore time.\n- **Private DNS Dependency**: Incorrect or missing DNS resolution for blob or backup endpoints can cause restore failures.\n- **Feature Availability**: All restore capabilities mentioned above are still evolving under the **Azure Backup Private Preview program**.\n\n## Security Benefits\n\n- **Network Isolation**: All communication between CVMs, the Recovery Services Vault, and backup storage occurs over private IPs using private endpoints — no exposure to the public internet.\n- **End-to-End Encryption**: Backup data is encrypted both at rest and in transit. Use **Customer-Managed Keys (CMK)** in Azure Key Vault or Managed HSM for greater control over encryption.\n- **Role-Based Access Control (RBAC)**: Fine-grained access management ensures only authorized users and services can trigger or restore backups.\n- **Managed Identities for Authentication**: Reduces key management complexity and enhances security posture.\n\n## Known Issues and Limitations\n\n- **DNS Misconfiguration**: Missing or misconfigured private DNS zones for backup, blob, queue, or table endpoints often lead to failed backups or restores.\n- **Limited Regional Support**: Confidential VM backups with private endpoints are currently available in selected Azure regions only.\n- **Extension Compatibility**: Ensure that the latest Azure Backup extension version is installed on the CVM. Older versions may not support CVM encryption.\n- **Feature Dependencies**: **Azure Backup for CVMs (Private Preview)** must be manually enabled at the subscription level by the Azure Product Team.\n- **Performance Overhead**: Due to attestation and encryption validation, backup operations may experience slight latency.\n\n## Best Practices\n\n- **Test Restore Scenarios Regularly**: Validate both backup and restore processes to ensure end-to-end functionality.\n- **Subnet Planning**: Reserve adequate IP addresses in your subnet (/25 or /27) to accommodate private endpoints.\n- **ZRS Deployment**: Use **Zone-Redundant Recovery Services Vault (ZRS)** for better resiliency and zone-to-zone restore capability.\n- **Use Enhanced Backup Policies**: Enhanced policies ensure point-in-time recovery and support for CMK-based encryption.\n- **DNS Hygiene**: Keep private DNS zones properly configured and linked to ensure uninterrupted connectivity.\n- **Permission Management**: Verify Key Vault and Managed HSM permissions before initiating backup/restore through PowerShell or REST API.\n- **Network Segmentation**: Use dedicated subnets for private endpoints to avoid IP conflicts and simplify network management.\n- **Automate with IaC**: Use Bicep or Terraform templates for repeatable, auditable deployments of RSVs, private endpoints, and DNS configurations.\n- **Monitor Health and Alerts**: Enable Azure Monitor and Backup Center to track job statuses, failures, and performance.\n- **Engage Product Team Early**: Contact the Microsoft Product Team early in your project to ensure required preview feature (Azure Backup for CVMs) is enabled in time.\n\n## Final Thoughts\n\nBacking up Confidential VMs with Azure Recovery Services vault over private endpoints gives you the best of both worlds: **confidential computing protections** for your workloads and **secure, compliant backups** that never leave the private network. By carefully planning DNS, subnet sizing, enabling subscription features with product team help, and configuring permissions properly, you can avoid common pitfalls and strengthen your data protection strategy.\n\n**Note:** This blog specifically deals with **CVMs encrypted with Confidential OS Encryption on the OS Disk**.\n\n**Tip:** If you’re just getting started, reach out to the Azure Product Team to enable the required features, deploy a test CVM, link it to an RSV with private endpoints, and run a backup/restore cycle to validate your configuration end-to-end.\n\nUpdated Nov 29, 2025\n\nVersion 1.0\n\n[acc](/tag/acc?nodeId=board%3AAzureConfidentialComputingBlog)\n\n[cvm](/tag/cvm?nodeId=board%3AAzureConfidentialComputingBlog)\n\n[preview](/tag/preview?nodeId=board%3AAzureConfidentialComputingBlog)\n\n[!\\[PramodPalukuru&#x27;s avatar\\](https://techcommunity.microsoft.com/t5/s/gxcuf89792/m_assets/avatars/default/avatar-1.svg?image-dimensions=50x50)](/users/pramodpalukuru/2380760) [PramodPalukuru](/users/pramodpalukuru/2380760) ![Icon for Microsoft rank](https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/cmstNC05WEo0blc?image-dimensions=100x16&amp;constrain-image=true)Microsoft\n\nJoined March 22, 2024\n\n[View Profile](/users/pramodpalukuru/2380760)\n\n/category/azure/blog/azureconfidentialcomputingblog [Azure Confidential Computing Blog](/category/azure/blog/azureconfidentialcomputingblog) Follow this blog board to get notified when there's new activity",
  "Link": "https://techcommunity.microsoft.com/t5/azure-confidential-computing/securing-confidential-vm-backups-with-azure-recovery-services/ba-p/4458965",
  "Tags": [],
  "FeedLevelAuthor": "rss.livelink.threads-in-node",
  "OutputDir": "_community",
  "ProcessedDate": "2025-11-29 09:04:49",
  "PubDate": "2025-11-29T08:26:10+00:00",
  "FeedName": "Microsoft Tech Community",
  "FeedUrl": "https://techcommunity.microsoft.com/t5/s/gxcuf89792/rss/Category?category.id=Azure",
  "Description": "When working with [**Confidential VMs (CVMs)**](https://learn.microsoft.com/en-us/azure/confidential-computing/confidential-vm-overview) in Azure, ensuring secure backups is just as important as protecting workloads in use. Confidential VMs use hardware-based Trusted Execution Environments (TEEs) such as AMD SEV-SNP or Intel TDX to keep your data safe. But how do you securely back up this data without exposing it to the public internet? The answer lies in combining [**Azure Recovery Services Vault (RSV)**](https://learn.microsoft.com/en-us/azure/backup/backup-azure-recovery-services-vault-overview) with **Private Endpoints**.\n\nIn this blog, we’ll walk through why this setup matters, how to configure it, and what challenges you should watch out for.\n\n**Note:** This blog specifically deals with **CVMs encrypted with Confidential OS Encryption on the OS Disk**. As of now, Azure Backup for CVMs is in **Private Preview**, so make sure to engage with your **Microsoft Account Team or Product Team** for access.\n\n## Why Use Private Endpoints for RSV?\n\nBy default, the Recovery Services vault communicates over public endpoints. With private endpoints, all traffic between your Confidential VM and RSV flows over the secure Microsoft backbone instead of the public internet. This adds an extra layer of isolation and protection — a perfect match for sensitive workloads.\n\n## What You’ll Need (Prerequisites)\n\nBefore jumping in, make sure you have:\n\n- An **Azure Subscription** and appropriate permissions (Owner/Contributor for RSV, DNS Zone Contributor for DNS).\n- A **Confidential VM** on supported [SKUs](https://learn.microsoft.com/en-us/azure/confidential-computing/virtual-machine-options#sizes).\n- A **Recovery Services Vault** in the same or a peered region.\n- A **Virtual Network and Subnet**:\n- Use a dedicated subnet for private endpoints.\n- A private endpoint connection for Backup uses **11 private IPs** (including Azure Backup storage). This may be higher in certain regions.\n- Recommended subnet size: **/25 to /27** to ensure sufficient private IP availability.\n- **Private DNS Zones**:\n- privatelink.backup.windowsazure.com (for the vault itself)\n- privatelink.blob.core.windows.net (staging and recovery data)\n- privatelink.queue.core.windows.net (backup operations queue)\n- privatelink.table.core.windows.net (metadata storage)\n- **Azure Backup for CVMs** supports only the **3-blob** layout, which is now **generally available**. As a result, all new deployments on versions v5 and v6 SKUs will have 3-blob configuration by default instead of the previous 2-blob setup. Older deployments that did not enable the Preview Feature may need to be redeployed to align with this change.\n- **Azure Backup Private Preview Feature** enabled on the subscription-level in collaboration with the Azure Product Team.\n- Up-to-date **Backup Extension** on the VM.\n\n## Step-by-Step: Configuring Backup with Private Endpoints\n\n1. **Request Product Team Enablement**:\n- Work with Microsoft support/product team to enable the **Azure Backup Private Preview Feature** for your subscription.\n2. **Create the Recovery Services Vault** in the desired region.\n3. **Add a Private Endpoint**:\n- Go to RSV → Networking → Private Endpoint connections.\n- Select your VNet and subnet (ensure enough private IPs: /25 to /27 recommended).\n- Link to the required private DNS zones.\n4. **Enable Backup on the Confidential VM**:\n- Open the VM → Backup.\n- Select the RSV.\n- Choose or create an **Enhanced policy** (required for CVMs).\n- Trigger the initial backup.\n\n## Key Considerations for Confidential VM Backup\n\n1. **Enhanced Policies Only**: CVM backup supports only **Enhanced policies**. Backup support for CVM with confidential OS disk encryption using CMK is only available with Enhanced policies.\n2. **Zone-Redundant Recovery Services Vault (ZRS)**: Consider deploying RSV as **ZRS** if you want to restore CVMs across zones. Restores from other zones are possible only via vault; **snapshot restores are not supported** across zones.\n3. **CVM Backup with CMK Support**: Currently available only under **Private Preview on an enrollment basis**.\n4. **Key Vault and Managed HSM Permissions**:\n- When configuring via **Azure Portal**, access to Key Vault/Managed HSM is granted automatically.\n- When using **PowerShell, CLI, or REST API**, access issues occur because Azure Backup requires explicit permissions.\n- **Fix: Assign Permissions to Azure Backup**:\n- *For Key Vault*: Grant **Get, List, Backup** key permissions (no secret permissions needed).\n- *For Managed HSM*:\n- Go to **Managed HSM → Local RBAC → Add Role Assignment**.\n- Assign one of the following:\n- Built-in Role: **Managed HSM Crypto User**\n- Custom Role: Ensure dataActions include:\n- Microsoft.KeyVault/managedHsm/keys/read/action\n- Microsoft.KeyVault/managedHsm/keys/backup/action\n- Set scope to the specific key (or All Keys).\n- Assign role to **Backup Management Service**.\n- Once permissions are configured, proceed with CVM backup setup as usual.\n\n## Restore Options and Limitations\n\nWhen restoring a Confidential VM, Azure Backup provides several restore paths — each with certain caveats due to the confidential computing model:\n\n1. **Restore to Original Location**\n- You can restore the CVM directly to the same subscription, resource group, and network configuration.\n- Ideal for operational recovery after accidental deletion or corruption.\n2. **Restore to Alternate Location**\n- You can restore the backup to a different resource group, virtual network, or availability zone.\n- **Limitations:** Only supported when RSV is deployed as **Zone-Redundant (ZRS)**. Snapshot restore is **not supported** when restoring to other zones.\n3. **Disk-Level Restore**\n- Allows restoring specific managed disks (OS or data disks) from the backup vault.\n- Restored disks can be used to recreate CVMs manually.\n- **Limitations:** Replacement of OS Disk on the existing VM is **not supported**.\n4. **Point-in-Time Restore (Enhanced Policy Only)**\n- Available for Enhanced Backup Policies with configurable retention settings.\n\n#### Restore Limitations\n\n- **Encryption Constraints**: Restores for CVMs with CMK require the same Key Vault access and permissions to be valid at restore time.\n- **Private DNS Dependency**: Incorrect or missing DNS resolution for blob or backup endpoints can cause restore failures.\n- **Feature Availability**: All restore capabilities mentioned above are still evolving under the **Azure Backup Private Preview program**.\n\n## Security Benefits\n\n- **Network Isolation**: All communication between CVMs, the Recovery Services Vault, and backup storage occurs over private IPs using private endpoints — no exposure to the public internet.\n- **End-to-End Encryption**: Backup data is encrypted both at rest and in transit. Use **Customer-Managed Keys (CMK)** in Azure Key Vault or Managed HSM for greater control over encryption.\n- **Role-Based Access Control (RBAC)**: Fine-grained access management ensures only authorized users and services can trigger or restore backups.\n- **Managed Identities for Authentication**: Reduces key management complexity and enhances security posture.\n\n## Known Issues and Limitations\n\n- **DNS Misconfiguration**: Missing or misconfigured private DNS zones for backup, blob, queue, or table endpoints often lead to failed backups or restores.\n- **Limited Regional Support**: Confidential VM backups with private endpoints are currently available in selected Azure regions only.\n- **Extension Compatibility**: Ensure that the latest Azure Backup extension version is installed on the CVM. Older versions may not support CVM encryption.\n- **Feature Dependencies**: **Azure Backup for CVMs (Private Preview)** must be manually enabled at the subscription level by the Azure Product Team.\n- **Performance Overhead**: Due to attestation and encryption validation, backup operations may experience slight latency.\n\n## Best Practices\n\n- **Test Restore Scenarios Regularly**: Validate both backup and restore processes to ensure end-to-end functionality.\n- **Subnet Planning**: Reserve adequate IP addresses in your subnet (/25 or /27) to accommodate private endpoints.\n- **ZRS Deployment**: Use **Zone-Redundant Recovery Services Vault (ZRS)** for better resiliency and zone-to-zone restore capability.\n- **Use Enhanced Backup Policies**: Enhanced policies ensure point-in-time recovery and support for CMK-based encryption.\n- **DNS Hygiene**: Keep private DNS zones properly configured and linked to ensure uninterrupted connectivity.\n- **Permission Management**: Verify Key Vault and Managed HSM permissions before initiating backup/restore through PowerShell or REST API.\n- **Network Segmentation**: Use dedicated subnets for private endpoints to avoid IP conflicts and simplify network management.\n- **Automate with IaC**: Use Bicep or Terraform templates for repeatable, auditable deployments of RSVs, private endpoints, and DNS configurations.\n- **Monitor Health and Alerts**: Enable Azure Monitor and Backup Center to track job statuses, failures, and performance.\n- **Engage Product Team Early**: Contact the Microsoft Product Team early in your project to ensure required preview feature (Azure Backup for CVMs) is enabled in time.\n\n## Final Thoughts\n\nBacking up Confidential VMs with Azure Recovery Services vault over private endpoints gives you the best of both worlds: **confidential computing protections** for your workloads and **secure, compliant backups** that never leave the private network. By carefully planning DNS, subnet sizing, enabling subscription features with product team help, and configuring permissions properly, you can avoid common pitfalls and strengthen your data protection strategy.\n\n**Note:** This blog specifically deals with **CVMs encrypted with Confidential OS Encryption on the OS Disk**.\n\n**Tip:** If you’re just getting started, reach out to the Azure Product Team to enable the required features, deploy a test CVM, link it to an RSV with private endpoints, and run a backup/restore cycle to validate your configuration end-to-end.",
  "Title": "Securing Confidential VM Backups with Azure Recovery Services Vault and Private Endpoints",
  "Author": "PramodPalukuru"
}
