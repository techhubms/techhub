{
  "Link": "https://techcommunity.microsoft.com/t5/azure-high-performance-computing/the-complete-guide-to-renewing-an-expired-certificate-in/ba-p/4465444",
  "ProcessedDate": "2025-10-30 07:03:56",
  "FeedUrl": "https://techcommunity.microsoft.com/t5/s/gxcuf89792/rss/Category?category.id=Azure",
  "PubDate": "2025-10-30T06:27:43+00:00",
  "OutputDir": "_community",
  "EnhancedContent": "Managing certificates in an **HPC Pack 2019 cluster** is critical for secure communication between nodes. However, if your certificate has **expired**, your cluster services (Scheduler, Broker, Web Components, etc.) may stop functioning properly ‚Äî preventing nodes from communicating or jobs from scheduling.\n\nWhen the **HPC Pack certificate expires**, the **HPC Cluster Manager** will fail to launch, and you may encounter error messages similar to the examples shown below.\n\nThis comprehensive guide walks you through how to **renew an already expired HPC Pack certificate** on a **single-head-node** setup and bring your cluster back online.\n\n**Step 1: Check the Current Certificate Expiry**\n\nStart by checking the existing certificate and its expiry date.\n\n``` Get-ChildItem -Path Cert:\\LocalMachine\\root | Where-Object { $_.Subject -like \"HPC\" } $thumbprint = \"<Thumbprint value from the previous command>\".ToUpper() $cert = Get-ChildItem -Path Cert:\\LocalMachine\\My | Where-Object { $_.Thumbprint -eq $thumbprint } $cert | Select-Object Subject, NotBefore, NotAfter, Thumbprint Date ```\n\nYou can also confirm the system date using the PowerShell date command:\n\n``` Date ```\n\nThis ensures you‚Äôre viewing the correct validity period for the currently installed certificate.\n\n**Step 2: Prepare a New Self-Signed Certificate**\n\nNext, we‚Äôll create a new certificate that meets the HPC communication requirements.\n\n**Certificate Requirements:**\n\n- Must have a **private key** capable of key exchange.\n- **Key usage** should include: Digital Signature, Key Encipherment, Key Agreement, and Certificate Signing.\n- **Enhanced key usage** should include: Client Authentication and Server Authentication.\n- If two certificates are used (private/public), both must have the **same subject name**.\n\nWhen you prepare a new certificate, make sure that you use the same subject name as that of the old certificate. Run the following PowerShell commands on the HPC node to get the subject name of your certificate.\n\nYou can verify the existing certificate‚Äôs subject name using the following command:\n\n``` $thumbprint = (Get-ItemProperty -Path HKLM:\\SOFTWARE\\Microsoft\\HPC -Name SSLThumbprint).SSLThumbPrint $subjectName = (Get-Item Cert:\\LocalMachine\\My\\$thumbprint).Subject $subjectName ```\n\nUse the same subject name when generating the new certificate.\n\n**Step 3: Create a New Certificate**\n\nUse the below commands to create and export a new self-signed certificate (valid for 1 year).\n\n``` $subjectName = \"HPC Pack Node Communication\"\n\n$pfxcert = New-SelfSignedCertificate -Subject $subjectName -KeySpec KeyExchange -KeyLength 2048 -HashAlgorithm SHA256 -TextExtension @(\"2.5.29.37={text}1.3.6.1.5.5.7.3.1,1.3.6.1.5.5.7.3.2\") -Provider \"Microsoft Enhanced RSA and AES Cryptographic Provider\" -CertStoreLocation Cert:\\CurrentUser\\My -KeyExportPolicy Exportable -NotAfter (Get-Date).AddYears(1) -NotBefore (Get-Date).AddDays(-1)\n\n$certThumbprint = $pfxcert.Thumbprint\n\n$null = New-Item $env:Temp\\$certThumbprint -ItemType Directory\n\n$pfxPassword = Get-Credential -UserName 'Protection password' -Message 'Enter protection password below'\n\nExport-PfxCertificate -Cert Cert:\\CurrentUser\\My\\$certThumbprint -FilePath \"$env:Temp\\$certThumbprint\\PrivateCert.pfx\" -Password $pfxPassword.Password\n\nExport-Certificate -Cert Cert:\\CurrentUser\\My\\$certThumbprint -FilePath \"$env:Temp\\$certThumbprint\\PublicCert.cer\" -Type CERT -Force\n\nstart \"$env:Temp\\$certThumbprint\" ```\n\nThis will generate both .pfx (private) and .cer (public) files in a temporary directory.\n\n**Step 4: Copy Certificate to Install Share**\n\nOn the **master (head) node**, copy the newly created certificate to the following path:\n\n**C:\\Program Files\\Microsoft HPC Pack 2019\\Data\\InstallShare\\Certificates**\n\nThis ensures the certificate is available to all compute nodes in the cluster.\n\n**Step 5: Rotate Certificates on Compute Nodes**\n\n**Important:** Always rotate certificates on **compute nodes first**, before the head node. If you update the head node first, compute nodes will reject the new certificate, forcing manual reconfiguration.\n\nAfter rotating compute node certificates, expect them to appear as **Offline** in HPC Cluster Manager ‚Äî this is normal until the head node certificate is updated.\n\n1. Download the PowerShell script [Update-HpcNodeCertificate.ps1](https://raw.githubusercontent.com/Azure/hpcpack-template/master/Scripts/Update-HpcNodeCertificate.ps1)¬†and place it in your HPC install share:\n2. \\\\&lt;headnode&gt;\\REMINST\n3. On each compute node, open **PowerShell as Administrator** and run:\n\n``` PowerShell.exe -ExecutionPolicy ByPass -Command \"\\\\<headnode>\\REMINST\\Update-HpcNodeCertificate.ps1 -PfxFilePath \\\\headnode>\\REMINST\\Certificates\\HpcCnCommunication.pfx -Password <password> \" ```\n\nThis updates the certificate on each compute node.\n\n**Step 6: Update Certificate on the Master (Head) Node**\n\nOn the head node, run the following commands in **PowerShell as Administrator**:\n\n``` $certPassword = ConvertTo-SecureString -String \"YourPassword\" -AsPlainText -Force\n\nImport-PfxCertificate -FilePath \"C:\\Program Files\\Microsoft HPC Pack 2019\\Data\\InstallShare\\Certificates\\PrivateCert.pfx\" -CertStoreLocation \"Cert:\\LocalMachine\\My\" -Password $certPassword\n\nPowerShell.exe -ExecutionPolicy ByPass -Command \"Import-certificate -FilePath \\\\master\\REMINST\\Certificates\\PublicCert.cer -CertStoreLocation cert:\\LocalMachine\\Root\"\n\nSet-ItemProperty -Path \"HKLM:\\SOFTWARE\\Microsoft\\HPC\" -Name SSLThumbprint -Value <Thumbprint>\n\nSet-ItemProperty -Path \"HKLM:\\SOFTWARE\\Wow6432Node\\Microsoft\\HPC\" -Name SSLThumbprint -Value <Thumbprint> ```\n\n**Step 7: Update Thumbprint in SQL Database**\n\nYou‚Äôll also need to update the certificate thumbprint stored in the **HPCHAStorage** database.\n\n1. Install **[SQL Server Management Studio (SSMS)](https://aka.ms/ssms/21/release/vs_SSMS.exe)** (latest version).\n2. pen SSMS and connect to the¬†**HPC database**.\n\n3. Navigate to:\n\n4. HPCHAStorage ‚Üí Tables ‚Üí dbo.DataTable\n\n5. Right-click and select¬†**‚ÄúSelect Top 1000 Rows‚Äù** to view the current SSL thumbprint.\n\n6. Use the¬†**new query** window and run the following command with the updated thumbprint:\n\n``` Update dbo.DataTable set dvalue='<NewThumbrpint>' where dpath = 'HKEY_LOCAL_MACHINE\\Software\\Microsoft\\HPC' and dkey = 'SSLThumbprint' ```\n\nThis updates the stored certificate reference used by the HPC services.\n\n**Step 8: Reboot the Master Node**\n\nOnce everything is updated, **reboot the head node** to apply the changes.\n\nAfter the system restarts, open **HPC Cluster Manager** ‚Äî your cluster should now be fully functional with the new certificate in place.\n\n**Summary**\n\nBy following these steps, you can safely renew an **expired HPC Pack 2019 certificate** and restore secure communication across your cluster ‚Äî without needing to reinstall or reconfigure HPC Pack components.\n\nThis guide helps administrators handle expired certificates with confidence and maintain business continuity for HPC workloads.\n\nIf this guide helped you resolve your certificate issues, please¬†**give it a üëç thumbs up** and share your feedback or questions in the comments section below.\n\nPublished Oct 30, 2025\n\nVersion 1.0\n\n[hpc](/tag/hpc?nodeId=board%3AAzureHighPerformanceComputingBlog)\n\n[!\\[vinilv&#x27;s avatar\\](https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/dS04NjY2MDgtNDUwNzM4aUE3MUE1Qjg5NkQ3NjFBOTY?image-dimensions=50x50)](/users/vinilv/866608) [vinilv](/users/vinilv/866608) ![Icon for Microsoft rank](https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/cmstNC05WEo0blc?image-dimensions=100x16&amp;constrain-image=true)Microsoft\n\nJoined November 12, 2020\n\n[View Profile](/users/vinilv/866608)\n\n/category/azure/blog/azurehighperformancecomputingblog [Azure High Performance Computing (HPC) Blog](/category/azure/blog/azurehighperformancecomputingblog) Follow this blog board to get notified when there's new activity",
  "FeedName": "Microsoft Tech Community",
  "Title": "The Complete Guide to Renewing an Expired Certificate in Microsoft HPC Pack 2019 (Single Head Node)",
  "Tags": [],
  "FeedLevelAuthor": "rss.livelink.threads-in-node",
  "Description": "Managing certificates in an **HPC Pack 2019 cluster** is critical for secure communication between nodes. However, if your certificate has **expired**, your cluster services (Scheduler, Broker, Web Components, etc.) may stop functioning properly ‚Äî preventing nodes from communicating or jobs from scheduling.\n\nWhen the **HPC Pack certificate expires**, the **HPC Cluster Manager** will fail to launch, and you may encounter error messages similar to the examples shown below.\n\n![]()![]()\n\nThis comprehensive guide walks you through how to **renew an already expired HPC Pack certificate** on a **single-head-node** setup and bring your cluster back online.\n\n**Step 1: Check the Current Certificate Expiry**\n\nStart by checking the existing certificate and its expiry date.\n\n- Get-ChildItem -Path Cert:\\LocalMachine\\root | Where-Object { $\\_.Subject -like \"HPC\" }\n$thumbprint = \"\".ToUpper() $cert = Get-ChildItem -Path Cert:\\LocalMachine\\My | Where-Object { $\\_.Thumbprint -eq $thumbprint } $cert | Select-Object Subject, NotBefore, NotAfter, Thumbprint Date\n\nYou can also confirm the system date using the PowerShell date command:\n- Date\n\nThis ensures you‚Äôre viewing the correct validity period for the currently installed certificate.\n\n![]()\n\n**Step 2: Prepare a New Self-Signed Certificate**\n\nNext, we‚Äôll create a new certificate that meets the HPC communication requirements.\n\n**Certificate Requirements:**\n\n- Must have a **private key** capable of key exchange.\n- **Key usage** should include: Digital Signature, Key Encipherment, Key Agreement, and Certificate Signing.\n- **Enhanced key usage** should include: Client Authentication and Server Authentication.\n- If two certificates are used (private/public), both must have the **same subject name**.\n\nWhen you prepare a new certificate, make sure that you use the same subject name as that of the old certificate. Run the following PowerShell commands on the HPC node to get the subject name of your certificate.\n\nYou can verify the existing certificate‚Äôs subject name using the following command:\n- $thumbprint = (Get-ItemProperty -Path HKLM:\\SOFTWARE\\Microsoft\\HPC -Name SSLThumbprint).SSLThumbPrint\n$subjectName = (Get-Item Cert:\\LocalMachine\\My\\$thumbprint).Subject $subjectName\n\nUse the same subject name when generating the new certificate.\n\n![]()\n\n**Step 3: Create a New Certificate**\n\nUse the below commands to create and export a new self-signed certificate (valid for 1 year).\n- $subjectName = \"HPC Pack Node Communication\"\n\n$pfxcert = New-SelfSignedCertificate -Subject $subjectName -KeySpec KeyExchange -KeyLength 2048 -HashAlgorithm SHA256 -TextExtension @(\"2.5.29.37={text}1.3.6.1.5.5.7.3.1,1.3.6.1.5.5.7.3.2\") -Provider \"Microsoft Enhanced RSA and AES Cryptographic Provider\" -CertStoreLocation Cert:\\CurrentUser\\My -KeyExportPolicy Exportable -NotAfter (Get-Date).AddYears(1) -NotBefore (Get-Date).AddDays(-1)\n\n$certThumbprint = $pfxcert.Thumbprint\n\n$null = New-Item $env:Temp\\$certThumbprint -ItemType Directory\n\n$pfxPassword = Get-Credential -UserName 'Protection password' -Message 'Enter protection password below'\n\nExport-PfxCertificate -Cert Cert:\\CurrentUser\\My\\$certThumbprint -FilePath \"$env:Temp\\$certThumbprint\\PrivateCert.pfx\" -Password $pfxPassword.Password\n\nExport-Certificate -Cert Cert:\\CurrentUser\\My\\$certThumbprint -FilePath \"$env:Temp\\$certThumbprint\\PublicCert.cer\" -Type CERT -Force\n\nstart \"$env:Temp\\$certThumbprint\"\n\nThis will generate both .pfx (private) and .cer (public) files in a temporary directory.\n\n![]()\n\n**Step 4: Copy Certificate to Install Share**\n\nOn the **master (head) node**, copy the newly created certificate to the following path:\n\n**C:\\Program Files\\Microsoft HPC Pack 2019\\Data\\InstallShare\\Certificates**\n\nThis ensures the certificate is available to all compute nodes in the cluster.\n\n![]()\n\n**Step 5: Rotate Certificates on Compute Nodes**\n\n**Important:** Always rotate certificates on **compute nodes first**, before the head node. If you update the head node first, compute nodes will reject the new certificate, forcing manual reconfiguration.\n\nAfter rotating compute node certificates, expect them to appear as **Offline** in HPC Cluster Manager ‚Äî this is normal until the head node certificate is updated.\n\n1. Download the PowerShell script [Update-HpcNodeCertificate.ps1](https://raw.githubusercontent.com/Azure/hpcpack-template/master/Scripts/Update-HpcNodeCertificate.ps1) and place it in your HPC install share:\n2. \\\\\\REMINST\n3. On each compute node, open **PowerShell as Administrator** and run:\n- PowerShell.exe -ExecutionPolicy ByPass -Command \"\\\\\\REMINST\\Update-HpcNodeCertificate.ps1 -PfxFilePath \\\\headnode>\\REMINST\\Certificates\\HpcCnCommunication.pfx -Password \"\n\nThis updates the certificate on each compute node.\n\n![]()\n\n**Step 6: Update Certificate on the Master (Head) Node**\n\nOn the head node, run the following commands in **PowerShell as Administrator**:\n- $certPassword = ConvertTo-SecureString -String \"YourPassword\" -AsPlainText -Force\n\nImport-PfxCertificate -FilePath \"C:\\Program Files\\Microsoft HPC Pack 2019\\Data\\InstallShare\\Certificates\\PrivateCert.pfx\" -CertStoreLocation \"Cert:\\LocalMachine\\My\" -Password $certPassword\n\nPowerShell.exe -ExecutionPolicy ByPass -Command \"Import-certificate -FilePath \\\\master\\REMINST\\Certificates\\PublicCert.cer -CertStoreLocation cert:\\LocalMachine\\Root\"\n\nSet-ItemProperty -Path \"HKLM:\\SOFTWARE\\Microsoft\\HPC\" -Name SSLThumbprint -Value\n\nSet-ItemProperty -Path \"HKLM:\\SOFTWARE\\Wow6432Node\\Microsoft\\HPC\" -Name SSLThumbprint -Value ![]()\n\n**Step 7: Update Thumbprint in SQL Database**\n\nYou‚Äôll also need to update the certificate thumbprint stored in the **HPCHAStorage** database.\n\n1. Install **[SQL Server Management Studio (SSMS)](https://aka.ms/ssms/21/release/vs_SSMS.exe)** (latest version).\n2. pen SSMS and connect to the **HPC database**.![]()\n\n![]()\n\n3. Navigate to:\n\n4. HPCHAStorage ‚Üí Tables ‚Üí dbo.DataTable\n\n5. Right-click and select **‚ÄúSelect Top 1000 Rows‚Äù** to view the current SSL thumbprint.\n\n![]()![]()\n\n6. Use the **new query** window and run the following command with the updated thumbprint:\n- Update dbo.DataTable set dvalue='' where dpath = 'HKEY\\_LOCAL\\_MACHINE\\Software\\Microsoft\\HPC' and dkey = 'SSLThumbprint'![]()\n\nThis updates the stored certificate reference used by the HPC services.\n\n**Step 8: Reboot the Master Node**\n\nOnce everything is updated, **reboot the head node** to apply the changes.\n\nAfter the system restarts, open **HPC Cluster Manager** ‚Äî your cluster should now be fully functional with the new certificate in place.\n\n![]()\n\n**Summary**\n\nBy following these steps, you can safely renew an **expired HPC Pack 2019 certificate** and restore secure communication across your cluster ‚Äî without needing to reinstall or reconfigure HPC Pack components.\n\nThis guide helps administrators handle expired certificates with confidence and maintain business continuity for HPC workloads.\n\nIf this guide helped you resolve your certificate issues, please **give it a üëç thumbs up** and share your feedback or questions in the comments section below.",
  "Author": "vinilv"
}
