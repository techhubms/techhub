{
  "Link": "https://techcommunity.microsoft.com/t5/apps-on-azure-blog/how-to-add-an-mcp-tool-to-your-azure-foundry-agent-using-dynamic/ba-p/4468844",
  "PubDate": "2025-11-18T06:14:52+00:00",
  "FeedUrl": "https://techcommunity.microsoft.com/t5/s/gxcuf89792/rss/Category?category.id=Azure",
  "FeedLevelAuthor": "rss.livelink.threads-in-node",
  "Title": "How-to add an MCP tool to your Azure Foundry agent using dynamic sessions on Azure Container Apps",
  "Author": "jeffmartinez",
  "Description": "Now available in preview, Azure Container Apps supports a new shell session pool type in [dynamic sessions](https://learn.microsoft.com/azure/container-apps/sessions) as well as MCP support for both shell and Python container types. With MCP enablement, you can bring the benefits of dynamics sessions to your AI agents by giving them the ability to execute code, run system commands, access file systems, and perform complex tasks in isolated, secure container environments that appear and disappear on demand.\n\nThe following is a tutorial on how to use an MCP enabled dynamic session as a tool used in an Azure Foundry agent giving it the capability to run remote shell commands.\n\n### Setup\n\nFor this tutorial, we're going to use an ARM template to deploy our Container App Session Pool resource.\n\nBegin by signing into Azure and creating a resource group.\n\n- az login\n\nAfter you're logged in, set the following variables that will be used to deploy the resource. Replace the with your own values.\n- SUBSCRIPTION\\_ID=$(az account show --query id --output tsv)\nRESOURCE\\_GROUP= SESSION\\_POOL\\_NAME= LOCATION=\n\nCreate a resource group\n- az group create --name $RESOURCE\\_GROUP --location $LOCATION\n\n### 1. Create a shell dynamic session with MCP enabled\n\nUse an ARM template to create a shell session pool with MCP server enabled.\n\nCreate a deployment template file named *deploy.json* and copy the following into the file:\n- {\n\"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\", \"contentVersion\": \"1.0.0.0\", \"parameters\": { \"name\": { \"type\": \"String\" }, \"location\": { \"type\": \"String\" } }, \"resources\": [ { \"type\": \"Microsoft.App/sessionPools\", \"apiVersion\": \"2025-02-02-preview\", \"name\": \"[parameters('name')]\", \"location\": \"[parameters('location')]\", \"properties\": { \"poolManagementType\": \"Dynamic\", \"containerType\": \"Shell\", \"scaleConfiguration\": { \"maxConcurrentSessions\": 5 }, \"sessionNetworkConfiguration\": { \"status\": \"EgressEnabled\" }, \"dynamicPoolConfiguration\": { \"lifecycleConfiguration\": { \"lifecycleType\": \"Timed\", \"coolDownPeriodInSeconds\": 300 } }, \"mcpServerSettings\": { \"isMCPServerEnabled\": true } } } ] }\n\nNext, deploy the ARM template you just created.\n- az deployment group create --resource-group $RESOURCE\\_GROUP --template-file deploy.json --name $SESSION\\_POOL\\_NAME --location $LOCATION\n\nOnce completed, your resource will be provisioned and available in the portal.\n\n**Get the MCP server endpoint and credentials**\n\nNext, retrieve the MCP server endpoint from the deployed container app session pool.\n- az rest --method GET --uri \"/subscriptions/$SUBSCRIPTION\\_ID/resourceGroups/$RESOURCE\\_GROUP/providers/Microsoft.App/sessionPools/$SESSION\\_POOL\\_NAME?api-version=2025-02-02-preview\" --query \"properties.mcpServerSettings.mcpServerEndpoint\" -o tsv\n\nThen, request the API credentials for the MCP server\n- az rest --method POST --uri \"/subscriptions/$SUBSCRIPTION\\_ID/resourceGroups/$RESOURCE\\_GROUP/providers/Microsoft.App/sessionPools/$SESSION\\_POOL\\_NAME/fetchMCPServerCredentials?api-version=2025-02-02-preview\" --query \"apiKey\" -o tsv\n\nKeep the fetched values nearby and copied to be used in the next step to connect your MCP server as a tool in the Azure Foundry agent.\n\n### 2. Create an Azure Foundry project and agent\n\nGo to the Azure Foundry website and follow the steps below to create a project. Make sure you are in the New Foundry portal by turning it on in the top nav.\n\n1. Navigate to the top left nav bar and click an existing project and click **Create new project**\n2. Give your project a **Name**\n3. Click on **Advanced options**to choose and fill out the following\n1. Foundry resource\n2. Subscription\n3. Region\n4. Resource group\n4. After filling the previous options out, click **Create**\n\nOnce your project is created, follow the steps below to create an agent.\n\n1. Click on the **Build** tab on the top right navigation bar\n2. Navigate to the **Agents** section in the left nav\n3. Click on the **Create agent** button\n4. Give your agent a name and click **Create**\n\n### 3. Connect your remote MCP server as a Tool to your agent\n\nAfter your agent is created, you can connect a remote MCP server as a tool for your agent to use. Follow the steps below to connect an MCP server to your agent.\n\n1. Navigate to **Tools** on the left nav bar\n2. Click on the **Connect a tool** button\n3. Go to the **Custom** tab\n4. Click on the **Model Context Protocol (MCP)** option, click **Create**\n5. Fill out the form on the following screen and click **Create.** Use the MCP server endpoint and API credentials from the previous section.\n1. Name=\"your-unique-name\"\n2. Remote MCP server endpoint=\"your-mcp-server-endpoint\"\n3. Authentication type= \"Key-based\"\n4. Credential= Key:\"x-ms-apikey\" Value: \"your-api-key\"\n\n![]()\n\nOnce the tool is created you will see a **Use in an agent** button. Click on that and choose the agent you previously created.\n\nAfter choosing the agent you should now see a connected tool in your agent view.\n\n![]()\n\n### 4. Use the connected tool to run shell commands with your agent\n\nNow that the tool is connected you can use the playground to prompt the agent with a question that will launch the shell environment.\n\nTry the following prompt with your agent:\n\n> >\n> **\"Create a hello world flask app in a new remote environment. Then send a request to the app to show that it works.\"**\n> >\n\nOnce prompted, the connected MCP server will use it's tools to launch a shell environment and create an **environmentId**. This is used to track your session by creating a unique GUID so future commands are run in the same session.\n\nThe Foundry agent will then ask for approval for each step as the connected MCP tool will execute a series of shell commands that will install Python and Flask.\n\n![]()\n\nOnce all requests have been completed and approved, you'll notice it has run the necessary shell commands in the remote environment and sent a curl request to the app with a response of Hello, World!\n\n![]()\n\nIn this tutorial, we demonstrated how to extend Azure AI Foundry agents using Azure Container Apps dynamic session pools. By enabling MCP support on a shell session pool, we created a secure, on-demand execution environment that allows AI agents to run remote shell commands. With this setup, your AI agents can now bridge the gap between conversation and action, providing users with interactive and useful experiences.",
  "EnhancedContent": "## Use an Azure Container Apps dynamic session shell environment as an MCP server tool with Azure Foundry\n\nNow available in preview, Azure Container Apps supports a new shell session pool type in [dynamic sessions](https://learn.microsoft.com/azure/container-apps/sessions) as well as MCP support for both shell and Python container types. With MCP enablement, you can bring the benefits of dynamics sessions to your AI agents by giving them the ability to execute code, run system commands, access file systems, and perform complex tasks in isolated, secure container environments that appear and disappear on demand.\n\nThe following is a tutorial on how to use an MCP enabled dynamic session as a tool used in an Azure Foundry agent giving it the capability to run remote shell commands.\n\n### Setup\n\nFor this tutorial, we're going to use an ARM template to deploy our Container App Session Pool resource.\n\nBegin by signing into Azure and creating a resource group.\n\n``` az login ```\n\nAfter you're logged in, set the following variables that will be used to deploy the resource. Replace the **&lt;&gt;** with your own values.\n\n``` SUBSCRIPTION_ID=$(az account show --query id --output tsv) RESOURCE_GROUP=<RESOURCE_GROUP_NAME> SESSION_POOL_NAME=<SESSION_POOL_NAME> LOCATION=<LOCATION> ```\n\nCreate a resource group\n\n``` az group create --name $RESOURCE_GROUP --location $LOCATION ```\n\n### 1. Create a shell dynamic session with MCP enabled\n\nUse an ARM template to create a shell session pool with MCP server enabled.\n\nCreate a deployment template file named *deploy.json* and copy the following into the file:\n\n``` { \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\", \"contentVersion\": \"1.0.0.0\", \"parameters\": { \"name\": { \"type\": \"String\" }, \"location\": { \"type\": \"String\" } }, \"resources\": [ { \"type\": \"Microsoft.App/sessionPools\", \"apiVersion\": \"2025-02-02-preview\", \"name\": \"[parameters('name')]\", \"location\": \"[parameters('location')]\", \"properties\": { \"poolManagementType\": \"Dynamic\", \"containerType\": \"Shell\", \"scaleConfiguration\": { \"maxConcurrentSessions\": 5 }, \"sessionNetworkConfiguration\": { \"status\": \"EgressEnabled\" }, \"dynamicPoolConfiguration\": { \"lifecycleConfiguration\": { \"lifecycleType\": \"Timed\", \"coolDownPeriodInSeconds\": 300 } }, \"mcpServerSettings\": { \"isMCPServerEnabled\": true } } } ] } ```\n\nNext, deploy the ARM template you just created.\n\n``` az deployment group create --resource-group $RESOURCE_GROUP --template-file deploy.json --name $SESSION_POOL_NAME --location $LOCATION ```\n\nOnce completed, your resource will be provisioned and available in the portal.\n\n**Get the MCP server endpoint and credentials**\n\nNext, retrieve the MCP server endpoint from the deployed container app session pool.\n\n``` az rest --method GET --uri \"/subscriptions/$SUBSCRIPTION_ID/resourceGroups/$RESOURCE_GROUP/providers/Microsoft.App/sessionPools/$SESSION_POOL_NAME?api-version=2025-02-02-preview\" --query \"properties.mcpServerSettings.mcpServerEndpoint\" -o tsv ```\n\nThen, request the API credentials for the MCP server\n\n``` az rest --method POST --uri \"/subscriptions/$SUBSCRIPTION_ID/resourceGroups/$RESOURCE_GROUP/providers/Microsoft.App/sessionPools/$SESSION_POOL_NAME/fetchMCPServerCredentials?api-version=2025-02-02-preview\" --query \"apiKey\" -o tsv ```\n\nKeep the fetched values nearby and copied to be used in the next step to connect your MCP server as a tool in the Azure Foundry agent.\n\n### 2. Create an Azure Foundry project and agent\n\nGo to the Azure Foundry website and follow the steps below to create a project. Make sure you are in the New Foundry portal by turning it on in the top nav.\n\n1. Navigate to the top left nav bar and click an existing project and click **Create new project**\n2. Give your project a **Name**\n3. Click on **Advanced options**to choose and fill out the following\n1. Foundry resource\n2. Subscription\n3. Region\n4. Resource group\n4. After filling the previous options out, click **Create**\n\nOnce your project is created, follow the steps below to create an agent.\n\n1. Click on the **Build** tab on the top right navigation bar\n2. Navigate to the **Agents** section in the left nav\n3. Click on the **Create agent** button\n4. Give your agent a name and click **Create**\n\n### 3. Connect your remote MCP server as a Tool to your agent\n\nAfter your agent is created, you can connect a remote MCP server as a tool for your agent to use. Follow the steps below to connect an MCP server to your agent.\n\n1. Navigate to **Tools** on the left nav bar\n2. Click on the **Connect a tool** button\n3. Go to the **Custom** tab\n4. Click on the **Model Context Protocol (MCP)** option, click **Create**\n5. Fill out the form on the following screen and click **Create.**Use the MCP server endpoint and API credentials from the previous section.\n1. Name=\"your-unique-name\"\n2. Remote MCP server endpoint=\"your-mcp-server-endpoint\"\n3. Authentication type= \"Key-based\"\n4. Credential= Key:\"x-ms-apikey\" Value: \"your-api-key\"\n\nOnce the tool is created you will see aÂ **Use in an agent** button. Click on that and choose the agent you previously created.\n\nAfter choosing the agent you should now see a connected tool in your agent view.\n\n### 4. Use the connected tool to run shell commands with your agent\n\nNow that the tool is connected you can use the playground to prompt the agent with a question that will launch the shell environment.\n\nTry the following prompt with your agent:\n\n> >\n> **\"Create a hello world flask app in a new remote environment. Then send a request to the app to show that it works.\"**\n> >\n\nOnce prompted, the connected MCP server will use it's tools to launch a shell environment and create an **environmentId**. This is used to track your session by creating a unique GUID so future commands are run in the same session.\n\nThe Foundry agent will then ask for approval for each step as the connected MCP tool will execute a series of shell commands that will install Python and Flask.\n\nOnce all requests have been completed and approved, you'll notice it has run the necessary shell commands in the remote environment and sent a curl request to the app with a response of Hello, World!\n\nIn this tutorial, we demonstrated how to extend Azure AI Foundry agents using Azure Container Apps dynamic session pools. By enabling MCP support on a shell session pool, we created a secure, on-demand execution environment that allows AI agents to run remote shell commands. With this setup, your AI agents can now bridge the gap between conversation and action, providing users with interactive and useful experiences.\n\nUpdated Nov 18, 2025\n\nVersion 1.0\n\n[azure container apps](/tag/azure%20container%20apps?nodeId=board%3AAppsonAzureBlog)\n\n[!\\[jeffmartinez&#x27;s avatar\\](https://techcommunity.microsoft.com/t5/s/gxcuf89792/m_assets/avatars/default/avatar-9.svg?image-dimensions=50x50)](/users/jeffmartinez/1213127) [jeffmartinez](/users/jeffmartinez/1213127) ![Icon for Microsoft rank](https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/cmstNC05WEo0blc?image-dimensions=100x16&amp;constrain-image=true)Microsoft\n\nJoined November 09, 2021\n\n[View Profile](/users/jeffmartinez/1213127)\n\n/category/azure/blog/appsonazureblog [Apps on Azure Blog](/category/azure/blog/appsonazureblog) Follow this blog board to get notified when there's new activity",
  "FeedName": "Microsoft Tech Community",
  "OutputDir": "_community",
  "ProcessedDate": "2025-11-18 07:03:55",
  "Tags": []
}
