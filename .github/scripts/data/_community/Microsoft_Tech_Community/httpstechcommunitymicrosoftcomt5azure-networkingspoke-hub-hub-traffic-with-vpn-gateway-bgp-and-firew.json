{
  "Author": "CUrti300",
  "ProcessedDate": "2025-11-26 09:05:06",
  "PubDate": "2025-11-20T18:04:09+00:00",
  "EnhancedContent": "Hello,\n\nI’m facing a situation where I’m trying to have Azure Firewall Inspection on the VPN Gateway VNET-VNET Connectivity. It seems to work if I go from **SpokeA-HubAFirewall-HubAVPN—HubBVPN-SpokeB** but if I try to go from **SpokeA-HubAFirewall-HubAVPN-HubBVM or Inbound Resolver** it fails to route correctly according to Connectivity Troubleshooter it stops at HubAVPN with **Local Error: RouteMissing** but then reaches destination health so makes me believe it’s getting there but not following the route I want it to take which might be causing routing issues. What Am I missing here? This connectivity was working before introducing the Azure Firewall for Inspection with the UDR. Is what I’m trying to accomplish not possible? I’ve tried different types of UDR rules on the Gateway Subnet, and this is my most recent configuration. The reason I’m trying to accomplish this is because I’m seeing a similar error in our Hub-Spoke Hybrid environment and I’m trying to replicate the issue.\n\n**Current Configuration**\n\n2x Hubs with Spoke networks attached so example\n\n**Hub-Spoke-A Configuration:**\n\n**Hub-A Contains** following subnets and Resources\n\nVPN Gateway - GateWaySubnet\n\nAzure Firewall - AzureFirewallSubnet\n\nInbound Private Resolver - PrivateResolverSubnet\n\nVirtual Machine – VM Subnet\n\nGateway Subnet has an attached UDR with the following routes\n\nPropagation - True\n\nPrefix Destination – **Hub-B**\n\nNext Hop Type – Virtual Appliance\n\nNext Hope IP – **Hub-A Firewall**\n\nPrefix Destination – **Spoke-B**\n\nNext Hop Type – Virtual Appliance\n\nNext Hope IP – **Hub-A Firewall**\n\n**Hub-Spoke-B Configuration:**\n\n**Hub-B Contains** following subnets and Resources\n\nVPN Gateway - GateWaySubnet\n\nAzure Firewall - AzureFirewallSubnet\n\nInbound Private Resolver - PrivateResolverSubnet\n\nVirtual Machine – VM Subnet\n\nGateway Subnet has an attached UDR with the following Routes\n\nPropagation - True\n\nPrefix Destination – **Hub-A**\n\nNext Hop Type – Virtual Appliance\n\nNext Hope IP – **Hub-B Firewall**\n\nPrefix Destination – **Spoke-A**\n\nNext Hop Type – Virtual Appliance\n\nNext Hope IP – **Hub-B Firewall**\n\n**Spoke** Subnets has an attached UDR with the following Routes\n\nPropagation - True\n\nPrefix Destination – 0.0.0.0/0\n\nNext Hop Type – Virtual Appliance\n\nNext Hope IP – HubA/HubB **Firewall (Depending on what hub its peered to)**\n\nVPN Gateways HA VNET-VNET with BGP Enabled. I can see that it knows the routes and like I said this was working prior introducing the UDRs for force traffic through the azure firewall.\n\n****\n\n****\n\n****\n\n****\n\n****\n\n****\n\n****",
  "Description": "Hello,\n\nI’m facing a situation where I’m trying to have Azure Firewall Inspection on the VPN Gateway VNET-VNET Connectivity. It seems to work if I go from **SpokeA-HubAFirewall-HubAVPN—HubBVPN-SpokeB** but if I try to go from **SpokeA-HubAFirewall-HubAVPN-HubBVM or Inbound Resolver** it fails to route correctly according to Connectivity Troubleshooter it stops at HubAVPN with **Local Error: RouteMissing** but then reaches destination health so makes me believe it’s getting there but not following the route I want it to take which might be causing routing issues. What Am I missing here? This connectivity was working before introducing the Azure Firewall for Inspection with the UDR. Is what I’m trying to accomplish not possible? I’ve tried different types of UDR rules on the Gateway Subnet, and this is my most recent configuration. The reason I’m trying to accomplish this is because I’m seeing a similar error in our Hub-Spoke Hybrid environment and I’m trying to replicate the issue.\n\n**Current Configuration**\n\n2x Hubs with Spoke networks attached so example\n\n**Hub-Spoke-A Configuration:**\n\n**Hub-A Contains** following subnets and Resources\n\nVPN Gateway - GateWaySubnet\n\nAzure Firewall - AzureFirewallSubnet\n\nInbound Private Resolver - PrivateResolverSubnet\n\nVirtual Machine – VM Subnet\n\nGateway Subnet has an attached UDR with the following routes\n\nPropagation - True\n\nPrefix Destination – **Hub-B**\n\nNext Hop Type – Virtual Appliance\n\nNext Hope IP – **Hub-A Firewall**\n\nPrefix Destination – **Spoke-B**\n\nNext Hop Type – Virtual Appliance\n\nNext Hope IP – **Hub-A Firewall**\n\n**Hub-Spoke-B Configuration:**\n\n**Hub-B Contains** following subnets and Resources\n\nVPN Gateway - GateWaySubnet\n\nAzure Firewall - AzureFirewallSubnet\n\nInbound Private Resolver - PrivateResolverSubnet\n\nVirtual Machine – VM Subnet\n\nGateway Subnet has an attached UDR with the following Routes\n\nPropagation - True\n\nPrefix Destination – **Hub-A**\n\nNext Hop Type – Virtual Appliance\n\nNext Hope IP – **Hub-B Firewall**\n\nPrefix Destination – **Spoke-A**\n\nNext Hop Type – Virtual Appliance\n\nNext Hope IP – **Hub-B Firewall**\n\n**Spoke** Subnets has an attached UDR with the following Routes\n\nPropagation - True\n\nPrefix Destination – 0.0.0.0/0\n\nNext Hop Type – Virtual Appliance\n\nNext Hope IP – HubA/HubB **Firewall (Depending on what hub its peered to)**\n\nVPN Gateways HA VNET-VNET with BGP Enabled. I can see that it knows the routes and like I said this was working prior introducing the UDRs for force traffic through the azure firewall.\n\n****\n\n****\n\n****\n\n****\n\n****\n\n****\n\n****",
  "Link": "https://techcommunity.microsoft.com/t5/azure-networking/spoke-hub-hub-traffic-with-vpn-gateway-bgp-and-firewall-issue/m-p/4471878#M750",
  "FeedName": "Microsoft Tech Community",
  "FeedLevelAuthor": "rss.livelink.threads-in-node",
  "Tags": [],
  "Title": "Spoke-Hub-Hub Traffic with VPN Gateway BGP and Firewall Issue",
  "FeedUrl": "https://techcommunity.microsoft.com/t5/s/gxcuf89792/rss/Category?category.id=Azure",
  "OutputDir": "_community"
}
