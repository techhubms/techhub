{
  "ProcessedDate": "2025-12-09 19:02:52",
  "FeedName": "Microsoft Azure SDK Blog",
  "Author": "PuiChee (PC) Chan",
  "Title": "Blue-green deployment in Azure Container Apps using Azure Developer CLI",
  "Description": "Learn how to implement blue-green deployment in Azure Container Apps using Azure Developer CLI (azd) revision-based deployment strategy.\n\nThe post [Blue-green deployment in Azure Container Apps using Azure Developer CLI](https://devblogs.microsoft.com/azure-sdk/azure-developer-cli-azd-blue-green-aca-deployment/) appeared first on [Azure SDK Blog](https://devblogs.microsoft.com/azure-sdk).",
  "PubDate": "2025-12-09T18:34:22+00:00",
  "OutputDir": "_news",
  "FeedLevelAuthor": "Azure SDK Blog",
  "FeedUrl": "https://devblogs.microsoft.com/azure-sdk/feed/",
  "Tags": [
    "Azure Container Apps",
    "Azure SDK",
    "azure-developer-cli",
    "Docker",
    "python"
  ],
  "Link": "https://devblogs.microsoft.com/azure-sdk/azure-developer-cli-azd-blue-green-aca-deployment/",
  "EnhancedContent": "# Blue-green deployment in Azure Container Apps using Azure Developer CLI\n\nIf you follow the [Azure Developer CLI blog posts](https://aka.ms/azd-blog), you already know that **Azure Container Apps (ACA) support in Azure Developer CLI (azd) is GA**. We want `azd` to be production-ready—you should be able to plug in the Bicep code your team uses and just run `azd up` . While getting the support GA-ready, one of the improvements we made was [revision-based deployment support](https://github.com/Azure/azure-dev/pull/5694), which means `azd` can now handle advanced rollout patterns like **blue-green deployment**.\n\nBlue-green deployment brings back fond memories. One of the first Jenkins blog posts I worked on was about blue-green deployment for Azure Kubernetes Service (AKS). I remember how much effort the engineer put into creating that quickstart—and how much longer I spent trying to understand what was going on. It’s great to see something that complex become almost trivial now.\n\nFor this demo, I asked Copilot to help generate a Python app to illustrate the workflow. No code changes needed—you can clearly see whether you’re using the blue or green revision. The Bicep is based on [Blue-green deployment in ACA](https://learn.microsoft.com/azure/container-apps/blue-green-deployment?pivots=bicep) and the workflow on the [containerapps-blue-green sample](https://github.com/Azure-Samples/containerapps-blue-green).\n\n## To run locally\n\n>\n> **Note:** The commit IDs in this demo (`fb699ef`\n> , `c6f1515`\n> ) are just examples. You can use any identifiers you want—like `blue-v1`\n> , `12345`\n> , or actual git commit hashes (as shown in the CI/CD workflow `azure-dev.yml`\n> ).\n>\n\n1. In an empty folder, run `azd init -t puichan/aca-blue-green`\n.\n2. To deploy BLUE:\n\n``` azd env set BLUE_COMMIT_ID fb699ef azd env set LATEST_COMMIT_ID fb699ef ```\n3. Run `azd up`\n\n>\n> **Note:** On first deployment, only the blue revision is created since `GREEN_COMMIT_ID`\n> isn’t set. The Bicep logic (`!empty(blueCommitId) && !empty(greenCommitId)`\n> ) skips traffic splitting until both revisions exist.\n>\n\n![Blue deployment showing ACA blue revision](https://devblogs.microsoft.com/azure-sdk/wp-content/uploads/sites/58/2025/12/12-03-azd-blue-green-deployment-aca-blue.webp)\n4. To deploy GREEN, but keep traffic on BLUE:\n\n``` // Create green revision azd env set GREEN_COMMIT_ID c6f1515 azd env set LATEST_COMMIT_ID c6f1515\n\n// keep traffic on BLUE azd env set PRODUCTION_LABEL blue ```\n\n>\n> **Note:** `LATEST_COMMIT_ID`\n> tells Bicep which revision to deploy. When you change it, a new revision is created. When you keep it the same and only change `PRODUCTION_LABEL`\n> (as shown later), traffic just switches between existing revisions.\n>\n\nAnd then run `azd deploy`\n\nIf you click the app endpoint, you still see the blue deployment. You see the blue deployment because `PRODUCTION_LABEL` is set to “blue”—traffic stays on blue. You can see the traffic logic in [`web.bicep`](https://github.com/puicchan/aca-blue-green/blob/main/infra/web.bicep):\n\n```Bicep traffic: !empty(blueCommitId) && !empty(greenCommitId) ? [ { revisionName: '${containerAppName}--${blueCommitId}' weight: productionLabel == 'blue' ? 100 : 0 label: 'blue' } { revisionName: '${containerAppName}--${greenCommitId}' weight: productionLabel == 'green' ? 100 : 0 label: 'green' } ```\n\nTo test, run this command to get all three fully qualified domain names (FQDNs):\n\n```powershell $uri = azd env get-value \"SERVICE_WEB_URI\"; $domain = ([System.Uri]$uri).Host.Split('.', 2)[1]; Write-Host \"Production FQDN: $uri\"; Write-Host \"Blue label FQDN: https://web---blue.$domain\"; Write-Host \"Green label FQDN: https://web---green.$domain\" ```\n\nClick the links in the output to see the production, blue and green label FQDN.\n\n``` Production FQDN: https://web.purplerock-d77264b4.westus.azurecontainerapps.io Blue label FQDN: https://web---blue.purplerock-d77264b4.westus.azurecontainerapps.io Green label FQDN: https://web---green.purplerock-d77264b4.westus.azurecontainerapps.io ```\n\nYou can also run `az containerapp ingress traffic show --name web --resource-group <your-resource-group> -o table` . Output:\n\n``` Label RevisionName Weight ------- -------------- -------- blue web--fb699ef 100 green web--c6f1515 0 ```\n5. To send production traffic to the green revision, set `PRODUCTION_LABEL`\nto “green” and then run `azd deploy` again:\n\n``` azd env set PRODUCTION_LABEL green azd deploy ```\n\nClick the endpoint—ta-da, green!\n\n![Green deployment showing ACA green revision](https://devblogs.microsoft.com/azure-sdk/wp-content/uploads/sites/58/2025/12/12-03-azd-blue-green-deployment-aca-green.webp)\n\nAgain, you can check:\n\n``` az containerapp ingress traffic show --name web --resource-group <your-resource-group> -o table ```\n6. To roll back to BLUE:\n\n``` azd env set PRODUCTION_LABEL blue azd deploy ```\n\n## CI/CD with GitHub Actions\n\nTo set up the GitHub workflow, the [sample repo](https://github.com/puicchan/aca-blue-green) contains a customized `azure-dev.yml` . Run the `azd pipeline config` command and you’re done.\n\n## Things to know\n\n- In revision-based strategy, `azd deploy`\ndeploys both the container app definition and image together based on [`web.bicep`](https://github.com/puicchan/aca-blue-green/blob/main/infra/web.bicep). The revision-based approach means changes to environment variables, images, resources, and load-balancing settings all roll out as a single revision. For more information, see the [official doc](https://learn.microsoft.com/azure/developer/azure-developer-cli/container-apps-workflows?tabs=avm-module#revision-based-deployment-strategy).\n- I override the default Docker image name and tag in [`azure.yaml`](https://github.com/puicchan/aca-blue-green/blob/main/azure.yaml) to specify my custom repository name and image instead of using azd’s defaults. Environment variables flow to Bicep through [`web.parameters.json`](https://github.com/puicchan/aca-blue-green/blob/main/infra/web.parameters.json)—when you set `BLUE_COMMIT_ID`\nvia `azd env set` , it maps to the `blueCommitId` Bicep parameter automatically. The environment variable mapping is why both manual commands and the GitHub workflow can control the same deployment logic.\n\n```yaml\n# Define the services\nservices: web: project: . language: python host: containerapp docker: image: aca-blue-green/svc tag: web-${LATEST_COMMIT_ID} ```\n- The [GitHub workflow](https://github.com/puicchan/aca-blue-green/blob/main/.github/workflows/azure-dev.yml) (`azure-dev.yml`) automates the blue-green deployment:\n- It uses the current commit ID as part of the revision label:\n\n```yaml\n- name: Get current commit ID\nid: commit run: echo \"commit_id=${GITHUB_SHA::7}\" >> $GITHUB_OUTPUT ```\n- It handles blue-green rotation automatically: checks whether blue or green is currently production, deploys the opposite color as the new version, and switches traffic over once everything looks good. Each deployment alternates between blue and green.\n- It uses ACA tags to remember state between deployments. It reads the tags to figure out which revision is currently production, then deploys to the opposite color. The tag-based state management is how it alternates automatically without hardcoding anything.\n- ACA automatically cleans up old revisions. The configuration sets `maxInactiveRevisions: 10`\nin [`web.bicep`](https://github.com/puicchan/aca-blue-green/blob/main/infra/web.bicep), so Azure keeps up to 10 inactive revisions before removing the oldest ones. You can also explicitly deactivate revisions manually if needed—see the [containerapps-blue-green sample](https://github.com/Azure-Samples/containerapps-blue-green) for examples.\n\n## Wrapping Up\n\nWorking through this blue-green deployment with `azd` shows how much simpler things are now. What used to take pages of Jenkins pipeline configuration now fits in a few environment variables and Bicep files. The real learning here is understanding that ACA revisions are **immutable**—you can’t change them once created. This immutability makes the blue-green pattern cleaner because each deployment creates a fresh revision, you point a label at it, and manage traffic weights. No confusion about which version is running.\n\nThe `azd` revision-based deployment support gives you production-grade control without losing the simplicity of `azd up` . You get to keep your team’s Bicep patterns while adding sophisticated rollout strategies on top.\n\nIf you try out ACA revision-based deployment, we’d love to hear how it goes. Use [this form](https://aka.ms/azd-user-research-signup) to share your feedback. The [full sample is on GitHub](https://github.com/puicchan/aca-blue-green) if you want to poke around. And if something breaks or you have questions, drop a comment. I’m probably still figuring out things too."
}
