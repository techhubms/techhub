{
  "name": "Tech Hub .NET",
  "image": "mcr.microsoft.com/devcontainers/base:ubuntu-24.04",
  "workspaceFolder": "/workspaces/techhub",
  "features": {
    "ghcr.io/devcontainers/features/dotnet:2": {
      "version": "10.0"
    },
    "ghcr.io/devcontainers/features/powershell:1": {},
    "ghcr.io/devcontainers/features/azure-cli:1": {
      "installBicep": true
    },
    "ghcr.io/azure/azure-dev/azd:latest": {},
    "ghcr.io/devcontainers/features/github-cli:1": {},
    "ghcr.io/devcontainers/features/node:1": {}
  },
  "customizations": {
    "vscode": {
      "extensions": [
        // .NET Development
        "ms-dotnettools.csharp",
        "ms-dotnettools.csdevkit",
        "ms-dotnettools.vscode-dotnet-runtime",
        "ms-dotnettools.dotnet-interactive-vscode",
        
        // Azure & Infrastructure
        "ms-azuretools.vscode-bicep",
        "ms-azuretools.vscode-azurecontainerapps",
        "ms-azuretools.vscode-azureresourcegroups",
        "ms-azuretools.vscode-azure-github-copilot",
        "ms-vscode.vscode-node-azure-pack",
        
        // GitHub & Copilot
        "github.copilot",
        "github.copilot-chat",
        "github.vscode-github-actions",
        "github.vscode-pull-request-github",
        
        // Testing & Quality
        "ms-playwright.playwright",
        "DavidAnson.vscode-markdownlint",
        "humao.rest-client",
        
        // PowerShell
        "ms-vscode.powershell"
      ],
      "settings": {
        // ==================== .NET Settings ====================
        "dotnet.defaultSolution": "TechHub.sln",
        "dotnet.server.useOmnisharp": false,
        "csharp.semanticHighlighting.enabled": true,
        
        // ==================== GitHub Copilot Settings ====================
        // Agent mode (default: true in VS Code 1.99+, increased limit)
        "chat.agent.maxRequests": 100,
        
        // Experimental Agent Features
        "chat.agent.thinking.collapsedTools": "off", // Show tool call details expanded
        "chat.agentSessionsViewLocation": "view", // Enable dedicated Chat Sessions view
        "chat.customAgentInSubagent.enabled": true, // Enable custom agents with subagents
        "chat.tools.terminal.blockDetectedFileWrites": "never", // Don't block file writes in workspace
        "chat.useAgentSkills": true, // Enable agent skills support
        "chat.useNestedAgentsMdFiles": true, // Enable AGENTS.md in subfolders

        // Experimental Chat Features  
        "chat.emptyState.history.enabled": true, // Show recent history in empty chat
        "chat.math.enabled": true, // Enable KaTeX math rendering
        "chat.sendElementsToChat.enabled": true, // Send browser elements to chat
        "chat.viewTitle.enabled": true, // Show chat session title in header
        
        // Experimental Copilot Features
        "github.copilot.chat.agent.thinkingTool": true, // Enable thinking tool for agents
        "github.copilot.chat.cli.customAgents.enabled": true, // Enable custom agents from GitHub background agent sessions
        "github.copilot.chat.codesearch.enabled": true, // Auto-discover files with #codebase
        "github.copilot.chat.edits.newNotebook.enabled": true, // Enable notebook tool in edit mode
        "github.copilot.chat.edits.suggestRelatedFilesFromGitHistory": true, // Git history suggestions
        "github.copilot.chat.editor.temporalContext.enabled": true, // Include recent files in inline chat
        "github.copilot.chat.generateTests.codeLens": true, // Show test generation CodeLens
        "github.copilot.chat.notebook.followCellExecution.enabled": true, // Follow cell execution
        "github.copilot.chat.scopeSelection": true, // Prompt for symbol scope with /explain
        "notebook.experimental.generate": true, // Enable Generate action for notebook cells
        
        // Experimental Inline Chat Features
        "inlineChat.lineEmptyHint": true, // Show hint on empty lines
        
        // ==================== Extension Settings ====================
        "githubPullRequests.codingAgent.uiIntegration": true,
        "playwright.reuseBrowser": true,
        "playwright.showTrace": true,
        "powershell.integratedConsole.showOnStartup": false,
        "terminal.integrated.defaultProfile.linux": "pwsh",
        
        "files.associations": {
          "*.ps1": "powershell",
          "*.bicep": "bicep",
          "*.json": "jsonc"
        },
        "chat.tools.terminal.autoApprove": {
          // Unsafe commands
          "chmod": false,
          "chown": false,
          "curl": true,
          "del": false,
          "eval": false,
          "kill": false,
          "rm": false,
          "rmdir": false,
          "wget": true,

          // Shell interpreters - block to prevent arbitrary code execution except pwsh
          "/^dotnet\\b.*/": { "approve": false, "matchCommandLine": true },
          "/^node\\b.*/": { "approve": false, "matchCommandLine": true },
          "/^npm\\b.*/": { "approve": false, "matchCommandLine": true },
          "/^npx\\b.*/": { "approve": false, "matchCommandLine": true },
          "/^pwsh\\b.*/": { "approve": true, "matchCommandLine": true },
          
          // Safeish pwsh functions
          "Compare-Object": true,
          "ConvertFrom-Json": true,
          "ConvertTo-Json": true,
          "ForEach-Object": true,
          "Format-Table": true,
          "Get-ChildItem": true,
          "Get-Content": true,
          "Get-Date": true,
          "Get-Location": true,
          "Get-Process": true,
          "Get-Random": true,
          "Get-Service": true,
          "Group-Object": true,
          "Join-Path": true,
          "Measure-Object": true,
          "Out-File": true,
          "Resolve-Path": true,
          "Select-Object": true,
          "Select-String": true,
          "Set-Content": true,
          "Set-Location": true,
          "Sort-Object": true,
          "Split-Path": true,
          "Test-Path": true,
          "Where-Object": true,
          "Write-Debug": true,
          "Write-Error": true,
          "Write-Host": true,
          "Write-Output": true,
          "Write-Verbose": true,
          "Write-Warning": true,

          // Safeish commands
          "aspire": true,
          "az": true,
          "azd": true,
          "bicep": true,
          "cat": true,
          "cd": true,
          "cut": true,
          "date": true,
          "df": true,
          "diff": true,
          "dir": true,
          "du": true,
          "echo": true,
          "env": true,
          "file": true,
          "find": true,
          "free": true,
          "gh": true,
          "git": true,
          "grep": true,
          "head": true,
          "history": true,
          "id": true,
          "jq": true,
          "less": true,
          "ls": true,
          "more": true,
          "netstat": true,
          "nuget": true,
          "ps": true,
          "pwd": true,
          "sleep": true,
          "sort": true,
          "stat": true,
          "tail": true,
          "timeout": true,
          "top": true,
          "tr": true,
          "tree": true,
          "uname": true,
          "uniq": true,
          "uptime": true,
          "wc": true,
          "which": true,
          "whoami": true
        }
      },
      "mcp": {
        "servers": {
          "github": {
            "type": "http",
            "url": "https://api.githubcopilot.com/mcp/"
          },
          "playwright": {
            "type": "stdio",
            "command": "npx",
            "args": [
              "-y",
              "@playwright/mcp@latest",
              "--vision",
              "--headless",
              "--isolated",
              "--no-sandbox"
            ]
          },
          "context7": {
            "type": "http",
            "url": "https://mcp.context7.com/mcp"
          }
        }
      }
    }
  },
  "postCreateCommand": "bash dotnet/.devcontainer/post-create.sh",
  "forwardPorts": [5000, 5001, 15888, 5173],
  "portsAttributes": {
    "5000": { "label": "API HTTP" },
    "5001": { "label": "API HTTPS" },
    "5173": { "label": "Blazor Dev Server" },
    "15888": { "label": "Aspire Dashboard" }
  }
}
