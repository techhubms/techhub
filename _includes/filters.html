{%- if include.items and include.items.size > 0 -%}
  {%- assign index_tag_mode = include.index_tag_mode -%}

  {%- assign filter_results = include.items | generate_all_filters: index_tag_mode, site.data.sections, include.section, page.category, page.collection, site.tag_filter -%}
  
  <div id="tag-filters" class="tag-filters-flex">
    <button id="tags-clear-btn" class="tag-filter-btn clear-btn">Clear All</button>
    
    {%- comment -%} Date filter buttons (always rendered first if available) {%- endcomment -%}
    {%- assign date_filter_buttons = filter_results.date_filter_buttons -%}
    {%- if date_filter_buttons and date_filter_buttons.size > 0 -%}
      {%- for button in date_filter_buttons -%}
        <button class="tag-filter-btn date-filter-btn" data-tag="{{ button.data_tag | escape }}" data-filter-type="date">
          {{ button.label | escape }} 
          <span class="filter-count {{ button.width_class }}">({{ button.count }})</span>
        </button>
      {%- endfor -%}
    {%- endif -%}

    {%- comment -%} Text search input (between date and tag filters) {%- endcomment -%}
    <div class="text-search-container">
      <input type="text" id="text-search-input" placeholder="Search tags and descriptions..." class="text-search-input">
      <button id="text-search-clear" class="text-search-clear-btn hidden" title="Clear search">Ã—</button>
    </div>

    {%- comment -%} Mode-specific filter buttons {%- endcomment -%}
    {%- assign mode_filter_buttons = filter_results.mode_filter_buttons -%}

    {%- if mode_filter_buttons and mode_filter_buttons.size > 0 -%}
      {%- comment -%} Unified button rendering for all modes {%- endcomment -%}
      {%- assign hidden_count = 0 -%}
      
      {%- for button in mode_filter_buttons -%}
        {%- comment -%} Determine if this is a hidden tag (for tags mode only) {%- endcomment -%}
        {%- assign is_hidden_tag = false -%}
        {%- if index_tag_mode == 'tags' -%}
          {%- unless button.is_top_tag -%}
            {%- assign is_hidden_tag = true -%}
            {%- assign hidden_count = hidden_count | plus: 1 -%}
          {%- endunless -%}
        {%- endif -%}
        
        {%- comment -%} Render button with appropriate classes and data attributes - everything is now a tag {%- endcomment -%}
        <button class="tag-filter-btn{% if is_hidden_tag %} hidden-tag-btn{% endif %}" 
                data-tag="{{ button.normalized | escape }}" 
                data-filter-type="tag">
          {{ button.display | escape }} 
          <span class="filter-count {{ button.width_class }}">({{ button.count }})</span>
        </button>
      {%- endfor -%}

      {%- comment -%} More/Less toggle button (only for tags mode with hidden tags) {%- endcomment -%}
      {%- if index_tag_mode == 'tags' and hidden_count > 0 -%}
        <button id="toggle-collapsed-tags" class="tag-filter-btn toggle-btn">More</button>
      {%- endif -%}
    {%- endif -%}
  </div>

  {%- comment -%} Initialize JavaScript with data parameters {%- endcomment -%}
  <script src="{{ '/assets/js/filters.js' | relative_url }}"></script>
  <script>
    // Initialize tag filter with all data parameters from unified filter
    window.initializeTagFilter(
      {{ filter_results.tag_filter_data | jsonify }},
      {{ filter_results.tag_relationships | jsonify }},
      {{ filter_results.date_filter_config | jsonify }}
    );
  </script>
{%- else -%}
  {%- comment -%} No content available for filtering {%- endcomment -%}
  <div class="filter-message">
    No content available for filtering.
  </div>
{%- endif -%}